<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>حساب جرعات التخدير</title>
<style>
body { font-family: Arial; direction: rtl; background:#f0f2f5; transition: background 1s;}
h1,h2 { color:#333; transition: color 1s; }
.container { max-width:700px; margin:auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1);}
input,select,button,textarea { width:100%; padding:10px; margin:10px 0; border-radius:5px; border:1px solid #ccc; transition: all 0.3s;}
button { background:#007bff; color:#fff; border:none; cursor:pointer; transition: background 0.3s;}
button:hover { background:#0056b3;}
#aiChatBox, #aiChatBox2, #aiChatBox3 { height:200px; overflow-y:auto; background:#e9ecef; padding:10px; border-radius:5px;}
.bubble { position:absolute; border-radius:50%; opacity:0.6; animation: floatUp 8s linear infinite;}
@keyframes floatUp { 0% { transform: translateY(100vh); } 100% { transform: translateY(-10vh); } }
.sideEffect { background:#ffe0e0; padding:5px; margin:5px 0; border-radius:5px; animation:fadeIn 1s;}
@keyframes fadeIn { from{opacity:0} to{opacity:1} }
</style>
</head>
<body>
<div id="bubbleContainer"></div>

<div class="container">
<h1>حساب جرعات التخدير</h1>

<label>وزن المريض (كغ):</label>
<input type="number" id="weight" placeholder="أدخل الوزن">

<label>عمر المريض (سنة):</label>
<input type="number" id="age" placeholder="أدخل العمر">

<!-- قسم جرعات التخدير -->
<h2>جرعات التخدير</h2>
<label>نوع الدواء:</label>
<select id="drug">
<option value="propofol">بروبوفول</option>
<option value="midazolam">ميدازولام</option>
<option value="fentanyl">فنتانيل</option>
<option value="ketamine">كيتامين</option>
</select>
<button onclick="calculateDose()">احسب الجرعة</button>
<h3>الجرعة: <span id="dose">-</span></h3>
<div id="sideEffects"></div>

<div id="aiChatBox"></div>
<textarea id="aiInput" placeholder="اكتب حالة المريض هنا..."></textarea>
<button onclick="sendAIMessage('aiInput','aiChatBox')">أرسل</button>

<hr>

<!-- قسم السوائل والدم -->
<h2>حساب السوائل والدم</h2>
<button onclick="calculateFluids()">احسب السوائل والدم</button>
<div id="fluidResult">-</div>

<div id="aiChatBox2"></div>
<textarea id="aiInput2" placeholder="استفسر عن السوائل والدم..."></textarea>
<button onclick="sendAIMessage('aiInput2','aiChatBox2')">أرسل</button>

<hr>

<!-- قسم اللارنغوسكوب والETT -->
<h2>حجم اللارنغوسكوب وETT</h2>
<button onclick="calculateLaryngo()">اعرض الحجم المناسب</button>
<div id="laryngoResult">-</div>

<div id="aiChatBox3"></div>
<textarea id="aiInput3" placeholder="استفسر عن اللارنغوسكوب..."></textarea>
<button onclick="sendAIMessage('aiInput3','aiChatBox3')">أرسل</button>

<hr>

<button onclick="openAdminPanel()">لوحة التحكم (للمالك فقط)</button>
</div>

<div id="adminPanel" style="display:none;">
<div class="container">
<h1>لوحة التحكم</h1>
<label>كلمة المرور:</label>
<input type="password" id="adminPassword" placeholder="أدخل كلمة المرور">
<button onclick="loginAdmin()">تسجيل الدخول</button>

<div id="adminContent" style="display:none">
<h2>تغيير الواجهة</h2>
<textarea id="customCSS" placeholder="أدخل CSS لتغيير الواجهة"></textarea>
<button onclick="applyCustomCSS()">تطبيق</button>

<h2>تعديل الأدوية</h2>
<textarea id="customDrugs" placeholder="اسم_الدواء,جرعة لكل كغ,المؤثرات الجانبية,العلاج"></textarea>
<button onclick="applyCustomDrugs()">تطبيق</button>

<h2>مؤثرات رسومية</h2>
<button onclick="toggleSideEffects(true)">عرض المؤثرات</button>
<button onclick="toggleSideEffects(false)">إخفاء المؤثرات</button>
<button onclick="triggerEffect()">تأثير بصري</button>
<button onclick="startBubbles()">فقاعات متحركة</button>
</div>
</div>
</div>

<script>
// بيانات الأدوية مع الأعراض الجانبية والعلاج
let drugsData = {
"propofol": {dosePerKg:2, side:[{symptom:"دوار", treatment:"خفض السرعة والنوم"} , {symptom:"انخفاض ضغط الدم", treatment:"رفع الأرجل وإعطاء سوائل"}]},
"midazolam": {dosePerKg:0.1, side:[{symptom:"نعاس", treatment:"مراقبة"} , {symptom:"ارتخاء العضلات", treatment:"مراقبة"}]},
"fentanyl": {dosePerKg:0.001, side:[{symptom:"تثبيط تنفسي", treatment:"إعطاء أدوية تنفس"} , {symptom:"غثيان", treatment:"دواء مضاد للغثيان"}]},
"ketamine": {dosePerKg:1.5, side:[{symptom:"هلوسة", treatment:"مراقبة"} , {symptom:"ارتفاع ضغط الدم", treatment:"أدوية خافضة للضغط"}]}
};

// جرعات التخدير
function calculateDose(){
let w = parseFloat(document.getElementById('weight').value);
let age = parseInt(document.getElementById('age').value);
let drug = document.getElementById('drug').value;
if(!w || !age){ alert("أدخل الوزن والعمر"); return; }
let dose = w * drugsData[drug].dosePerKg;
document.getElementById('dose').innerText = dose + " ملغ";

// عرض الأعراض الجانبية مع العلاج
let sideHTML = "<ul>";
drugsData[drug].side.forEach(s => { sideHTML += `<li>${s.symptom} - علاج: ${s.treatment}</li>`; });
sideHTML += "</ul>";
document.getElementById('sideEffects').innerHTML = sideHTML;
}

// السوائل والدم
function calculateFluids(){
let w = parseFloat(document.getElementById('weight').value);
let age = parseInt(document.getElementById('age').value);
if(!w || !age){ alert("أدخل الوزن والعمر"); return; }
let fluids = w*20; // مثال: 20 مل لكل كغ
let blood = w*70; // مثال: 70 مل لكل كغ
document.getElementById('fluidResult').innerText = `السوائل: ${fluids} مل - الدم: ${blood} مل`;
}

// اللارنغوسكوب
function calculateLaryngo(){
let age = parseInt(document.getElementById('age').value);
if(!age){ alert("أدخل العمر"); return; }
let size="";
if(age<1) size="0"; else if(age<2) size="1"; else if(age<5) size="2"; else if(age<12) size="3"; else size="4"; 
document.getElementById('laryngoResult').innerText = `حجم اللارنغوسكوب المناسب: ${size}`;
}

// --- شات AI ---
async function sendAIMessage(inputId, chatBoxId){
const input = document.getElementById(inputId).value;
if(!input) return;
const chatBox = document.getElementById(chatBoxId);
const userMsg = document.createElement('p');
userMsg.innerHTML = "<b>أنت:</b> "+input;
chatBox.appendChild(userMsg);

const aiMsg = document.createElement('p');
aiMsg.innerHTML = "<b>الذكاء الاصطناعي:</b> جاري الرد...";
chatBox.appendChild(aiMsg);
chatBox.scrollTop = chatBox.scrollHeight;

try {
  const response = await fetch('https://YOUR_BACKEND_URL/ai', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({message: input})
  });
  const data = await response.json();
  aiMsg.innerHTML = "<b>الذكاء الاصطناعي:</b> " + data.reply;
} catch(error){
  aiMsg.innerHTML = "<b>الذكاء الاصطناعي:</b> حدث خطأ. يرجى المحاولة لاحقاً.";
  console.error(error);
}
document.getElementById(inputId).value='';
}

// لوحة التحكم
function openAdminPanel(){ document.getElementById('adminPanel').style.display='block'; }
function loginAdmin(){
let pw=document.getElementById('adminPassword').value;
if(pw==="mustafa@2006#2"){
document.getElementById('adminContent').style.display='block';
alert("تم الدخول للوحة التحكم!");
}else alert("كلمة المرور خاطئة!");
}

// CSS
function applyCustomCSS(){
let css=document.getElementById('customCSS').value
