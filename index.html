<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>حساب جرعة التخدير المتقدم</title>
<style>
body { font-family: Arial; direction: rtl; text-align: right; background:#f0f2f5; padding:20px; transition: background 1s;}
h1,h2{color:#333; transition: color 1s;}
.container { max-width:700px; margin:auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1);}
input,select,button,textarea{width:100%; padding:10px; margin:10px 0; border-radius:5px; border:1px solid #ccc; transition: all 0.3s;}
button{background:#007bff;color:#fff;border:none;cursor:pointer; transition: background 0.3s;}
button:hover{background:#0056b3;}
#aiChatBox{height:200px; overflow-y:auto; background:#e9ecef; padding:10px; border-radius:5px;}
.bubble { position: absolute; border-radius: 50%; opacity: 0.6; animation: floatUp 8s linear infinite; }
@keyframes floatUp { 0% { transform: translateY(100vh); } 100% { transform: translateY(-10vh); } }
</style>
</head>
<body>
<div id="bubbleContainer"></div>
<div class="container">
<h1>حساب جرعة التخدير</h1>

<label>وزن المريض (كغ):</label>
<input type="number" id="weight" placeholder="أدخل وزن المريض">

<label>نوع الدواء:</label>
<select id="drug">
<option value="propofol">بروبوفول</option>
<option value="midazolam">ميدازولام</option>
<option value="fentanyl">فنتانيل</option>
<option value="ketamine">كيتامين</option>
</select>

<button onclick="calculateDose()">احسب الجرعة</button>
<h2>الجرعة المحسوبة: <span id="dose">-</span></h2>
<div id="sideEffects"></div>

<hr>
<h2>شات الذكاء الاصطناعي الطبي</h2>
<div id="aiChatBox"></div>
<textarea id="aiInput" placeholder="اكتب حالة المريض هنا..."></textarea>
<button onclick="sendAIMessage()">أرسل</button>
<hr>
<button onclick="openAdminPanel()">لوحة التحكم (للمالك فقط)</button>
</div>

<div id="adminPanel" style="display:none;">
<div class="container">
<h1>لوحة التحكم المتقدمة</h1>
<label>كلمة المرور:</label>
<input type="password" id="adminPassword" placeholder="أدخل كلمة المرور">
<button onclick="loginAdmin()">تسجيل الدخول</button>

<div id="adminContent" style="display:none;">

<h2>تغيير واجهة الموقع (CSS)</h2>
<textarea id="customCSS" placeholder="أدخل CSS لتغيير الواجهة مباشرة"></textarea>
<button onclick="applyCustomCSS()">تطبيق التغييرات</button>

<h2>إضافة/تعديل الأدوية</h2>
<textarea id="customDrugs" placeholder="صيغة: اسم_الدواء,جرعة_لكل_كغ,الجرعة_بالملغ,المؤثرات_الجانبية"></textarea>
<button onclick="applyCustomDrugs()">تطبيق الأدوية</button>

<h2>إدارة رسائل الذكاء الاصطناعي</h2>
<textarea id="aiSystemMessage" placeholder="مثال: أنت طبيب تخدير. أجب بدقة على كل أسئلة الجرعات والحالات الطبية."></textarea>
<button onclick="applyAISystemMessage()">تطبيق رسالة الذكاء الاصطناعي</button>

<h2>خيارات إضافية</h2>
<button onclick="toggleSideEffects(true)">عرض مؤثرات جانبية</button>
<button onclick="toggleSideEffects(false)">إخفاء مؤثرات جانبية</button>
<button onclick="triggerEffect()">تفعيل مؤثر بصري مؤقت</button>
<button onclick="startBubbles()">تفعيل فقاعات متحركة</button>

</div>
</div>
</div>

<script>
// --- البيانات ---
let drugsData = {
"propofol": {dosePerKg:2, side:"دوار، انخفاض ضغط الدم"},
"midazolam": {dosePerKg:0.1, side:"نعاس، ارتخاء العضلات"},
"fentanyl": {dosePerKg:0.001, side:"تثبيط تنفسي، غثيان"},
"ketamine": {dosePerKg:1.5, side:"هلوسة، ارتفاع ضغط الدم"}
};

// --- حساب الجرعة ---
function calculateDose(){
const weight=parseFloat(document.getElementById('weight').value);
const drug=document.getElementById('drug').value;
if(!weight){alert("يرجى إدخال وزن المريض!"); return;}
let dose = weight*drugsData[drug].dosePerKg;
document.getElementById('dose').innerText = dose + " ملغ";
if(document.getElementById('sideEffects').style.display!=="none"){
document.getElementById('sideEffects').innerText = "المؤثرات الجانبية: " + drugsData[drug].side;
}
}

// --- الشات مع الذكاء الاصطناعي ---
let systemMessage = "أنت طبيب تخدير. أجب بدقة على أسئلة الجرعات والحالات الطبية.";
async function sendAIMessage(){
const input=document.getElementById('aiInput').value;
if(!input) return;
const chatBox=document.getElementById('aiChatBox');
const userMsg=document.createElement('p');
userMsg.innerHTML="<b>أنت:</b> "+input;
chatBox.appendChild(userMsg);
const aiMsg=document.createElement('p');
aiMsg.innerHTML="<b>الذكاء الاصطناعي:</b> جاري الرد...";
chatBox.appendChild(aiMsg);
chatBox.scrollTop=chatBox.scrollHeight;
try{
const response=await fetch('https://api.openai.com/v1/chat/completions',{
method:'POST',
headers:{
'Content-Type':'application/json',
'Authorization':'Bearer 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'
},
body:JSON.stringify({
model:"gpt-4o-mini",
messages:[
{role:"system", content: systemMessage},
{role:"user", content: input}
]
})
});
const data=await response.json();
const answer=data.choices[0].message.content;
aiMsg.innerHTML="<b>الذكاء الاصطناعي:</b> "+answer;
chatBox.scrollTop=chatBox.scrollHeight;
}catch(error){
aiMsg.innerHTML="<b>الذكاء الاصطناعي:</b> حدث خطأ. يرجى المحاولة لاحقًا.";
console.error(error);}
document.getElementById('aiInput').value='';
}

// --- لوحة التحكم ---
function openAdminPanel(){document.getElementById('adminPanel').style.display='block';}
function loginAdmin(){
const pw=document.getElementById('adminPassword').value;
if(pw==="mustafa@2006#2"){
document.getElementById('adminContent').style.display='block';
alert("تم الدخول للوحة التحكم!");
}else{alert("كلمة المرور خاطئة!");}}

// --- تعديل CSS ---
function applyCustomCSS(){
const css=document.getElementById('customCSS').value;
let styleTag = document.getElementById('dynamicStyle');
if(!styleTag){
styleTag = document.createElement('style');
styleTag.id='dynamicStyle';
document.head.appendChild(styleTag);
}
styleTag.innerHTML = css;
alert("تم تطبيق التغييرات!");
}

// --- تعديل الأدوية ---
function applyCustomDrugs(){
const text=document.getElementById('customDrugs').value.trim();
if(!text) return;
drugsData={};
document.getElementById("drug").innerHTML="";
const lines=text.split("\n");
lines.forEach(line=>{
let parts=line.split(",");
if(parts.length>=4){
drugsData[parts[0].trim()]={dosePerKg:parseFloat(parts[1]), doseMg:parseFloat(parts[2]), side:parts[3].trim()};
let option=document.createElement("option");
option.value=parts[0].trim();
option.innerText=parts[0].trim();
document.getElementById("drug").appendChild(option);
}
});
alert("تم تحديث قائمة الأدوية!");
}

// --- تعديل رسالة الذكاء الاصطناعي ---
function applyAISystemMessage(){
systemMessage=document.getElementById('aiSystemMessage').value;
alert("تم تحديث رسالة الذكاء الاصطناعي!");
}

// --- مؤثرات جانبية ---
function toggleSideEffects(show){
document.getElementById('sideEffects').style.display = show ? 'block' : 'none';
}

// --- مؤثر بصري ---
function triggerEffect(){
document.body.style.backgroundColor="#ffe0e0";
setTimeout(()=>{document.body.style.backgroundColor="#f0f2f5";},500);
}

// --- فقاعات متحركة ---
function startBubbles(){
const container=document.getElementById('bubbleContainer');
for(let i=0;i<20;i++){
const bubble=document.createElement('div');
bubble.className='bubble';
bubble.style.width=(10+Math.random()*20)+'px';
bubble.style.height=bubble.style.width;
