<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>حساب جرعات التخدير</title>
<style>
body { font-family: Arial; direction: rtl; background:#f0f2f5; transition: background 1s;}
h1,h2 { color:#333; transition: color 1s; }
.container { max-width:700px; margin:auto; background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1);}
input,select,button,textarea { width:100%; padding:10px; margin:10px 0; border-radius:5px; border:1px solid #ccc; transition: all 0.3s;}
button { background:#007bff; color:#fff; border:none; cursor:pointer; transition: background 0.3s;}
button:hover { background:#0056b3;}
#aiChatBox { height:200px; overflow-y:auto; background:#e9ecef; padding:10px; border-radius:5px;}
.bubble { position:absolute; border-radius:50%; opacity:0.6; animation: floatUp 8s linear infinite;}
@keyframes floatUp { 0% { transform: translateY(100vh); } 100% { transform: translateY(-10vh); } }
.sideEffect { background:#ffe0e0; padding:5px; margin:5px 0; border-radius:5px; animation:fadeIn 1s;}
@keyframes fadeIn { from{opacity:0} to{opacity:1} }
</style>
</head>
<body>
<div id="bubbleContainer"></div>

<div class="container">
<h1>حساب جرعات التخدير</h1>

<label>وزن المريض (كغ):</label>
<input type="number" id="weight" placeholder="أدخل الوزن">

<label>عمر المريض (سنة):</label>
<input type="number" id="age" placeholder="أدخل العمر">

<label>نوع الدواء:</label>
<select id="drug">
<option value="propofol">بروبوفول</option>
<option value="midazolam">ميدازولام</option>
<option value="fentanyl">فنتانيل</option>
<option value="ketamine">كيتامين</option>
</select>

<label>حجم اللارنغوسكوب:</label>
<input type="text" id="laryngo" readonly>

<button onclick="calculateDose()">احسب الجرعة</button>

<h2>الجرعة: <span id="dose">-</span></h2>
<div id="sideEffects"></div>

<hr>
<h2>شات الذكاء الاصطناعي الطبي</h2>
<div id="aiChatBox"></div>
<textarea id="aiInput" placeholder="اكتب حالة المريض هنا..."></textarea>
<button onclick="sendAIMessage()">أرسل</button>

<hr>
<button onclick="openAdminPanel()">لوحة التحكم (للمالك فقط)</button>
</div>

<div id="adminPanel" style="display:none;">
<div class="container">
<h1>لوحة التحكم</h1>
<label>كلمة المرور:</label>
<input type="password" id="adminPassword" placeholder="أدخل كلمة المرور">
<button onclick="loginAdmin()">تسجيل الدخول</button>

<div id="adminContent" style="display:none">
<h2>تغيير الواجهة</h2>
<textarea id="customCSS" placeholder="أدخل CSS لتغيير الواجهة"></textarea>
<button onclick="applyCustomCSS()">تطبيق</button>

<h2>تعديل الأدوية</h2>
<textarea id="customDrugs" placeholder="اسم_الدواء,جرعة لكل كغ,المؤثرات الجانبية"></textarea>
<button onclick="applyCustomDrugs()">تطبيق</button>

<h2>مؤثرات رسومية</h2>
<button onclick="toggleSideEffects(true)">عرض المؤثرات</button>
<button onclick="toggleSideEffects(false)">إخفاء المؤثرات</button>
<button onclick="triggerEffect()">تأثير بصري</button>
<button onclick="startBubbles()">فقاعات متحركة</button>
</div>
</div>
</div>

<script>
// بيانات الأدوية
let drugsData = {
"propofol": {dosePerKg:2, side:["دوار","انخفاض ضغط الدم"]},
"midazolam": {dosePerKg:0.1, side:["نعاس","ارتخاء العضلات"]},
"fentanyl": {dosePerKg:0.001, side:["تثبيط تنفسي","غثيان"]},
"ketamine": {dosePerKg:1.5, side:["هلوسة","ارتفاع ضغط الدم"]}
};

// حساب الجرعة وحجم اللارنغوسكوب
function calculateDose(){
let w = parseFloat(document.getElementById('weight').value);
let age = parseInt(document.getElementById('age').value);
let drug = document.getElementById('drug').value;
if(!w || !age){ alert("أدخل الوزن والعمر"); return; }
let dose = w * drugsData[drug].dosePerKg;
document.getElementById('dose').innerText = dose + " ملغ";

// عرض الأعراض الجانبية متحركة
let sideHTML = "";
drugsData[drug].side.forEach(s => {
sideHTML += `<div class="sideEffect">${s}</div>`;
});
document.getElementById('sideEffects').innerHTML = sideHTML;

// تحديد حجم اللارنغوسكوب تلقائياً
let size="";
if(age<1) size="0";
else if(age<2) size="1";
else if(age<5) size="2";
else if(age<12) size="3";
else size="4"; // بالغ
document.getElementById('laryngo').value = size;
}

// --- شات AI باستخدام Backend دائم مع OpenAI ---
async function sendAIMessage(){
const input = document.getElementById('aiInput').value;
if(!input) return;
const chatBox = document.getElementById('aiChatBox');
const userMsg = document.createElement('p');
userMsg.innerHTML = "<b>أنت:</b> "+input;
chatBox.appendChild(userMsg);

const aiMsg = document.createElement('p');
aiMsg.innerHTML = "<b>الذكاء الاصطناعي:</b> جاري الرد...";
chatBox.appendChild(aiMsg);
chatBox.scrollTop = chatBox.scrollHeight;

try {
  const response = await fetch('https://YOUR_BACKEND_URL', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({message: input})
  });
  const data = await response.json();
  aiMsg.innerHTML = "<b>الذكاء الاصطناعي:</b> " + data.reply;
} catch(error){
  aiMsg.innerHTML = "<b>الذكاء الاصطناعي:</b> حدث خطأ. يرجى المحاولة لاحقاً.";
  console.error(error);
}
document.getElementById('aiInput').value='';
}

// لوحة التحكم
function openAdminPanel(){ document.getElementById('adminPanel').style.display='block'; }
function loginAdmin(){
let pw=document.getElementById('adminPassword').value;
if(pw==="mustafa@2006#2"){
document.getElementById('adminContent').style.display='block';
alert("تم الدخول للوحة التحكم!");
}else alert("كلمة المرور خاطئة!");
}

// CSS
function applyCustomCSS(){
let css=document.getElementById('customCSS').value;
let styleTag=document.getElementById('dynamicStyle');
if(!styleTag){ styleTag=document.createElement('style'); styleTag.id='dynamicStyle'; document.head.appendChild(styleTag);}
styleTag.innerHTML=css;
alert("تم تطبيق CSS");
}

// تعديل الأدوية
function applyCustomDrugs(){
let text=document.getElementById('customDrugs').value.trim();
if(!text) return;
drugsData={};
document.getElementById("drug").innerHTML="";
text.split("\n").forEach(line=>{
let parts=line.split(",");
if(parts.length>=3){
drugsData[parts[0].trim()]={dosePerKg:parseFloat(parts[1]), side:parts.slice(2)};
let option=document.createElement("option"); option.value=parts[0].trim(); option.innerText=parts[0].trim();
document.getElementById("drug").appendChild(option);
}});
alert("تم تحديث الأدوية!");
}

// مؤثرات جانبية
function toggleSideEffects(show){ document.getElementById('sideEffects').style.display=show?'block':'none'; }
function triggerEffect(){ document.body.style.backgroundColor="#ffe0e0"; setTimeout(()=>{document.body.style.backgroundColor="#f0f2f5";},500);}
function startBubbles(){ 
let container=document.getElementById('bubbleContainer'); container.innerHTML='';
for(let i=0;i<20;i++){
let bubble=document.createElement('div'); bubble.className='bubble';
bubble.style.width=(10+Math.random()*20)+'px'; bubble.style.height=bubble.style.width;
bubble.style.left=Math.random()*100+'%';
bubble.style.backgroundColor=`hsla(${Math.random()*360},70%,60%,0.5)`;
bubble.style.animationDuration=(5+Math.random()*5)+'s';
container.appendChild(bubble);
