<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù†Ø¸Ø§Ù… Ø­Ø³Ø§Ø¨ Ø¬Ø±Ø¹Ø§Øª Ø§Ù„ØªØ®Ø¯ÙŠØ± - ÙƒØ§Ù…Ù„</title>
<style>
body{font-family:Arial,sans-serif;direction:rtl;background:#f0f2f5;margin:0;padding:20px}
.wrap{max-width:1000px;margin:0 auto}
h1{color:#0a5275}
.row{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px}
.btn{padding:10px 14px;border-radius:8px;border:none;background:#007bff;color:#fff;cursor:pointer}
.btn:active{transform:translateY(1px)}
.panel{background:#fff;padding:18px;border-radius:12px;box-shadow:0 4px 18px rgba(0,0,0,.06);margin-top:16px}
label{display:block;text-align:right;margin:6px 0}
input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #cfcfcf;margin-top:6px}
.sideEffect{background:#fff6f6;border-left:4px solid #ff6b6b;padding:10px;margin:8px 0;border-radius:6px;text-align:right}
.chatBox{height:200px;overflow:auto;padding:10px;background:#eef2f7;border-radius:8px}
.muted{color:#666;font-size:13px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
</style>
</head>
<body>
<div class="wrap">
<h1>ğŸš‘ Ù†Ø¸Ø§Ù… Ø­Ø³Ø§Ø¨ Ø¬Ø±Ø¹Ø§Øª Ø§Ù„ØªØ®Ø¯ÙŠØ± - ÙƒØ§Ù…Ù„</h1>

<div class="row">
<button class="btn" id="showDose">Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª</button>
<button class="btn" id="showFluids">Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ ÙˆØ§Ù„Ø¯Ù…</button>
<button class="btn" id="showAirway">Ø§Ù„Ø§Ø±Ù†ØºÙˆØ³ÙƒÙˆØ¨ Ùˆ ETT</button>
<button class="btn" id="showAdmin">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
</div>

<!-- Ù‚Ø³Ù… Ø§Ù„Ø¬Ø±Ø¹Ø§Øª -->
<div class="panel" id="panelDose" style="display:none">
<h2>ğŸ’‰ Ø­Ø³Ø§Ø¨ Ø¬Ø±Ø¹Ø§Øª Ø§Ù„ØªØ®Ø¯ÙŠØ±</h2>
<div class="grid">
<div>
<label>ÙˆØ²Ù† Ø§Ù„Ù…Ø±ÙŠØ¶ (ÙƒØº)
<input id="weightDose" type="number" min="0" step="0.1" placeholder="Ù…Ø«Ù„Ø§Ù‹: 70">
</label>
<label>Ø¹Ù…Ø± Ø§Ù„Ù…Ø±ÙŠØ¶
<div style="display:flex;gap:8px">
<input id="ageDose" type="number" min="0" step="1" placeholder="Ø¶Ø¹ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¹Ù…Ø±">
<select id="ageUnitDose" style="width:150px">
<option value="years">Ø³Ù†ÙˆØ§Øª</option>
<option value="months">Ø£Ø´Ù‡Ø±</option>
<option value="days">Ø£ÙŠØ§Ù…</option>
</select>
</div>
</label>
<label>Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø±ÙŠØ¶
<select id="patientCondition">
<option value="healthy">Ø³Ù„ÙŠÙ…</option>
<option value="sick">Ù…Ø±ÙŠØ¶</option>
<option value="chronic">Ù…Ø±Ø¶ Ù…Ø²Ù…Ù†</option>
</select>
</label>
<label>Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆØ§Ø¡
<select id="drugDose"></select>
</label>
<button class="btn" id="calcDose">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¬Ø±Ø¹Ø©</button>
</div>
<div>
<div id="doseResult" class="muted">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§</div>
<div id="doseEffects" style="margin-top:12px"></div>
</div>
</div>

<hr style="margin:12px 0">

<h3>ğŸ’¬ Ø´Ø§Øª AI Ø·Ø¨ÙŠ</h3>
<div class="chatBox" id="doseChat"></div>
<textarea id="doseChatInput" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." style="margin-top:8px"></textarea>
<div style="margin-top:8px">
<button class="btn" id="doseChatSend">Ø£Ø±Ø³Ù„</button>
</div>
</div>

<!-- Ù‚Ø³Ù… Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ -->
<div class="panel" id="panelFluids" style="display:none">
<h2>ğŸ’§ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ ÙˆØ§Ù„Ø¯Ù…</h2>
<div class="grid">
<div>
<label>ÙˆØ²Ù† Ø§Ù„Ù…Ø±ÙŠØ¶ (ÙƒØº)
<input id="weightFluids" type="number" min="0" step="0.1">
</label>
<label>Ø¹Ù…Ø± Ø§Ù„Ù…Ø±ÙŠØ¶
<div style="display:flex;gap:8px">
<input id="ageFluids" type="number" min="0" step="1">
<select id="ageUnitFluids" style="width:150px">
<option value="years">Ø³Ù†ÙˆØ§Øª</option>
<option value="months">Ø£Ø´Ù‡Ø±</option>
<option value="days">Ø£ÙŠØ§Ù…</option>
</select>
</div>
</label>
<button class="btn" id="calcFluids">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø³ÙˆØ§Ø¦Ù„/Ø§Ù„Ø¯Ù…</button>
</div>
<div>
<div id="fluidsResult" class="muted">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§</div>
</div>
</div>

<hr style="margin:12px 0">
<h3>ğŸ’¬ Ø´Ø§Øª AI Ø·Ø¨ÙŠ</h3>
<div class="chatBox" id="fluidsChat"></div>
<textarea id="fluidsChatInput" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." style="margin-top:8px"></textarea>
<div style="margin-top:8px">
<button class="btn" id="fluidsChatSend">Ø£Ø±Ø³Ù„</button>
</div>
</div>

<!-- Ù‚Ø³Ù… Ø§Ù„Ù„Ø§Ø±Ù†ØºÙˆØ³ÙƒÙˆØ¨/ETT -->
<div class="panel" id="panelAirway" style="display:none">
<h2>ğŸ˜· Ø§Ù„Ù„Ø§Ø±Ù†ØºÙˆØ³ÙƒÙˆØ¨ Ùˆ ETT</h2>
<div class="grid">
<div>
<label>Ø¹Ù…Ø± Ø§Ù„Ù…Ø±ÙŠØ¶
<div style="display:flex;gap:8px">
<input id="ageAirway" type="number" min="0" step="1">
<select id="ageUnitAirway" style="width:150px">
<option value="years">Ø³Ù†ÙˆØ§Øª</option>
<option value="months">Ø£Ø´Ù‡Ø±</option>
<option value="days">Ø£ÙŠØ§Ù…</option>
</select>
</div>
</label>
<label>ÙˆØ²Ù† Ø§Ù„Ù…Ø±ÙŠØ¶ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
<input id="weightAirway" type="number" step="0.1">
</label>
<button class="btn" id="calcAirway">Ø­Ø³Ø§Ø¨ Ø§Ù„Ø­Ø¬Ù…</button>
</div>
<div>
<div id="airwayResult" class="muted">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§</div>
</div>
</div>

<hr style="margin:12px 0">
<h3>ğŸ’¬ Ø´Ø§Øª AI Ø·Ø¨ÙŠ</h3>
<div class="chatBox" id="airwayChat"></div>
<textarea id="airwayChatInput" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." style="margin-top:8px"></textarea>
<div style="margin-top:8px">
<button class="btn" id="airwayChatSend">Ø£Ø±Ø³Ù„</button>
</div>
</div>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
<div class="panel" id="panelAdmin" style="display:none">
<h2>ğŸ”§ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ù…Ø§Ù„Ùƒ)</h2>
<label>ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø§Ù„Ùƒ
<input id="adminPass" type="password">
</label>
<div style="margin-top:8px">
<button class="btn" id="adminLogin">Ø¯Ø®ÙˆÙ„</button>
</div>

<div id="adminArea" style="display:none;margin-top:12px">
<h3>ØªØ¹Ø¯ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø£Ø¯ÙˆÙŠØ© ÙˆØ§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ù…Ø¤Ù‚ØªØ§Ù‹</h3>
<textarea id="adminEdit" rows="6" placeholder="ØµÙŠØºØ© ÙƒÙ„ Ø³Ø·Ø±: Drug,Dose,SideEffects,Management"></textarea>
<div style="margin-top:8px">
<button class="btn" id="adminSave">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
</div>
</div>
</div>

<script type="module">
import OpenAI from "https://cdn.jsdelivr.net/npm/openai@4.9.0/dist/openai.min.js";

const openai = new OpenAI({
  apiKey: "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"
});

// ---------- Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø£Ø¯ÙˆÙŠØ© ----------
let drugData = {
"Propofol": {doses:[{dose:"2â€“6 mg/kg IV (induction)", side_effects:["Ø§Ù†Ø®ÙØ§Ø¶ Ø¶ØºØ· Ø§Ù„Ø¯Ù…","ØªÙˆÙ‚Ù ØªÙ†ÙØ³ Ù…Ø¤Ù‚Øª","Ø£Ù„Ù… Ø¹Ù†Ø¯ Ø§Ù„Ø­Ù‚Ù†"], management:["Ø§Ù„ØªÙ‡ÙˆÙŠØ© Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠØ© + Ø£ÙƒØ³Ø¬ÙŠÙ†","Ø¥Ø¨Ø·Ø§Ø¡ Ø§Ù„Ø­Ù‚Ù†","Ø§Ø³ØªØ®Ø¯Ø§Ù… Lidocaine Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø£Ù„Ù…"]}]},
"Midazolam": {doses:[{dose:"0.07â€“0.2 mg/kg IV/IM", side_effects:["ØªÙ‡Ø¯Ø¦Ø© Ù…ÙØ±Ø·Ø©","Ø§Ù†Ø®ÙØ§Ø¶ Ø¶ØºØ·","Ø±Ø¯ ÙØ¹Ù„ Ø¹ÙƒØ³ÙŠ (Ù‡ÙŠØ§Ø¬)"], management:["Flumazenil ÙƒÙ…Ø¶Ø§Ø¯ 0.01 mg/kg IV","ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¬Ø±Ø¹Ø© Ø£Ùˆ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¯ÙˆØ§Ø¡"]}]},
"Fentanyl": {doses:[{dose:"2â€“10 Âµg/kg IV bolus Ø£Ùˆ CRI 2â€“10 Âµg/kg/h", side_effects:["ØªØ«Ø¨ÙŠØ· ØªÙ†ÙØ³ÙŠ","ØªØ¨Ø§Ø·Ø¤ Ù‚Ù„Ø¨","ØºØ«ÙŠØ§Ù† / ØªÙ‚ÙŠØ¤"], management:["Naloxone ÙƒÙ…Ø¶Ø§Ø¯ 0.02â€“0.04 mg/kg IV","Ø¯Ø¹Ù… ØªÙ†ÙØ³ÙŠ ÙˆØ£ÙƒØ³Ø¬ÙŠÙ†"]}]},
"Ketamine": {doses:[{dose:"5 mg/kg IV Ø£Ùˆ 10 mg/kg IM", side_effects:["Ø²ÙŠØ§Ø¯Ø© Ø¶ØºØ· Ø§Ù„Ø¯Ù…","ØªÙŠØ¨Ù‘Ø³ Ø¹Ø¶Ù„ÙŠ","Ù‡Ù„ÙˆØ³Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¥ÙØ§Ù‚Ø©"], management:["Midazolam Ø£Ùˆ Diazepam Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù‡Ù„ÙˆØ³Ø©","Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù‚Ù„Ø¨ ÙˆØ§Ù„ØªÙ†ÙØ³","Ø¨ÙŠØ¦Ø© Ù‡Ø§Ø¯Ø¦Ø©"]}]},
"Thiopental": {doses:[{dose:"10â€“15 mg/kg IV (induction)", side_effects:["ØªØ«Ø¨ÙŠØ· ØªÙ†ÙØ³ÙŠ Ø­Ø§Ø¯","Ø§Ù†Ø®ÙØ§Ø¶ Ø¶ØºØ·","ØªØ®Ø¯ÙŠØ± Ù…Ø·ÙˆÙ‘Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„Ø¹Ø§Ù„ÙŠØ©"], management:["Ø£ÙƒØ³Ø¬ÙŠÙ† + ØªÙ‡ÙˆÙŠØ©","Ø¯Ø¹Ù… Ø¶ØºØ· Ø§Ù„Ø¯Ù… (IV Fluids, Vasopressors)"]}]},
"Etomidate": {doses:[{dose:"0.2â€“0.4 mg/kg IV", side_effects:["Myoclonus","ÙƒØ¨Øª Ø§Ù„ØºØ¯Ø© Ø§Ù„ÙƒØ¸Ø±ÙŠØ©","ØºØ«ÙŠØ§Ù† ÙˆØªÙ‚ÙŠØ¤"], management:["Benzodiazepines Ù„Ù„Ø­Ø¯ Ù…Ù† Myoclonus","Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‚ØµÙŠØ± ÙÙ‚Ø·","Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ÙƒÙˆØ±ØªÙŠØ²ÙˆÙ„"]}]},
"Dexmedetomidine": {doses:[{dose:"5â€“10 Âµg/kg IM Ø£Ùˆ IV", side_effects:["Ø¨Ø·Ø¡ Ù‚Ù„Ø¨ (Bradycardia)","Ø§Ø±ØªÙØ§Ø¹ Ø¶ØºØ· Ø«Ù… Ø§Ù†Ø®ÙØ§Ø¶","Ø¥Ù‚ÙŠØ§Ø¡"], management:["Atipamezole ÙƒÙ…Ø¶Ø§Ø¯ 50 Âµg/kg IM","Ù…Ø±Ø§Ù‚Ø¨Ø© Ù‚Ù„Ø¨ÙŠØ© Ø¯Ù‚ÙŠÙ‚Ø©"]}]},
"Isoflurane": {doses:[{dose:"MAC 1.3â€“1.6%", side_effects:["Ø§Ù†Ø®ÙØ§Ø¶ Ø¶ØºØ· Ø¬Ø±Ø¹Ø©-Ù…Ø¹ØªÙ…Ø¯","ÙƒØ¨Øª ØªÙ†ÙØ³ÙŠ","ØªØ­Ø³Ø³ Ø¹Ø¶Ù„Ø© Ø§Ù„Ù‚Ù„Ø¨ Ù„Ù„Ø£Ø¯Ø±ÙŠÙ†Ø§Ù„ÙŠÙ†"], management:["ØªØ¹Ø¯ÙŠÙ„ ØªØ±ÙƒÙŠØ² Ø§Ù„ØºØ§Ø²","Ø¯Ø¹Ù… Ø§Ù„ØªÙ†ÙØ³ ÙˆØ§Ù„Ø¶ØºØ·"]}]},
"Succinylcholine": {doses:[{dose:"1â€“2 mg/kg IV", side_effects:["Ø´Ù„Ù„ Ø¹Ø¶Ù„ÙŠ ÙƒØ§Ù…Ù„ Ù…Ø¤Ù‚Øª","Hyperkalemia","Malignant Hyperthermia (Ù†Ø§Ø¯Ø±)"], management:["ØªÙ‡ÙˆÙŠØ© Ø§ØµØ·Ù†Ø§Ø¹ÙŠØ© Ø¥Ù„Ø²Ø§Ù…ÙŠØ©","Dantrolene ÙÙŠ Ø­Ø§Ù„ Ø­Ø¯ÙˆØ« MH","ØªØ¬Ù†Ù‘Ø¨ ÙÙŠ Ù…Ø±Ø¶Ù‰ Ø§Ù„Ø­Ø±ÙˆÙ‚ Ø£Ùˆ Ø¥ØµØ§Ø¨Ø§Øª Ø§Ù„Ø¹Ø¶Ù„Ø§Øª"]}]},
"Lidocaine": {doses:[{dose:"2â€“4 mg/kg IV bolus Ø£Ùˆ CRI 25â€“50 Âµg/kg/min", side_effects:["ØªØ´Ù†Ø¬Ø§Øª","Ø§Ù†Ø®ÙØ§Ø¶ Ø¶ØºØ·","Ø¨Ø·Ø¡ Ù‚Ù„Ø¨"], management:["Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø±ÙŠØ¨ ÙÙˆØ±Ø§Ù‹","Benzodiazepines Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„ØªØ´Ù†Ø¬Ø§Øª","Ø¯Ø¹Ù… Ø§Ù„Ø¶ØºØ· ÙˆØ§Ù„Ø³ÙˆØ§Ø¦Ù„"]}]},
"Bupivacaine": {doses:[{dose:"2 mg/kg ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰ (Ù…ÙˆØ¶Ø¹ÙŠ)", side_effects:["Ø³Ù…ÙŠØ© Ù‚Ù„Ø¨ÙŠØ© (arrhythmias)","ØªØ´Ù†Ø¬Ø§Øª","ØªØ«Ø¨ÙŠØ· ØªÙ†ÙØ³ÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ù‚Ù† IV Ø¨Ø§Ù„Ø®Ø·Ø£"], management:["Intralipid Therapy 20% (1.5 ml/kg bolus)","CPR ÙˆØ¯Ø¹Ù… ØªÙ†ÙØ³ÙŠ"]}]}};

// ------------------- Ø¨Ø§Ù‚ÙŠ ÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ÙˆØ­Ø³Ø§Ø¨ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª ÙˆØ§Ù„Ø³ÙˆØ§Ø¦Ù„ ÙˆØ§Ù„Ù„Ø§Ø±Ùˆ ------------------
// Ø¨Ø³Ø¨Ø¨ Ø·ÙˆÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ÙƒØ§Ù…Ù„ØŒ Ø³Ø£ÙƒÙ…Ù„ Ù„Ùƒ Ø¨Ù‚ÙŠØ© Ø§Ù„Ø³ÙƒØ±ÙŠØ¨ØªØ§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ù„Ø­Ø³Ø§Ø¨ ÙˆØ´Ø§Øª AI ÙˆØ±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ø±Ø³Ø§Ù„Ø© ØªØ§Ù„ÙŠØ©
</script>
</body>
</html>
<script>
// -------------------- ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£Ù‚Ø³Ø§Ù… --------------------
const panelDose = document.getElementById('panelDose');
const panelFluids = document.getElementById('panelFluids');
const panelAirway = document.getElementById('panelAirway');
const panelAdmin = document.getElementById('panelAdmin');

document.getElementById('showDose').onclick = ()=>{panelDose.style.display='block';panelFluids.style.display='none';panelAirway.style.display='none';panelAdmin.style.display='none';};
document.getElementById('showFluids').onclick = ()=>{panelDose.style.display='none';panelFluids.style.display='block';panelAirway.style.display='none';panelAdmin.style.display='none';};
document.getElementById('showAirway').onclick = ()=>{panelDose.style.display='none';panelFluids.style.display='none';panelAirway.style.display='block';panelAdmin.style.display='none';};
document.getElementById('showAdmin').onclick = ()=>{panelDose.style.display='none';panelFluids.style.display='none';panelAirway.style.display='none';panelAdmin.style.display='block';};

// -------------------- Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¯ÙˆÙŠØ© --------------------
const drugSelect = document.getElementById('drugDose');
for(let drug in drugData){
    let opt = document.createElement('option');
    opt.value = drug;
    opt.textContent = drug;
    drugSelect.appendChild(opt);
}

// -------------------- Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¬Ø±Ø¹Ø© --------------------
function calculateDose(weight, drug){
    let data = drugData[drug].doses[0]; // Ø£Ø¨Ø³Ø· Ø§Ø®ØªÙŠØ§Ø± Ø£ÙˆÙ„ Ø¬Ø±Ø¹Ø©
    let doseText = `${data.dose.replace(/mg\/kg|Âµg\/kg/g, (match)=>{
        if(match.includes('mg')) return (parseFloat(match.match(/\d+/)[0])*weight).toFixed(2)+' mg';
        else return (parseFloat(match.match(/\d+/)[0])*weight*1000).toFixed(2)+' Âµg';
    })}`;
    return {doseText, sideEffects:data.side_effects, management:data.management};
}

document.getElementById('calcDose').onclick = ()=>{
    let weight = parseFloat(document.getElementById('weightDose').value);
    let drug = document.getElementById('drugDose').value;
    if(!weight || !drug) {alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙˆØ²Ù† ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯ÙˆØ§Ø¡'); return;}
    let result = calculateDose(weight, drug);
    document.getElementById('doseResult').innerHTML = `<b>Ø§Ù„Ø¬Ø±Ø¹Ø©:</b> ${result.doseText}`;
    let effHTML = '';
    result.sideEffects.forEach((se,i)=>{
        effHTML+=`<div class="sideEffect"><b>Ø¹Ø±Ø¶ Ø¬Ø§Ù†Ø¨ÙŠ:</b> ${se}<br><b>Ø§Ù„ØªØ¹Ø§Ù…Ù„:</b> ${result.management[i]}</div>`;
    });
    document.getElementById('doseEffects').innerHTML = effHTML;
};

// -------------------- Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ --------------------
document.getElementById('calcFluids').onclick = ()=>{
    let weight = parseFloat(document.getElementById('weightFluids').value);
    if(!weight){alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙˆØ²Ù†'); return;}
    let maintenance = (weight*4).toFixed(0)+' ml/h (Ø³Ø§Ø¦Ù„ ØµÙŠØ§Ù†Ø© ØªÙ‚Ø±ÙŠØ¨ÙŠ)';
    let blood = (weight*70).toFixed(0)+' ml (Ø­Ø¬Ù… Ø¯Ù… ØªÙ‚Ø±ÙŠØ¨ÙŠ)';
    document.getElementById('fluidsResult').innerHTML = `<b>Ø³Ø§Ø¦Ù„ ØµÙŠØ§Ù†Ø©:</b> ${maintenance}<br><b>Ø­Ø¬Ù… Ø§Ù„Ø¯Ù…:</b> ${blood}`;
};

// -------------------- Ø­Ø³Ø§Ø¨ Ø­Ø¬Ù… Ø§Ù„Ù„Ø§Ø±Ù†ØºÙˆØ³ÙƒÙˆØ¨ --------------------
document.getElementById('calcAirway').onclick = ()=>{
    let age = parseInt(document.getElementById('ageAirway').value);
    let weight = parseFloat(document.getElementById('weightAirway').value);
    if(!age){alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ù…Ø±'); return;}
    let blade='', ett='';
    if(age<1){blade='Size 0â€“1';ett='3.0â€“3.5 mm';}
    else if(age<5){blade='Size 1â€“2';ett='4.0â€“4.5 mm';}
    else if(age<10){blade='Size 2';ett='5.0â€“5.5 mm';}
    else{blade='Size 3â€“4';ett='6.0â€“7.0 mm';}
    document.getElementById('airwayResult').innerHTML = `<b>Ø­Ø¬Ù… Ø§Ù„Ù„Ø§Ø±Ù†ØºÙˆØ³ÙƒÙˆØ¨:</b> ${blade}<br><b>Ø­Ø¬Ù… ETT:</b> ${ett}`;
};

// -------------------- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… --------------------
document.getElementById('adminLogin').onclick = ()=>{
    let pass = document.getElementById('adminPass').value;
    if(pass==='mustafa@2006#2'){
        document.getElementById('adminArea').style.display='block';
    }else alert('ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©');
};

document.getElementById('adminSave').onclick = ()=>{
    let val = document.getElementById('adminEdit').value.split('\n');
    val.forEach(line=>{
        let [drug,dose,se,mgmt] = line.split(',');
        if(drug && dose){drugData[drug]={doses:[{dose,dose,side_effects:[se],management:[mgmt]}]};}
    });
    alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù…Ø¤Ù‚ØªØ§Ù‹');
};

// -------------------- Ø´Ø§Øª AI --------------------
async function sendToAI(prompt,chatBox){
    let res = await openai.chat.completions.create({
        model: "gpt-4o-mini",
        messages: [{role:"user", content:prompt}],
        temperature:0.2
    });
    let reply = res.choices[0].message.content;
    chatBox.innerHTML+=`<div><b>AI:</b> ${reply}</div>`;
    chatBox.scrollTop = chatBox.scrollHeight;
}

// Ø±Ø¨Ø· Ø´Ø§Øª Ø§Ù„Ø¬Ø±Ø¹Ø§Øª
document.getElementById('doseChatSend').onclick = ()=>{
    let msg = document.getElementById('doseChatInput').value;
    if(!msg) return;
    let chatBox = document.getElementById('doseChat');
    chatBox.innerHTML+=`<div><b>Ø£Ù†Øª:</b> ${msg}</div>`;
    document.getElementById('doseChatInput').value='';
    sendToAI(msg,chatBox);
};

// Ø±Ø¨Ø· Ø´Ø§Øª Ø§Ù„Ø³ÙˆØ§Ø¦Ù„
document.getElementById('fluidsChatSend').onclick = ()=>{
    let msg = document.getElementById('fluidsChatInput').value;
    if(!msg) return;
    let chatBox = document.getElementById('fluidsChat');
    chatBox.innerHTML+=`<div><b>Ø£Ù†Øª:</b> ${msg}</div>`;
    document.getElementById('fluidsChatInput').value='';
    sendToAI(msg,chatBox);
};

// Ø±Ø¨Ø· Ø´Ø§Øª Airway
document.getElementById('airwayChatSend').onclick = ()=>{
    let msg = document.getElementById('airwayChatInput').value;
    if(!msg) return;
    let chatBox = document.getElementById('airwayChat');
    chatBox.innerHTML+=`<div><b>Ø£Ù†Øª:</b> ${msg}</div>`;
    document.getElementById('airwayChatInput').value='';
    sendToAI(msg,chatBox);
};
      </script>
