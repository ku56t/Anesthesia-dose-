<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ูุธุงู ุญุณุงุจ ุฌุฑุนุงุช ุงูุชุฎุฏูุฑ - ูุงูู</title>
<style>
body{font-family:Arial,sans-serif;direction:rtl;background:#f0f2f5;margin:0;padding:20px}
.wrap{max-width:1000px;margin:0 auto}
h1{color:#0a5275}
.row{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px}
.btn{padding:10px 14px;border-radius:8px;border:none;background:#007bff;color:#fff;cursor:pointer}
.btn:active{transform:translateY(1px)}
.panel{background:#fff;padding:18px;border-radius:12px;box-shadow:0 4px 18px rgba(0,0,0,.06);margin-top:16px}
label{display:block;text-align:right;margin:6px 0}
input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #cfcfcf;margin-top:6px}
.sideEffect{background:#fff6f6;border-left:4px solid #ff6b6b;padding:10px;margin:8px 0;border-radius:6px;text-align:right}
.chatBox{height:200px;overflow:auto;padding:10px;background:#eef2f7;border-radius:8px}
.muted{color:#666;font-size:13px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
</style>
</head>
<body>
<div class="wrap">
<h1>๐ ูุธุงู ุญุณุงุจ ุฌุฑุนุงุช ุงูุชุฎุฏูุฑ - ูุงูู</h1>

<div class="row">
<button class="btn" id="showDose">ุญุณุงุจ ุงูุฌุฑุนุงุช</button>
<button class="btn" id="showFluids">ุญุณุงุจ ุงูุณูุงุฆู ูุงูุฏู</button>
<button class="btn" id="showAirway">ุงูุงุฑูุบูุณููุจ ู ETT</button>
<button class="btn" id="showAdmin">ููุญุฉ ุงูุชุญูู</button>
</div>

<!-- ูุณู ุงูุฌุฑุนุงุช -->
<div class="panel" id="panelDose" style="display:none">
<h2>๐ ุญุณุงุจ ุฌุฑุนุงุช ุงูุชุฎุฏูุฑ</h2>
<div class="grid">
<div>
<label>ูุฒู ุงููุฑูุถ (ูุบ)
<input id="weightDose" type="number" min="0" step="0.1" placeholder="ูุซูุงู: 70">
</label>
<label>ุนูุฑ ุงููุฑูุถ
<div style="display:flex;gap:8px">
<input id="ageDose" type="number" min="0" step="1" placeholder="ุถุน ูููุฉ ุงูุนูุฑ">
<select id="ageUnitDose" style="width:150px">
<option value="years">ุณููุงุช</option>
<option value="months">ุฃุดูุฑ</option>
<option value="days">ุฃูุงู</option>
</select>
</div>
</label>
<label>ุญุงูุฉ ุงููุฑูุถ
<select id="patientCondition">
<option value="healthy">ุณููู</option>
<option value="sick">ูุฑูุถ</option>
<option value="chronic">ูุฑุถ ูุฒูู</option>
</select>
</label>
<label>ุงุฎุชุฑ ุงูุฏูุงุก
<select id="drugDose"></select>
</label>
<button class="btn" id="calcDose">ุงุญุณุจ ุงูุฌุฑุนุฉ</button>
</div>
<div>
<div id="doseResult" class="muted">ุงููุชูุฌุฉ ุณุชุธูุฑ ููุง</div>
<div id="doseEffects" style="margin-top:12px"></div>
</div>
</div>

<hr style="margin:12px 0">

<h3>๐ฌ ุดุงุช AI ุทุจู</h3>
<div class="chatBox" id="doseChat"></div>
<textarea id="doseChatInput" placeholder="ุงูุชุจ ุณุคุงูู ููุง..." style="margin-top:8px"></textarea>
<div style="margin-top:8px">
<button class="btn" id="doseChatSend">ุฃุฑุณู</button>
</div>
</div>

<!-- ูุณู ุงูุณูุงุฆู -->
<div class="panel" id="panelFluids" style="display:none">
<h2>๐ง ุญุณุงุจ ุงูุณูุงุฆู ูุงูุฏู</h2>
<div class="grid">
<div>
<label>ูุฒู ุงููุฑูุถ (ูุบ)
<input id="weightFluids" type="number" min="0" step="0.1">
</label>
<label>ุนูุฑ ุงููุฑูุถ
<div style="display:flex;gap:8px">
<input id="ageFluids" type="number" min="0" step="1">
<select id="ageUnitFluids" style="width:150px">
<option value="years">ุณููุงุช</option>
<option value="months">ุฃุดูุฑ</option>
<option value="days">ุฃูุงู</option>
</select>
</div>
</label>
<button class="btn" id="calcFluids">ุงุญุณุจ ุงูุณูุงุฆู/ุงูุฏู</button>
</div>
<div>
<div id="fluidsResult" class="muted">ุงููุชูุฌุฉ ุณุชุธูุฑ ููุง</div>
</div>
</div>

<hr style="margin:12px 0">
<h3>๐ฌ ุดุงุช AI ุทุจู</h3>
<div class="chatBox" id="fluidsChat"></div>
<textarea id="fluidsChatInput" placeholder="ุงูุชุจ ุณุคุงูู ููุง..." style="margin-top:8px"></textarea>
<div style="margin-top:8px">
<button class="btn" id="fluidsChatSend">ุฃุฑุณู</button>
</div>
</div>

<!-- ูุณู ุงููุงุฑูุบูุณููุจ/ETT -->
<div class="panel" id="panelAirway" style="display:none">
<h2>๐ท ุงููุงุฑูุบูุณููุจ ู ETT</h2>
<div class="grid">
<div>
<label>ุนูุฑ ุงููุฑูุถ
<div style="display:flex;gap:8px">
<input id="ageAirway" type="number" min="0" step="1">
<select id="ageUnitAirway" style="width:150px">
<option value="years">ุณููุงุช</option>
<option value="months">ุฃุดูุฑ</option>
<option value="days">ุฃูุงู</option>
</select>
</div>
</label>
<label>ูุฒู ุงููุฑูุถ (ุงุฎุชูุงุฑู)
<input id="weightAirway" type="number" step="0.1">
</label>
<button class="btn" id="calcAirway">ุญุณุงุจ ุงูุญุฌู</button>
</div>
<div>
<div id="airwayResult" class="muted">ุงููุชูุฌุฉ ุณุชุธูุฑ ููุง</div>
</div>
</div>

<hr style="margin:12px 0">
<h3>๐ฌ ุดุงุช AI ุทุจู</h3>
<div class="chatBox" id="airwayChat"></div>
<textarea id="airwayChatInput" placeholder="ุงูุชุจ ุณุคุงูู ููุง..." style="margin-top:8px"></textarea>
<div style="margin-top:8px">
<button class="btn" id="airwayChatSend">ุฃุฑุณู</button>
</div>
</div>

<!-- ููุญุฉ ุงูุชุญูู -->
<div class="panel" id="panelAdmin" style="display:none">
<h2>๐ง ููุญุฉ ุงูุชุญูู (ูุงูู)</h2>
<label>ูููุฉ ูุฑูุฑ ุงููุงูู
<input id="adminPass" type="password">
</label>
<div style="margin-top:8px">
<button class="btn" id="adminLogin">ุฏุฎูู</button>
</div>

<div id="adminArea" style="display:none;margin-top:12px">
<h3>ุชุนุฏูู ูุงุนุฏุฉ ุงูุฃุฏููุฉ ูุงูุฃุนุฑุงุถ ูุคูุชุงู</h3>
<textarea id="adminEdit" rows="6" placeholder="ุตูุบุฉ ูู ุณุทุฑ: Drug,Dose,SideEffects,Management"></textarea>
<div style="margin-top:8px">
<button class="btn" id="adminSave">ุญูุธ ุงูุชุนุฏููุงุช</button>
</div>
</div>
</div>

<script type="module">
import OpenAI from "https://cdn.jsdelivr.net/npm/openai@4.9.0/dist/openai.min.js";

const openai = new OpenAI({
  apiKey: "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"
});

// ---------- ูุงุนุฏุฉ ุงูุฃุฏููุฉ ----------
let drugData = {
"Propofol": {doses:[{dose:"2โ6 mg/kg IV (induction)", side_effects:["ุงูุฎูุงุถ ุถุบุท ุงูุฏู","ุชููู ุชููุณ ูุคูุช","ุฃูู ุนูุฏ ุงูุญูู"], management:["ุงูุชูููุฉ ุงูุงุตุทูุงุนูุฉ + ุฃูุณุฌูู","ุฅุจุทุงุก ุงูุญูู","ุงุณุชุฎุฏุงู Lidocaine ูุชูููู ุงูุฃูู"]}]},
"Midazolam": {doses:[{dose:"0.07โ0.2 mg/kg IV/IM", side_effects:["ุชูุฏุฆุฉ ููุฑุทุฉ","ุงูุฎูุงุถ ุถุบุท","ุฑุฏ ูุนู ุนูุณู (ููุงุฌ)"], management:["Flumazenil ููุถุงุฏ 0.01 mg/kg IV","ุชูููู ุงูุฌุฑุนุฉ ุฃู ุฅููุงู ุงูุฏูุงุก"]}]},
"Fentanyl": {doses:[{dose:"2โ10 ยตg/kg IV bolus ุฃู CRI 2โ10 ยตg/kg/h", side_effects:["ุชุซุจูุท ุชููุณู","ุชุจุงุทุค ููุจ","ุบุซูุงู / ุชููุค"], management:["Naloxone ููุถุงุฏ 0.02โ0.04 mg/kg IV","ุฏุนู ุชููุณู ูุฃูุณุฌูู"]}]},
"Ketamine": {doses:[{dose:"5 mg/kg IV ุฃู 10 mg/kg IM", side_effects:["ุฒูุงุฏุฉ ุถุบุท ุงูุฏู","ุชูุจูุณ ุนุถูู","ูููุณุฉ ุนูุฏ ุงูุฅูุงูุฉ"], management:["Midazolam ุฃู Diazepam ูุชูููู ุงููููุณุฉ","ูุฑุงูุจุฉ ุงูููุจ ูุงูุชููุณ","ุจูุฆุฉ ูุงุฏุฆุฉ"]}]},
"Thiopental": {doses:[{dose:"10โ15 mg/kg IV (induction)", side_effects:["ุชุซุจูุท ุชููุณู ุญุงุฏ","ุงูุฎูุงุถ ุถุบุท","ุชุฎุฏูุฑ ูุทููู ุนูุฏ ุงูุฌุฑุนุฉ ุงูุนุงููุฉ"], management:["ุฃูุณุฌูู + ุชูููุฉ","ุฏุนู ุถุบุท ุงูุฏู (IV Fluids, Vasopressors)"]}]},
"Etomidate": {doses:[{dose:"0.2โ0.4 mg/kg IV", side_effects:["Myoclonus","ูุจุช ุงูุบุฏุฉ ุงููุธุฑูุฉ","ุบุซูุงู ูุชููุค"], management:["Benzodiazepines ููุญุฏ ูู Myoclonus","ุงุณุชุฎุฏุงู ูุตูุฑ ููุท","ูุฑุงูุจุฉ ุงูููุฑุชูุฒูู"]}]},
"Dexmedetomidine": {doses:[{dose:"5โ10 ยตg/kg IM ุฃู IV", side_effects:["ุจุทุก ููุจ (Bradycardia)","ุงุฑุชูุงุน ุถุบุท ุซู ุงูุฎูุงุถ","ุฅููุงุก"], management:["Atipamezole ููุถุงุฏ 50 ยตg/kg IM","ูุฑุงูุจุฉ ููุจูุฉ ุฏูููุฉ"]}]},
"Isoflurane": {doses:[{dose:"MAC 1.3โ1.6%", side_effects:["ุงูุฎูุงุถ ุถุบุท ุฌุฑุนุฉ-ูุนุชูุฏ","ูุจุช ุชููุณู","ุชุญุณุณ ุนุถูุฉ ุงูููุจ ููุฃุฏุฑููุงููู"], management:["ุชุนุฏูู ุชุฑููุฒ ุงูุบุงุฒ","ุฏุนู ุงูุชููุณ ูุงูุถุบุท"]}]},
"Succinylcholine": {doses:[{dose:"1โ2 mg/kg IV", side_effects:["ุดูู ุนุถูู ูุงูู ูุคูุช","Hyperkalemia","Malignant Hyperthermia (ูุงุฏุฑ)"], management:["ุชูููุฉ ุงุตุทูุงุนูุฉ ุฅูุฒุงููุฉ","Dantrolene ูู ุญุงู ุญุฏูุซ MH","ุชุฌููุจ ูู ูุฑุถู ุงูุญุฑูู ุฃู ุฅุตุงุจุงุช ุงูุนุถูุงุช"]}]},
"Lidocaine": {doses:[{dose:"2โ4 mg/kg IV bolus ุฃู CRI 25โ50 ยตg/kg/min", side_effects:["ุชุดูุฌุงุช","ุงูุฎูุงุถ ุถุบุท","ุจุทุก ููุจ"], management:["ุฅููุงู ุงูุชุณุฑูุจ ููุฑุงู","Benzodiazepines ูุนูุงุฌ ุงูุชุดูุฌุงุช","ุฏุนู ุงูุถุบุท ูุงูุณูุงุฆู"]}]},
"Bupivacaine": {doses:[{dose:"2 mg/kg ูุญุฏ ุฃูุตู (ููุถุนู)", side_effects:["ุณููุฉ ููุจูุฉ (arrhythmias)","ุชุดูุฌุงุช","ุชุซุจูุท ุชููุณู ุนูุฏ ุงูุญูู IV ุจุงูุฎุทุฃ"], management:["Intralipid Therapy 20% (1.5 ml/kg bolus)","CPR ูุฏุนู ุชููุณู"]}]}};

// ------------------- ุจุงูู ููุฏ ุงูุนูููุงุช ูุญุณุงุจ ุงูุฌุฑุนุงุช ูุงูุณูุงุฆู ูุงููุงุฑู ------------------
// ุจุณุจุจ ุทูู ุงูููุฏ ุงููุงููุ ุณุฃููู ูู ุจููุฉ ุงูุณูุฑูุจุชุงุช ุงููุงุฒูุฉ ููุญุณุงุจ ูุดุงุช AI ูุฑุจุท ุงูุฃุฒุฑุงุฑ ูู ุฑุณุงูุฉ ุชุงููุฉ
</script>
</body>
</html>
<script>
// -------------------- ูุธุงุฆู ุฅุธูุงุฑ ุงูุฃูุณุงู --------------------
const panelDose = document.getElementById('panelDose');
const panelFluids = document.getElementById('panelFluids');
const panelAirway = document.getElementById('panelAirway');
const panelAdmin = document.getElementById('panelAdmin');

document.getElementById('showDose').onclick = ()=>{panelDose.style.display='block';panelFluids.style.display='none';panelAirway.style.display='none';panelAdmin.style.display='none';};
document.getElementById('showFluids').onclick = ()=>{panelDose.style.display='none';panelFluids.style.display='block';panelAirway.style.display='none';panelAdmin.style.display='none';};
document.getElementById('showAirway').onclick = ()=>{panelDose.style.display='none';panelFluids.style.display='none';panelAirway.style.display='block';panelAdmin.style.display='none';};
document.getElementById('showAdmin').onclick = ()=>{panelDose.style.display='none';panelFluids.style.display='none';panelAirway.style.display='none';panelAdmin.style.display='block';};

// -------------------- ููุก ูุงุฆูุฉ ุงูุฃุฏููุฉ --------------------
const drugSelect = document.getElementById('drugDose');
for(let drug in drugData){
    let opt = document.createElement('option');
    opt.value = drug;
    opt.textContent = drug;
    drugSelect.appendChild(opt);
}

// -------------------- ุญุณุงุจ ุงูุฌุฑุนุฉ --------------------
function calculateDose(weight, drug){
    let data = drugData[drug].doses[0]; // ุฃุจุณุท ุงุฎุชูุงุฑ ุฃูู ุฌุฑุนุฉ
    let doseText = `${data.dose.replace(/mg\/kg|ยตg\/kg/g, (match)=>{
        if(match.includes('mg')) return (parseFloat(match.match(/\d+/)[0])*weight).toFixed(2)+' mg';
        else return (parseFloat(match.match(/\d+/)[0])*weight*1000).toFixed(2)+' ยตg';
    })}`;
    return {doseText, sideEffects:data.side_effects, management:data.management};
}

document.getElementById('calcDose').onclick = ()=>{
    let weight = parseFloat(document.getElementById('weightDose').value);
    let drug = document.getElementById('drugDose').value;
    if(!weight || !drug) {alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงููุฒู ูุงุฎุชูุงุฑ ุงูุฏูุงุก'); return;}
    let result = calculateDose(weight, drug);
    document.getElementById('doseResult').innerHTML = `<b>ุงูุฌุฑุนุฉ:</b> ${result.doseText}`;
    let effHTML = '';
    result.sideEffects.forEach((se,i)=>{
        effHTML+=`<div class="sideEffect"><b>ุนุฑุถ ุฌุงูุจู:</b> ${se}<br><b>ุงูุชุนุงูู:</b> ${result.management[i]}</div>`;
    });
    document.getElementById('doseEffects').innerHTML = effHTML;
};

// -------------------- ุญุณุงุจ ุงูุณูุงุฆู --------------------
document.getElementById('calcFluids').onclick = ()=>{
    let weight = parseFloat(document.getElementById('weightFluids').value);
    if(!weight){alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงููุฒู'); return;}
    let maintenance = (weight*4).toFixed(0)+' ml/h (ุณุงุฆู ุตูุงูุฉ ุชูุฑูุจู)';
    let blood = (weight*70).toFixed(0)+' ml (ุญุฌู ุฏู ุชูุฑูุจู)';
    document.getElementById('fluidsResult').innerHTML = `<b>ุณุงุฆู ุตูุงูุฉ:</b> ${maintenance}<br><b>ุญุฌู ุงูุฏู:</b> ${blood}`;
};

// -------------------- ุญุณุงุจ ุญุฌู ุงููุงุฑูุบูุณููุจ --------------------
document.getElementById('calcAirway').onclick = ()=>{
    let age = parseInt(document.getElementById('ageAirway').value);
    let weight = parseFloat(document.getElementById('weightAirway').value);
    if(!age){alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงูุนูุฑ'); return;}
    let blade='', ett='';
    if(age<1){blade='Size 0โ1';ett='3.0โ3.5 mm';}
    else if(age<5){blade='Size 1โ2';ett='4.0โ4.5 mm';}
    else if(age<10){blade='Size 2';ett='5.0โ5.5 mm';}
    else{blade='Size 3โ4';ett='6.0โ7.0 mm';}
    document.getElementById('airwayResult').innerHTML = `<b>ุญุฌู ุงููุงุฑูุบูุณููุจ:</b> ${blade}<br><b>ุญุฌู ETT:</b> ${ett}`;
};

// -------------------- ููุญุฉ ุงูุชุญูู --------------------
document.getElementById('adminLogin').onclick = ()=>{
    let pass = document.getElementById('adminPass').value;
    if(pass==='mustafa@2006#2'){
        document.getElementById('adminArea').style.display='block';
    }else alert('ูููุฉ ูุฑูุฑ ุฎุงุทุฆุฉ');
};

document.getElementById('adminSave').onclick = ()=>{
    let val = document.getElementById('adminEdit').value.split('\n');
    val.forEach(line=>{
        let [drug,dose,se,mgmt] = line.split(',');
        if(drug && dose){drugData[drug]={doses:[{dose,dose,side_effects:[se],management:[mgmt]}]};}
    });
    alert('ุชู ุญูุธ ุงูุชุนุฏููุงุช ูุคูุชุงู');
};

// -------------------- ุดุงุช AI --------------------
async function sendToAI(prompt,chatBox){
    let res = await openai.chat.completions.create({
        model: "gpt-4o-mini",
        messages: [{role:"user", content:prompt}],
        temperature:0.2
    });
    let reply = res.choices[0].message.content;
    chatBox.innerHTML+=`<div><b>AI:</b> ${reply}</div>`;
    chatBox.scrollTop = chatBox.scrollHeight;
}

// ุฑุจุท ุดุงุช ุงูุฌุฑุนุงุช
document.getElementById('doseChatSend').onclick = ()=>{
    let msg = document.getElementById('doseChatInput').value;
    if(!msg) return;
    let chatBox = document.getElementById('doseChat');
    chatBox.innerHTML+=`<div><b>ุฃูุช:</b> ${msg}</div>`;
    document.getElementById('doseChatInput').value='';
    sendToAI(msg,chatBox);
};

// ุฑุจุท ุดุงุช ุงูุณูุงุฆู
document.getElementById('fluidsChatSend').onclick = ()=>{
    let msg = document.getElementById('fluidsChatInput').value;
    if(!msg) return;
    let chatBox = document.getElementById('fluidsChat');
    chatBox.innerHTML+=`<div><b>ุฃูุช:</b> ${msg}</div>`;
    document.getElementById('fluidsChatInput').value='';
    sendToAI(msg,chatBox);
};

// ุฑุจุท ุดุงุช Airway
document.getElementById('airwayChatSend').onclick = ()=>{
    let msg = document.getElementById('airwayChatInput').value;
    if(!msg) return;
    let chatBox = document.getElementById('airwayChat');
    chatBox.innerHTML+=`<div><b>ุฃูุช:</b> ${msg}</div>`;
    document.getElementById('airwayChatInput').value='';
    sendToAI(msg,chatBox);
};
      </script>
