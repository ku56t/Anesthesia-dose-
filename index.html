<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ù†Ø¸Ø§Ù… Ø­Ø³Ø§Ø¨ Ø¬Ø±Ø¹Ø§Øª Ø§Ù„ØªØ®Ø¯ÙŠØ±</title>
<style>
  body{font-family:Arial, sans-serif;direction:rtl;background:#f0f2f5;margin:0;padding:20px}
  .wrap{max-width:900px;margin:0 auto}
  h1{color:#0a5275}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .btn{padding:10px 14px;border-radius:8px;border:none;background:#007bff;color:#fff;cursor:pointer}
  .btn:active{transform:translateY(1px)}
  .panel{background:#fff;padding:18px;border-radius:12px;box-shadow:0 4px 18px rgba(0,0,0,.06);margin-top:16px}
  label{display:block;text-align:right;margin:6px 0}
  input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #cfcfcf;margin-top:6px}
  .sideEffect{background:#fff6f6;border-left:4px solid #ff6b6b;padding:10px;margin:8px 0;border-radius:6px;text-align:right}
  .chatBox{height:200px;overflow:auto;padding:10px;background:#eef2f7;border-radius:8px}
  .muted{color:#666;font-size:13px}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
</style>
</head>
<body>
<div class="wrap">
  <h1>ğŸš‘ Ù†Ø¸Ø§Ù… Ø­Ø³Ø§Ø¨ Ø¬Ø±Ø¹Ø§Øª Ø§Ù„ØªØ®Ø¯ÙŠØ± - Ù…ØªÙƒØ§Ù…Ù„</h1>

  <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ -->
  <div class="row">
    <button class="btn" id="showDose">Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª</button>
    <button class="btn" id="showFluids">Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ ÙˆØ§Ù„Ø¯Ù…</button>
    <button class="btn" id="showAirway">Ø§Ù„Ø§Ø±Ù†ØºÙˆØ³ÙƒÙˆØ¨ Ùˆ ETT</button>
    <button class="btn" id="showAdmin">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
  </div>

  <!-- Ù‚Ø³Ù… Ø§Ù„Ø¬Ø±Ø¹Ø§Øª -->
  <div class="panel" id="panelDose" style="display:none">
    <h2>ğŸ’‰ Ø­Ø³Ø§Ø¨ Ø¬Ø±Ø¹Ø§Øª Ø§Ù„ØªØ®Ø¯ÙŠØ±</h2>
    <div class="grid">
      <div>
        <label>ÙˆØ²Ù† Ø§Ù„Ù…Ø±ÙŠØ¶ (ÙƒØº)
          <input id="weightDose" type="number" min="0" step="0.1" placeholder="Ù…Ø«Ù„Ø§Ù‹: 70">
        </label>
        <label>Ø¹Ù…Ø± Ø§Ù„Ù…Ø±ÙŠØ¶
          <div style="display:flex;gap:8px">
            <input id="ageDose" type="number" min="0" step="1" placeholder="Ø¶Ø¹ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¹Ù…Ø±">
            <select id="ageUnitDose" style="width:150px">
              <option value="years">Ø³Ù†ÙˆØ§Øª</option>
              <option value="months">Ø£Ø´Ù‡Ø±</option>
              <option value="days">Ø£ÙŠØ§Ù…</option>
            </select>
          </div>
        </label>
        <label>Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆØ§Ø¡
          <select id="drugDose"></select>
        </label>
        <button class="btn" id="calcDose">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¬Ø±Ø¹Ø©</button>
      </div>

      <div>
        <div id="doseResult" class="muted">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§</div>
        <div id="doseEffects" style="margin-top:12px"></div>
      </div>
    </div>

    <hr style="margin:12px 0">

    <h3>ğŸ’¬ Ø´Ø§Øª Ø§Ù„Ù‚Ø³Ù…</h3>
    <div class="chatBox" id="doseChat"></div>
    <textarea id="doseChatInput" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." style="margin-top:8px"></textarea>
    <div style="margin-top:8px">
      <button class="btn" id="doseChatSend">Ø£Ø±Ø³Ù„</button>
    </div>
  </div>

  <!-- Ù‚Ø³Ù… Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ -->
  <div class="panel" id="panelFluids" style="display:none">
    <h2>ğŸ’§ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ ÙˆØ§Ù„Ø¯Ù…</h2>
    <div class="grid">
      <div>
        <label>ÙˆØ²Ù† Ø§Ù„Ù…Ø±ÙŠØ¶ (ÙƒØº)
          <input id="weightFluids" type="number" min="0" step="0.1">
        </label>
        <label>Ø¹Ù…Ø± Ø§Ù„Ù…Ø±ÙŠØ¶
          <div style="display:flex;gap:8px">
            <input id="ageFluids" type="number" min="0" step="1">
            <select id="ageUnitFluids" style="width:150px">
              <option value="years">Ø³Ù†ÙˆØ§Øª</option>
              <option value="months">Ø£Ø´Ù‡Ø±</option>
              <option value="days">Ø£ÙŠØ§Ù…</option>
            </select>
          </div>
        </label>
        <button class="btn" id="calcFluids">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø³ÙˆØ§Ø¦Ù„/Ø§Ù„Ø¯Ù…</button>
      </div>

      <div>
        <div id="fluidsResult" class="muted">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§</div>
      </div>
    </div>

    <hr style="margin:12px 0">
    <h3>ğŸ’¬ Ø´Ø§Øª Ø§Ù„Ù‚Ø³Ù…</h3>
    <div class="chatBox" id="fluidsChat"></div>
    <textarea id="fluidsChatInput" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." style="margin-top:8px"></textarea>
    <div style="margin-top:8px">
      <button class="btn" id="fluidsChatSend">Ø£Ø±Ø³Ù„</button>
    </div>
  </div>

  <!-- Ù‚Ø³Ù… Ø§Ù„Ù„Ø§Ø±Ù†ØºÙˆØ³ÙƒÙˆØ¨/ETT -->
  <div class="panel" id="panelAirway" style="display:none">
    <h2>ğŸ˜· Ø§Ù„Ù„Ø§Ø±Ù†ØºÙˆØ³ÙƒÙˆØ¨ Ùˆ ETT</h2>
    <div class="grid">
      <div>
        <label>Ø¹Ù…Ø± Ø§Ù„Ù…Ø±ÙŠØ¶
          <div style="display:flex;gap:8px">
            <input id="ageAirway" type="number" min="0" step="1">
            <select id="ageUnitAirway" style="width:150px">
              <option value="years">Ø³Ù†ÙˆØ§Øª</option>
              <option value="months">Ø£Ø´Ù‡Ø±</option>
              <option value="days">Ø£ÙŠØ§Ù…</option>
            </select>
          </div>
        </label>
        <label>ÙˆØ²Ù† Ø§Ù„Ù…Ø±ÙŠØ¶ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
          <input id="weightAirway" type="number" step="0.1">
        </label>
        <button class="btn" id="calcAirway">Ø­Ø³Ø§Ø¨ Ø§Ù„Ø­Ø¬Ù…</button>
      </div>

      <div>
        <div id="airwayResult" class="muted">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§</div>
      </div>
    </div>

    <hr style="margin:12px 0">
    <h3>ğŸ’¬ Ø´Ø§Øª Ø§Ù„Ù‚Ø³Ù…</h3>
    <div class="chatBox" id="airwayChat"></div>
    <textarea id="airwayChatInput" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." style="margin-top:8px"></textarea>
    <div style="margin-top:8px">
      <button class="btn" id="airwayChatSend">Ø£Ø±Ø³Ù„</button>
    </div>
  </div>

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¨Ø³ÙŠØ·Ø© -->
  <div class="panel" id="panelAdmin" style="display:none">
    <h2>ğŸ”§ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ù…Ø§Ù„Ùƒ)</h2>
    <label>ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø§Ù„Ùƒ
      <input id="adminPass" type="password">
    </label>
    <div style="margin-top:8px">
      <button class="btn" id="adminLogin">Ø¯Ø®ÙˆÙ„</button>
    </div>

    <div id="adminArea" style="display:none;margin-top:12px">
      <h3>ØªØ¹Ø¯ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ù…Ø¤Ù‚ØªØ§Ù‹</h3>
      <p class="muted">ØµÙŠØºØ© ÙƒÙ„ Ø³Ø·Ø±: drug, dosePerKg, side, treatment</p>
      <textarea id="adminEdit" rows="6" placeholder="Ù…Ø«Ø§Ù„: propofol,2,Ø¯ÙˆØ®Ø©,Ø±ÙØ¹ Ø§Ù„Ù‚Ø¯Ù…"></textarea>
      <div style="margin-top:8px">
        <button class="btn" id="adminSave">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
      </div>
    </div>
  </div>

</div>

<script type="module">
  import { sideEffectsData } from './sideEffects.js';

  // ---------- Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø±Ø¦ÙŠØ© ----------
  const panels = {
    dose: document.getElementById('panelDose'),
    fluids: document.getElementById('panelFluids'),
    airway: document.getElementById('panelAirway'),
    admin: document.getElementById('panelAdmin')
  };

  function hideAll() {
    Object.values(panels).forEach(p => p.style.display = 'none');
  }

  document.getElementById('showDose').addEventListener('click', ()=> {
    hideAll(); panels.dose.style.display='block';
  });
  document.getElementById('showFluids').addEventListener('click', ()=> {
    hideAll(); panels.fluids.style.display='block';
  });
  document.getElementById('showAirway').addEventListener('click', ()=> {
    hideAll(); panels.airway.style.display='block';
  });
  document.getElementById('showAdmin').addEventListener('click', ()=> {
    hideAll(); panels.admin.style.display='block';
  });

  // ---------- ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ù…Ù† sideEffectsData ----------
  const drugSelect = document.getElementById('drugDose');
  function populateDrugs(){
    drugSelect.innerHTML = '';
    const keys = Object.keys(sideEffectsData);
    if(keys.length === 0){
      const opt = document.createElement('option'); opt.value=''; opt.textContent='Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¯ÙˆÙŠØ© ÙÙŠ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©'; drugSelect.appendChild(opt);
    } else {
      keys.forEach(k=>{
        const opt = document.createElement('option'); opt.value = k; opt.textContent = k; drugSelect.appendChild(opt);
      });
    }
  }
  populateDrugs();

  // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù…Ø± Ø§Ù„Ù‰ Ø³Ù†ÙˆØ§Øª (float)
  function ageToYears(value, unit){
    const v = parseFloat(value);
    if(isNaN(v) || v < 0) return NaN;
    if(unit === 'years') return v;
    if(unit === 'months') return v / 12;
    if(unit === 'days') return v / 365;
    return NaN;
  }

  // ---------- Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¬Ø±Ø¹Ø© ÙˆØ§Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ù…Ù† sideEffectsData ----------
  document.getElementById('calcDose').addEventListener('click', ()=>{
    const w = parseFloat(document.getElementById('weightDose').value);
    const ageVal = document.getElementById('ageDose').value;
    const ageUnit = document.getElementById('ageUnitDose').value;
    const drug = drugSelect.value;

    const resDiv = document.getElementById('doseResult');
    const effectsDiv = document.getElementById('doseEffects');
    resDiv.innerHTML = ''; effectsDiv.innerHTML = '';

    if(!drug){
      alert('Ø§Ø®ØªØ± Ø¯ÙˆØ§Ø¡Ù‹ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©');
      return;
    }
    if(isNaN(w) || w <= 0){
      alert('Ø£Ø¯Ø®Ù„ ÙˆØ²Ù† ØµØ­ÙŠØ­ (ÙƒØº)');
      return;
    }
    const ageYears = ageToYears(ageVal, ageUnit);
    if(isNaN(ageYears)){
      alert('Ø£Ø¯Ø®Ù„ Ø¹Ù…Ø± ØµØ­ÙŠØ­');
      return;
    }

    // Ù†Ø­Ø³Ø¨ Ø§Ù„Ø¬Ø±Ø¹Ø© Ù„ÙƒÙ„ Ù…Ø¯Ø®Ù„ ÙÙŠ sideEffectsData[drug]
    const list = sideEffectsData[drug];
    if(!list || list.length === 0){
      resDiv.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙˆØ§Ø¡ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©';
      return;
    }

    // Ù†Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ: (Ù†Ø­Ø³Ø¨ Ø§Ø³ØªØ®Ø¯Ø§Ù… dosePerKg Ø§Ù„Ø£ÙƒØ«Ø± Ø´ÙŠÙˆØ¹Ù‹Ø§ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª ÙƒØ¬Ø±Ø¹Ø© Ù…Ø±Ø¬Ø¹ÙŠØ©)
    // Ø¨Ø¹Ø¶ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ù‚Ø¯ ØªØ­ÙˆÙŠ Ù…Ø¯Ø®Ù„Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© Ù„Ù‡Ø§ Ù†ÙØ³ dosePerKg (Ø£Ø¹Ø±Ø§Ø¶ Ù…Ø®ØªÙ„ÙØ©)
    const referenceDose = list[0].dosePerKg;
    const totalDose = w * Number(referenceDose); // Ù…Ù„Øº Ø£Ùˆ ÙˆØ­Ø¯Ø© Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©
    resDiv.innerHTML = `<strong>Ø§Ù„Ø¬Ø±Ø¹Ø© Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ© (${referenceDose} Ù…Ù„Øº/ÙƒØº):</strong> ${totalDose.toFixed(2)} Ù…Ù„Øº`;

    // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ ÙˆØ§Ù„Ø¹Ù„Ø§Ø¬Ø› Ù†ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø±
    const shown = new Set();
    list.forEach(item=>{
      const dpkg = Number(item.dosePerKg);
      if(isNaN(dpkg)){
        // ØªØ¬Ø§Ù‡Ù„ Ø£Ùˆ Ø¥Ø¹Ù„Ø§Ù…
        effectsDiv.innerHTML += `<div class="sideEffect">âš  Ø®Ø·Ø£ Ø¨Ø¬Ø±Ø¹Ø© Ù„ÙƒÙ„ ÙƒØº Ù„Ù„Ø¹Ø±Ø¶: ${item.side}</div>`;
        return;
      }
      const doseForThis = (w * dpkg).toFixed(2);
      const key = `${item.side}||${item.treatment}||${doseForThis}`;
      if(shown.has(key)) return;
      shown.add(key);
      effectsDiv.innerHTML += `<div class="sideEffect">
        <div><strong>Ø¬Ø±Ø¹Ø© Ù…Ø±ØªØ¨Ø·Ø©:</strong> ${doseForThis} Ù…Ù„Øº</div>
        <div><strong>Ø§Ù„Ø¹Ø±Ø¶:</strong> ${item.side}</div>
        <div><strong>Ø§Ù„Ø¹Ù„Ø§Ø¬ Ø§Ù„Ù…Ù‚ØªØ±Ø­:</strong> ${item.treatment}</div>
      </div>`;
    });
  });

  // ---------- Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ ÙˆØ§Ù„Ø¯Ù… ----------
  document.getElementById('calcFluids').addEventListener('click', ()=>{
    const w = parseFloat(document.getElementById('weightFluids').value);
    const ageVal = document.getElementById('ageFluids').value;
    const ageUnit = document.getElementById('ageUnitFluids').value;
    const out = document.getElementById('fluidsResult'); out.innerHTML='';

    if(isNaN(w) || w <= 0){ alert('Ø£Ø¯Ø®Ù„ ÙˆØ²Ù† ØµØ­ÙŠØ­'); return; }
    const ageYears = ageToYears(ageVal, ageUnit);
    if(isNaN(ageYears)){ alert('Ø£Ø¯Ø®Ù„ Ø¹Ù…Ø± ØµØ­ÙŠØ­'); return; }

    // Ù†Ù‡Ø¬ Ø­Ø³Ø§Ø¨ Ù†Ù…ÙˆØ°Ø¬ÙŠ (ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¹Ø§Ù…Ø©ØŒ Ø¹Ø¯Ù„ Ø­Ø³Ø¨ Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„Ø§ØªÙƒÙ…)
    // Ø³ÙˆØ§Ø¦Ù„ Ø£Ø³Ø§Ø³ÙŠØ© Ø¨Ø§Ù„Ù…Ù„/Ø§Ù„ÙŠÙˆÙ… ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ = 30 Ù…Ù„ Ù„ÙƒÙ„ ÙƒØº
    const maintenance = (w * 30).toFixed(0);
    // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ù… Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ Ø¨Ø§Ù„Ù„ØªØ± = ÙˆØ²Ù† * 70 Ù…Ù„ / 1000
    const bloodLiters = ((w * 70) / 1000).toFixed(2);

    out.innerHTML = `<div><strong>ÙƒÙ…ÙŠØ© Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠØ©:</strong> ${maintenance} Ù…Ù„/Ø§Ù„ÙŠÙˆÙ…</div>
                     <div><strong>Ø­Ø¬Ù… Ø§Ù„Ø¯Ù… Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ:</strong> ${bloodLiters} Ù„ØªØ±</div>`;
  });

  // ---------- Ø­Ø³Ø§Ø¨ Ø§Ù„Ù„Ø§Ø±Ù†ØºÙˆØ³ÙƒÙˆØ¨ Ùˆ ETT ----------
  document.getElementById('calcAirway').addEventListener('click', ()=>{
    const ageVal = document.getElementById('ageAirway').value;
    const ageUnit = document.getElementById('ageUnitAirway').value;
    const w = parseFloat(document.getElementById('weightAirway').value);
    const out = document.getElementById('airwayResult'); out.innerHTML='';

    const ageYears = ageToYears(ageVal, ageUnit);
    if(isNaN(ageYears)){ alert('Ø£Ø¯Ø®Ù„ Ø¹Ù…Ø± ØµØ­ÙŠØ­'); return; }

    // Ù‚ÙˆØ§Ø¹Ø¯ ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ø´Ø§Ø¦Ø¹Ø© (ØºÙŠØ± Ù…Ù„Ø²Ù…Ø©ØŒ Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ±ÙŠ)
    let bladeSize = '', ettSize = '';
    if(ageYears < 1){
      bladeSize = 'Ø­Ø¬Ù… 0';
      ettSize = '3.0 - 3.5 mm (Ø­Ø³Ø¨ Ø§Ù„ÙˆØ²Ù†)';
    } else if(ageYears < 2){
      bladeSize = 'Ø­Ø¬Ù… 1';
      ettSize = '3.5 - 4.0 mm';
    } else if(ageYears < 5){
      bladeSize = 'Ø­Ø¬Ù… 2';
      ettSize = '4.0 - 4.5 mm';
    } else if(ageYears < 12){
      bladeSize = 'Ø­Ø¬Ù… 3';
      ettSize = '4.5 - 5.5 mm';
    } else {
      bladeSize = 'Ø­Ø¬Ù… 4 (Ø¨Ø§Ù„ØºÙŠÙ†)';
      // Ù…Ø¹Ø§Ø¯Ù„Ø© ETT ØªÙ‚Ø±ÙŠØ¨ÙŠØ©: (Ø§Ù„Ø¹Ù…Ø±/4) + 4
      ettSize = `${Math.floor((ageYears / 4) + 4)} mm (Ø­Ø¬Ù… Ø¯Ø§Ø®Ù„ÙŠ ØªÙ‚Ø±ÙŠØ¨ÙŠ)`;
    }

    // Ù„Ùˆ Ø§Ù„ÙˆØ²Ù† Ù…ÙˆØ¬ÙˆØ¯ Ù†Ø¹Ø·ÙŠ ØªÙ‚Ø¯ÙŠØ± Ø­Ø³Ø¨Ù‡ Ø£ÙŠØ¶Ø§Ù‹
    if(!isNaN(w) && w > 0){
      out.innerHTML = `<div><strong>Ø´ÙØ±Ø© Ø§Ù„Ù„Ø§Ø±Ù†ØºÙˆ:</strong> ${bladeSize}</div>
                       <div><strong>ETT Ù…Ù‚ØªØ±Ø­:</strong> ${ettSize}</div>
                       <div class="muted">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ø³ØªØ®Ø¯Ù… ØªÙ‚Ø¯ÙŠØ±Ø§Øª Ø§Ù„ÙˆØ²Ù† Ù„Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„Ø£Ø·ÙØ§Ù„ ÙˆØ§Ù„Ø±Ø¶Ø¹ ÙˆØ±Ø§Ø¬Ø¹ Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰.</div>`;
    } else {
      out.innerHTML = `<div><strong>Ø´ÙØ±Ø© Ø§Ù„Ù„Ø§Ø±Ù†ØºÙˆ:</strong> ${bladeSize}</div>
                       <div><strong>ETT Ù…Ù‚ØªØ±Ø­:</strong> ${ettSize}</div>`;
    }
  });

  // ---------- Ø´Ø§ØªØ§Øª Ø¨Ø³ÙŠØ·Ø© Ù„ÙƒÙ„ Ù‚Ø³Ù… (Ù…Ø­Ø§ÙƒØ§Ø©ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø±Ø¨Ø· backend Ù„Ø§Ø­Ù‚Ø§Ù‹) ----------
  function appendChat(boxId, role, text){
    const box = document.getElementById(boxId);
    const p = document.createElement('div');
    p.style.margin = '6px 0';
    p.innerHTML = `<strong>${role}:</strong> ${text}`;
    box.appendChild(p);
    box.scrollTop = box.scrollHeight;
  }

  // dose chat
  document.getElementById('doseChatSend').addEventListener('click', ()=>{
    const input = document.getElementById('doseChatInput');
    const text = input.value.trim(); if(!text) return;
    appendChat('doseChat','Ø£Ù†Øª',text);
    // Ù…Ø­Ø§ÙƒØ§Ø© Ø±Ø¯ Ø³Ø±ÙŠØ¹
    appendChat('doseChat','AI','Ø±Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠ: ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø·Ø¨ÙŠ ÙˆØ¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ (Ù‡Ø°Ù‡ Ù…Ø­Ø§ÙƒØ§Ø©).');
    input.value='';
  });

  // fluids chat
  document.getElementById('fluidsChatSend').addEventListener('click', ()=>{
    const input = document.getElementById('fluidsChatInput');
    const text = input.value.trim(); if(!text) return;
    appendChat('fluidsChat','Ø£Ù†Øª',text);
    appendChat('fluidsChat','AI','Ø±Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠ: ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆØ§Ø²Ù† Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ ÙˆØ§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø­ÙŠÙˆÙŠØ©.');
    input.value='';
  });

  // airway chat
  document.getElementById('airwayChatSend').addEventListener('click', ()=>{
    const input = document.getElementById('airwayChatInput');
    const text = input.value.trim(); if(!text) return;
    appendChat('airwayChat','Ø£Ù†Øª',text);
    appendChat('airwayChat','AI','Ø±Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠ: ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ø¶ÙŠØ± Ø¹Ø¯Ø© ØªÙ‡ÙˆÙŠØ© Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ø£Ø·ÙØ§Ù„ ÙˆØ§Ù„Ø¨Ø§Ù„ØºÙŠÙ†.');
    input.value='';
  });

  // ---------- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…: ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ù…Ø¤Ù‚ØªØ§Ù‹ ----------
  document.getElementById('adminLogin').addEventListener('click', ()=>{
    const pass = document.getElementById('adminPass').value;
    if(pass === 'mustafa@2006#2'){
      document.getElementById('adminArea').style.display = 'block';
      alert('ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…');
    } else alert('ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©');
  });

  document.getElementById('adminSave').addEventListener('click', ()=>{
    const txt = document.getElementById('adminEdit').value.trim();
    if(!txt){ alert('Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª'); return; }
    // ØµÙŠØºØ© ÙƒÙ„ Ø³Ø·Ø±: drug, dosePerKg, side, treatment
    const lines = txt.split('\n');
    lines.forEach(line=>{
      const parts = line.split(',').map(s=>s.trim());
      if(parts.length < 4) return;
      const drug = parts[0];
      const dosePerKg = Number(parts[1]);
      const side = parts[2];
      const treatment = parts[3];
      if(!sideEffectsData[drug]) sideEffectsData[drug] = [];
      sideEffectsData[drug].push({ dosePerKg, side, treatment });
    });
    populateDrugs();
    alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ù…Ø­Ù„ÙŠØ§Ù‹');
  });

  // ---------- ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ ----------
  hideAll();
  panels.dose.style.display = 'block';

</script>
</body>
</html>
