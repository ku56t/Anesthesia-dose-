<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>موقع التخدير الطبي</title>
<style>
body { font-family: Arial; direction: rtl; background:#f0f2f5; margin:0; padding:0; }
.container { max-width:700px; margin:20px auto; padding:20px; background:#fff; border-radius:15px; box-shadow:0 0 15px rgba(0,0,0,0.2); text-align:center; position:relative; }
h1,h2 { color:#333; }
input,select,button,textarea { width:100%; padding:12px; margin:10px 0; border-radius:6px; border:1px solid #ccc; }
button { background:#007bff; color:#fff; border:none; cursor:pointer; }
button:hover { background:#0056b3; }
.section { display:none; margin-top:20px;}
.sideEffect { background:#ffe0e0; padding:5px; margin:5px 0; border-radius:5px; text-align:right; }
.chatBox { height:200px; overflow-y:auto; background:#e9ecef; padding:10px; border-radius:6px; margin-bottom:10px; text-align:right; }
</style>
</head>
<body>

<div class="container">
<h1>موقع التخدير الطبي</h1>

<button onclick="showSection('doseSection')">حساب جرعة التخدير</button>
<button onclick="showSection('fluidsSection')">حساب السوائل والدم</button>
<button onclick="showSection('laryngoSection')">حجم اللارنغوسكوب والتيوبات</button>
<button onclick="showSection('aiSection')">شات الذكاء الاصطناعي الطبي</button>
<button onclick="openAdminPanel()">لوحة التحكم (للمالك)</button>

<div id="doseSection" class="section container">
<h2>حساب جرعة التخدير</h2>
<label>وزن المريض (كغ):</label><input type="number" id="weightDose" placeholder="أدخل الوزن">
<label>عمر المريض:</label><input type="number" id="ageDose" placeholder="أدخل العمر">
<select id="ageUnitDose">
  <option value="year">سنة</option>
  <option value="month">شهر</option>
  <option value="day">يوم</option>
</select>
<label>نوع الدواء:</label>
<select id="drugDose">
<option value="propofol">بروبوفول</option>
<option value="midazolam">ميدازولام</option>
<option value="fentanyl">فنتانيل</option>
<option value="ketamine">كيتامين</option>
</select>
<button onclick="calculateDose()">احسب الجرعة</button>
<div id="doseBox"></div>

<h3>شات القسم</h3>
<div id="doseChatBox" class="chatBox"></div>
<textarea id="doseAIInput" placeholder="اكتب حالة المريض هنا..."></textarea>
<button onclick="sendSectionAI('dose')">أرسل</button>
</div>

<div id="fluidsSection" class="section container">
<h2>حساب السوائل والدم</h2>
<label>وزن المريض (كغ):</label><input type="number" id="weightFluids" placeholder="أدخل الوزن">
<label>عمر المريض:</label><input type="number" id="ageFluids" placeholder="أدخل العمر">
<select id="ageUnitFluids">
  <option value="year">سنة</option>
  <option value="month">شهر</option>
  <option value="day">يوم</option>
</select>
<button onclick="calculateFluids()">احسب السوائل والدم</button>
<div id="fluidsBox"></div>

<h3>شات القسم</h3>
<div id="fluidsChatBox" class="chatBox"></div>
<textarea id="fluidsAIInput" placeholder="اكتب حالة المريض هنا..."></textarea>
<button onclick="sendSectionAI('fluids')">أرسل</button>
</div>

<div id="laryngoSection" class="section container">
<h2>حجم اللارنغوسكوب والتيوبات</h2>
<label>عمر المريض:</label><input type="number" id="ageLaryngo" placeholder="أدخل العمر">
<select id="ageUnitLaryngo">
  <option value="year">سنة</option>
  <option value="month">شهر</option>
  <option value="day">يوم</option>
</select>
<button onclick="calculateLaryngo()">احسب الحجم والطرق</button>
<div id="laryngoBox"></div>

<h3>شات القسم</h3>
<div id="laryngoChatBox" class="chatBox"></div>
<textarea id="laryngoAIInput" placeholder="اكتب حالة المريض هنا..."></textarea>
<button onclick="sendSectionAI('laryngo')">أرسل</button>
</div>

<div id="aiSection" class="section container">
<h2>شات الذكاء الاصطناعي الطبي العام</h2>
<div id="aiChatBox" class="chatBox"></div>
<textarea id="aiInput" placeholder="اكتب حالة المريض هنا..."></textarea>
<button onclick="sendSectionAI('ai')">أرسل</button>
</div>

<div id="adminPanel" class="section container">
<h2>لوحة التحكم</h2>
<label>كلمة المرور:</label><input type="password" id="adminPassword" placeholder="أدخل كلمة المرور">
<button onclick="loginAdmin()">تسجيل الدخول</button>

<div id="adminContent" style="display:none;">
<h3>تغيير واجهة الموقع (CSS)</h3>
<textarea id="customCSS" placeholder="أدخل CSS لتغيير الواجهة"></textarea>
<button onclick="applyCustomCSS()">تطبيق</button>
<h3>تعديل الأدوية</h3>
<textarea id="customDrugs" placeholder="اسم_الدواء,جرعة لكل كغ,الأعراض,العلاج"></textarea>
<button onclick="applyCustomDrugs()">تطبيق</button>
</div>
</div>

<script type="module">
// استيراد قاعدة الأعراض الجانبية
import { sideEffectsData } from './sideEffects.js';

function showSection(id){
  document.querySelectorAll('.section').forEach(s=>s.style.display='none');
  document.getElementById(id).style.display='block';
}

let drugsData = {
  "propofol": {dosePerKg:2},
  "midazolam": {dosePerKg:0.1},
  "fentanyl": {dosePerKg:0.001},
  "ketamine": {dosePerKg:1.5}
};

function calculateDose(){
  let w=parseFloat(document.getElementById('weightDose').value);
  let age=parseInt(document.getElementById('ageDose').value);
  let unit=document.getElementById('ageUnitDose').value;
  let drug=document.getElementById('drugDose').value;
  if(!w||!age){ alert("أدخل الوزن والعمر"); return; }
  if(unit=="month") age=age/12; 
  else if(unit=="day") age=age/365;
  let dose=w*drugsData[drug].dosePerKg;
  let html=`<p>الجرعة: <b>${dose} ملغ</b></p><h3>الأعراض الجانبية:</h3>`;
  if(sideEffectsData[drug]){
    sideEffectsData[drug].forEach(se=>{
      html+=`<div class="sideEffect">الجرعة ${se.doseRange} ملغ: ${se.side} - علاج: ${se.treatment}</div>`;
    });
  }
  document.getElementById('doseBox').innerHTML=html;
}

function calculateFluids(){
  let w=parseFloat(document.getElementById('weightFluids').value);
  if(!w){ alert("أدخل الوزن"); return; }
  let fluids=(w*30).toFixed(0);
  let blood=(w*70/1000).toFixed(2);
  document.getElementById('fluidsBox').innerHTML=`<p>كمية السوائل: <b>${fluids} مل</b></p><p>كمية الدم: <b>${blood} لتر</b></p>`;
}

function calculateLaryngo(){
  let age=parseInt(document.getElementById('ageLaryngo').value);
  let unit=document.getElementById('ageUnitLaryngo').value;
  if(!age){ alert("أدخل العمر"); return; }
  if(unit=="month") age=age/12; 
  else if(unit=="day") age=age/365;
  let size=age<1?1:age<5?2:age<12?3:4;
  document.getElementById('laryngoBox').innerHTML=`الحجم المناسب لللارنغوسكوب: <b>${size}</b>`;
}

// دوال الشات لكل قسم
function sendSectionAI(section){
  let input, box;
  if(section==='dose'){ input=document.getElementById('doseAIInput'); box=document.getElementById('doseChatBox'); }
  else if(section==='fluids'){ input=document.getElementById('fluidsAIInput'); box=document.getElementById('fluidsChatBox'); }
  else if(section==='laryngo'){ input=document.getElementById('laryngoAIInput'); box=document.getElementById('laryngoChatBox'); }
  else{ input=document.getElementById('aiInput'); box=document.getElementById('aiChatBox'); }
  if(!input.value) return;
  box.innerHTML+=`<div><b>المستخدم:</b> ${input.value}</div>`;
  box.innerHTML+=`<div><b>AI:</b> هذه مجرد إجابة تجريبية. سيتم ربطها بالذكاء الاصطناعي الحقيقي لاحقاً.</div>`;
  input.value='';
  box.scrollTop=box.scrollHeight;
}

// لوحة التحكم
function openAdminPanel(){ showSection('adminPanel'); }
function loginAdmin(){
  if(document.getElementById('adminPassword').value==='mustafa@2006#2'){
    document.getElementById('adminContent').style.display='block';
  }else{ alert("كلمة المرور خاطئة"); }
}
function applyCustomCSS(){
  let style=document.getElementById('customCSS').value;
  let tag=document.createElement('style');
  tag.innerHTML=style;
  document.head.appendChild(tag);
}
function applyCustomDrugs(){ alert("سيتم إضافة تعديل الأدوية لاحقاً"); }

</script>
</body>
</html>
