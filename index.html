<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ®Ø¯ÙŠØ± Ø§Ù„Ø·Ø¨ÙŠ â€” Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¬Ø±Ø¹Ø§Øª</title>
<style>
  :root{
    --bg1:#09142a; --bg2:#0b3550; --card:#ffffff; --accent:#0a5275; --glass: rgba(255,255,255,0.08);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Tahoma,Arial,Helvetica,sans-serif;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#fff;min-height:100vh;overflow-x:hidden}
  /* SPLASH */
  #splash{position:fixed;inset:0;z-index:9999;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:18px;background:linear-gradient(135deg,#071024 0%, #0b2b3a 70%);overflow:hidden}
  .bars-wrap{width:92%;max-width:1000px;display:flex;flex-direction:column;gap:12px;align-items:stretch}
  .bar{
    background:linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
    padding:18px;border-radius:12px;color:#eaf6ff;display:flex;flex-direction:column;gap:4px;align-items:flex-start;
    transform-origin:center;
    box-shadow:0 8px 30px rgba(0,0,0,0.5);
  }
  .bar b{font-size:20px}
  .bar small{opacity:0.85;color:#d8f0ff}
  .bar .user{font-size:13px;color:#bfe6ff}
  /* animate bars: appear center then fly out to both sides slowly (5s) */
  .bar.left  { animation:barOutLeft 5s cubic-bezier(.2,.9,.3,1) forwards; }
  .bar.center{ animation:barOutBoth 5s cubic-bezier(.2,.9,.3,1) forwards; }
  .bar.right { animation:barOutRight 5s cubic-bezier(.2,.9,.3,1) forwards; }

  @keyframes barOutLeft {
    0% { transform:translateX(0); opacity:1;}
    50% { transform:translateX(0); opacity:1;}
    100% { transform:translateX(-150%); opacity:0;}
  }
  @keyframes barOutRight {
    0% { transform:translateX(0); opacity:1;}
    50% { transform:translateX(0); opacity:1;}
    100% { transform:translateX(150%); opacity:0;}
  }
  @keyframes barOutBoth {
    0% { transform:translateY(0); opacity:1;}
    60% { transform:translateY(0); opacity:1;}
    100% { transform:translateY(-120%); opacity:0;}
  }

  .splash-note{color:#bfe6ff;opacity:0.95}

  /* floating decorative bubbles & lights */
  .decoration{position:fixed;inset:0;pointer-events:none;z-index:5}
  .bubble{
    position:absolute;border-radius:50%;background:radial-gradient(circle at 30% 30%, rgba(255,255,255,0.14), rgba(255,255,255,0.02));
    filter:blur(6px);opacity:.6;animation:floatY linear infinite;
  }
  @keyframes floatY{
    0%{transform:translateY(0) translateX(0)}
    50%{transform:translateY(-60px) translateX(20px)}
    100%{transform:translateY(0) translateX(0)}
  }
  .glow {position:absolute;width:220px;height:220px;border-radius:50%;background:radial-gradient(circle, rgba(255,255,255,0.06), rgba(255,255,255,0));filter:blur(40px);opacity:0.8;mix-blend-mode:screen}

  /* MAIN APP */
  #app{display:none;position:relative;z-index:10;padding:28px;max-width:1100px;margin:36px auto}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));border-radius:14px;padding:18px;box-shadow:0 18px 50px rgba(2,6,23,0.6);color:#fff}
  h1{margin:0 0 14px;text-align:center;color:var(--accent)}
  .row{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-bottom:12px}
  .btn{padding:10px 14px;border-radius:10px;border:none;background:linear-gradient(90deg,#0ea5a5,#0a5275);color:#fff;cursor:pointer;min-width:140px}
  .btn:active{transform:translateY(1px)}
  .panel{display:none;margin-top:16px}
  label{display:block;text-align:right;margin:6px 0;color:#e6f3ff}
  input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.08);background:rgba(255,255,255,0.02);color:#fff}
  .muted{color:#cfe8f7;font-size:13px}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:12px}
  .sideEffect{background:rgba(255,70,90,0.06);border-left:4px solid rgba(255,70,90,0.9);padding:10px;margin:8px 0;border-radius:8px;color:#ffecec}
  .chatBox{height:140px;overflow:auto;padding:10px;background:rgba(255,255,255,0.02);border-radius:8px;border:1px solid rgba(255,255,255,0.03)}
  footer{margin-top:14px;text-align:center;color:#93c1d8;font-size:13px}

  .controls-row{display:flex;gap:8px;align-items:center}
  .small-muted{font-size:12px;color:#a9d7ee}

  /* result styling */
  .result-box{background:rgba(0,0,0,0.25);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
  .pill{display:inline-block;padding:6px 10px;background:rgba(255,255,255,0.04);border-radius:999px;margin:6px 6px 0 0;color:#dff6ff;font-weight:600}

  /* responsive */
  @media (max-width:720px){
    #app{padding:14px}
    .grid{grid-template-columns:1fr}
  }
</style>
</head>
<body>

<!-- SPLASH -->
<div id="splash">
  <div class="bars-wrap" style="width:86%">
    <div class="bar left">
      <b>Ù…ØµØ·ÙÙ‰ Ù…ÙƒÙŠ Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø¶Ø§</b>
      <small>Ù…Ù†Ø¸Ù… Ùˆ Ù…Ø·ÙˆØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹</small>
      <div class="user">@ku56t</div>
    </div>
    <div class="bar center">
      <b>Ù…ØµØ·ÙÙ‰ Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø´ÙƒÙŠØ±</b>
      <small>Ù…Ù†Ø¸Ù…</small>
      <div class="user">@871c</div>
    </div>
    <div class="bar right">
      <b>Ù…Ø­Ù…Ø¯ Ø·Ø§Ù‡Ø± ÙŠØ­ÙŠÙ‰</b>
      <small>Ù…Ù†Ø¸Ù…</small>
      <div class="user">@ans_mz1092</div>
    </div>
  </div>
  <div class="splash-note">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„ â€” Ø³ÙŠØªÙ… ÙØªØ­ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø­Ø±ÙƒØ©</div>
  <!-- decorative small sparkles -->
  <div style="position:absolute;inset:0;pointer-events:none">
    <div style="position:absolute;left:6%;top:20%;width:14px;height:14px;background:rgba(255,255,255,0.12);border-radius:50%;filter:blur(6px);animation:floatY 6s infinite;"></div>
    <div style="position:absolute;right:10%;top:35%;width:18px;height:18px;background:rgba(255,255,255,0.08);border-radius:50%;filter:blur(10px);animation:floatY 8s infinite;"></div>
  </div>
</div>

<!-- decoration layers -->
<div class="decoration" aria-hidden="true">
  <div class="bubble" style="left:6%;top:12%;width:160px;height:160px;animation-duration:10s"></div>
  <div class="bubble" style="left:78%;top:22%;width:120px;height:120px;animation-duration:12s"></div>
  <div class="bubble" style="left:22%;top:72%;width:90px;height:90px;animation-duration:9s"></div>
  <div class="bubble" style="left:68%;top:80%;width:140px;height:140px;animation-duration:11s"></div>
  <div class="glow" style="left:2%;top:72%;opacity:0.4"></div>
  <div class="glow" style="right:2%;top:60%;opacity:0.25"></div>
</div>

<!-- APP -->
<div id="app">
  <div class="card">
    <h1>ğŸš‘ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ®Ø¯ÙŠØ± Ø§Ù„Ø·Ø¨ÙŠ â€” Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¬Ø±Ø¹Ø§Øª</h1>

    <div class="row">
      <button class="btn" id="showDose">Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª</button>
      <button class="btn" id="showFluids">Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ ÙˆØ§Ù„Ø¯Ù…</button>
      <button class="btn" id="showAirway">Ø§Ù„Ø§Ø±Ù†ØºÙˆØ³ÙƒÙˆØ¨ & ETT</button>
      <button class="btn" id="showAdmin">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
    </div>

    <!-- ========== Dose panel ========== -->
    <div id="panelDose" class="panel">
      <h2 style="margin-top:0">ğŸ’‰ Ø­Ø³Ø§Ø¨ Ø¬Ø±Ø¹Ø§Øª Ø§Ù„ØªØ®Ø¯ÙŠØ±</h2>
      <div class="grid">
        <div>
          <label>ÙˆØ²Ù† Ø§Ù„Ù…Ø±ÙŠØ¶ (ÙƒØº)
            <input id="weightDose" type="number" placeholder="Ù…Ø«Ù„Ø§Ù‹ 70" min="0" step="0.1">
          </label>

          <label>Ø¹Ù…Ø± Ø§Ù„Ù…Ø±ÙŠØ¶
            <div style="display:flex;gap:8px">
              <input id="ageDose" type="number" placeholder="Ù…Ø«Ù„Ø§Ù‹ 40" min="0" step="0.1" style="flex:1">
              <select id="ageUnitDose" style="width:120px">
                <option value="years">Ø³Ù†ÙˆØ§Øª</option>
                <option value="months">Ø£Ø´Ù‡Ø±</option>
                <option value="days">Ø£ÙŠØ§Ù…</option>
              </select>
            </div>
          </label>

          <label>ØªØµÙ†ÙŠÙ ASA
            <select id="asaSelect">
              <option value="I">ASA I (Ø³Ù„ÙŠÙ…)</option>
              <option value="II">ASA II (Ù…Ø±Ø¶ Ø®ÙÙŠÙ)</option>
              <option value="III">ASA III (Ù…Ø±Ø¶ Ù…ØªÙˆØ³Ø·)</option>
              <option value="IV">ASA IV (Ø®Ø·Ø± Ø«Ø§Ø¨Øª)</option>
              <option value="V">ASA V (Ø­Ø±Ø¬)</option>
            </select>
          </label>

          <label>Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø±ÙŠØ¶
            <select id="patientHealth">
              <option value="healthy">ØµØ­ÙŠ</option>
              <option value="unhealthy">Ù…Ø±ÙŠØ¶ (Ø£Ù…Ø±Ø§Ø¶ Ù…ØªØ¹Ø¯Ø¯Ø©)</option>
            </select>
          </label>

          <div id="diseaseDiv" style="display:none;margin-top:8px">
            <label>Ø§Ø®ØªØ± Ø§Ù„Ø£Ù…Ø±Ø§Ø¶ (ÙŠÙ…ÙƒÙ† Ø§Ø®ØªÙŠØ§Ø± Ø£ÙƒØ«Ø± Ù…Ù† Ù…Ø±Ø¶)
              <div style="display:flex;flex-direction:column;gap:6px;margin-top:6px">
                <label><input type="checkbox" class="diseaseChk" value="diabetes"> Ø³ÙƒØ±ÙŠ</label>
                <label><input type="checkbox" class="diseaseChk" value="heart"> Ø£Ù…Ø±Ø§Ø¶ Ù‚Ù„Ø¨ÙŠØ© (CHF/IHD)</label>
                <label><input type="checkbox" class="diseaseChk" value="lung"> Ø£Ù…Ø±Ø§Ø¶ Ø±Ø¦ÙˆÙŠØ© (COPD/Asthma)</label>
                <label><input type="checkbox" class="diseaseChk" value="liver"> Ø£Ù…Ø±Ø§Ø¶ ÙƒØ¨Ø¯ÙŠØ©</label>
                <label><input type="checkbox" class="diseaseChk" value="kidney"> Ø£Ù…Ø±Ø§Ø¶ ÙƒÙ„ÙˆÙŠØ©</label>
                <label><input type="checkbox" class="diseaseChk" value="allergy"> ØªØ­Ø³Ø³ / Ø­Ø³Ø§Ø³ÙŠØ© Ø¯ÙˆØ§Ø¦ÙŠØ©</label>
                <label><input type="checkbox" class="diseaseChk" value="obesity"> Ø³Ù…Ù†Ø© Ù…ÙØ±Ø·Ø© (BMI â‰¥40)</label>
              </div>
            </label>
          </div>

          <label>Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆØ§Ø¡
            <select id="drugDose"></select>
          </label>

          <div style="margin-top:10px" class="controls-row">
            <button class="btn" id="calcDose">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¬Ø±Ø¹Ø©</button>
            <div class="small-muted" style="margin-left:10px">Ø§Ù„Ù†ØªÙŠØ¬Ø© ØªØ£Ø®Ø° Ø¨Ø§Ù„Ø­Ø³Ø¨Ø§Ù† Ø§Ù„Ø¹Ù…Ø± ÙˆØ§Ù„ASA ÙˆØ§Ù„Ø£Ù…Ø±Ø§Ø¶</div>
          </div>
        </div>

        <div>
          <div id="doseResult" class="result-box muted"><b>Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§</b></div>
          <div id="doseEffects" style="margin-top:12px"></div>
        </div>
      </div>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,0.05);margin:16px 0">

      <h3 style="margin-bottom:8px">ğŸ’¬ Ø´Ø§Øª AI Ø·Ø¨ÙŠ (Ù…Ø¤Ù‚Øª)</h3>
      <div class="chatBox" id="doseChat"></div>
      <textarea id="doseChatInput" placeholder="Ø§Ø³Ø£Ù„ Ø¹Ù† Ø§Ù„Ø¯ÙˆØ§Ø¡ Ø£Ùˆ Ø§Ù„Ø¢Ø«Ø§Ø±..." style="margin-top:8px"></textarea>
      <div style="margin-top:8px"><button class="btn" id="doseChatSend">Ø£Ø±Ø³Ù„</button></div>
    </div>

    <!-- ========== Fluids panel ========== -->
    <div id="panelFluids" class="panel">
      <h2>ğŸ’§ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ ÙˆØ§Ù„Ø¯Ù…</h2>
      <div class="grid">
        <div>
          <label>ÙˆØ²Ù† Ø§Ù„Ù…Ø±ÙŠØ¶ (ÙƒØº)
            <input id="weightFluid" type="number" placeholder="Ù…Ø«Ù„Ø§Ù‹ 70" min="0" step="0.1">
          </label>

          <label>Ø¹Ù…Ø± Ø§Ù„Ù…Ø±ÙŠØ¶
            <div style="display:flex;gap:8px">
              <input id="ageFluid" type="number" min="0" step="0.1" style="flex:1">
              <select id="ageUnitFluid" style="width:120px">
                <option value="years">Ø³Ù†ÙˆØ§Øª</option>
                <option value="months">Ø£Ø´Ù‡Ø±</option>
                <option value="days">Ø£ÙŠØ§Ù…</option>
              </select>
            </div>
          </label>

          <div style="margin-top:8px" class="controls-row">
            <button class="btn" id="calcFluids">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø³ÙˆØ§Ø¦Ù„/Ø§Ù„Ø¯Ù…</button>
            <div class="small-muted" style="margin-left:8px">ØªÙ‚Ø¯ÙŠØ± ØªÙ‚Ø±ÙŠØ¨ÙŠ ÙÙ‚Ø·</div>
          </div>
        </div>

        <div>
          <div id="fluidResult" class="result-box muted">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§</div>
        </div>
      </div>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,0.05);margin:16px 0">
      <h3>ğŸ’¬ Ø´Ø§Øª AI Ø·Ø¨ÙŠ</h3>
      <div class="chatBox" id="fluidChat"></div>
      <textarea id="fluidChatInput" placeholder="Ø§Ø³Ø£Ù„ Ø¹Ù† Ø§Ù„Ø³ÙˆØ§Ø¦Ù„/Ù†Ù‚Ù„ Ø§Ù„Ø¯Ù…..."></textarea>
      <div style="margin-top:8px"><button class="btn" id="fluidChatSend">Ø£Ø±Ø³Ù„</button></div>
    </div>

    <!-- ========== Airway panel ========== -->
    <div id="panelAirway" class="panel">
      <h2>ğŸ« Ø§Ù„Ù„Ø§Ø±Ù†ØºÙˆØ³ÙƒÙˆØ¨ Ùˆ ETT</h2>
      <div class="grid">
        <div>
          <label>Ø¹Ù…Ø± Ø§Ù„Ù…Ø±ÙŠØ¶
            <div style="display:flex;gap:8px">
              <input id="ageAirway" type="number" placeholder="Ù…Ø«Ù„Ø§Ù‹ 3" min="0" step="0.1" style="flex:1">
              <select id="ageUnitAirway" style="width:120px">
                <option value="years">Ø³Ù†ÙˆØ§Øª</option>
                <option value="months">Ø£Ø´Ù‡Ø±</option>
                <option value="days">Ø£ÙŠØ§Ù…</option>
              </select>
            </div>
          </label>

          <label>ÙˆØ²Ù† Ø§Ù„Ù…Ø±ÙŠØ¶ (ÙƒØº)
            <input id="weightAirway" type="number" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ" min="0" step="0.1">
          </label>

          <div style="margin-top:8px" class="controls-row">
            <button class="btn" id="calcAirway">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨</button>
            <div class="small-muted" style="margin-left:8px">Ø­Ø³Ø§Ø¨ ØªÙ‚Ø±ÙŠØ¨ÙŠ</div>
          </div>
        </div>

        <div>
          <div id="airwayResult" class="result-box muted">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§</div>
        </div>
      </div>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,0.05);margin:16px 0">
      <h3>ğŸ’¬ Ø´Ø§Øª AI Ø·Ø¨ÙŠ</h3>
      <div class="chatBox" id="airwayChat"></div>
      <textarea id="airwayChatInput" placeholder="Ø§Ø³Ø£Ù„ Ø¹Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø´ÙØ±Ø© Ø£Ùˆ Ø­Ø¬Ù… ETT..."></textarea>
      <div style="margin-top:8px"><button class="btn" id="airwayChatSend">Ø£Ø±Ø³Ù„</button></div>
    </div>

    <!-- ========== Admin panel ========== -->
    <div id="panelAdmin" class="panel">
      <h2>âš™ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… (Admin)</h2>
      <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        <input id="adminPass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
      </label>
      <div style="margin-top:8px">
        <button class="btn" id="loginAdmin">Ø¯Ø®ÙˆÙ„</button>
      </div>
      <div id="adminPanelContent" style="margin-top:12px" class="muted">Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ ÙÙ‚Ø· (ÙˆØ¸Ø§Ø¦Ù Ù…Ø­Ø¯ÙˆØ¯Ø© Ù…Ø­Ù„ÙŠØ§Ù‹)</div>
    </div>

    <footer>Â© Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ®Ø¯ÙŠØ± â€” Ø±Ø§Ø¬Ø¹ Ø¯ÙˆÙ…Ø§Ù‹ Ø§Ù„Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ±ÙŠØ© Ù‚Ø¨Ù„ Ø¥Ø¹Ø·Ø§Ø¡ Ø£ÙŠ Ø¬Ø±Ø¹Ø©</footer>
  </div>
</div>

<script>
/* ========== Initialization & Splash handling ========== */
document.addEventListener('DOMContentLoaded', ()=>{

  // hide splash after animation (5s) + small delay
  setTimeout(()=>{
    const splash = document.getElementById('splash');
    splash.style.transition = 'opacity .6s ease, transform .6s ease';
    splash.style.opacity = '0';
    splash.style.transform = 'translateY(-20px)';
    setTimeout(()=>{ splash.style.display='none'; document.getElementById('app').style.display='block'; },650);
  }, 5000); // bars animation duration = 5s

  // Panel switching
  const panels = { showDose:'panelDose', showFluids:'panelFluids', showAirway:'panelAirway', showAdmin:'panelAdmin' };
  Object.keys(panels).forEach(btnId=>{
    document.getElementById(btnId).addEventListener('click', ()=>{
      Object.values(panels).forEach(pid => document.getElementById(pid).style.display='none');
      document.getElementById(panels[btnId]).style.display='block';
      window.scrollTo({top:0, behavior:'smooth'});
    });
  });
  // default
  document.getElementById('showDose').click();

  /* ========== Drug database (doses per age category) ========== */
  const drugData = {
    "Propofol":{
      dose:{ infant:[2.5,3.0], child:[2.0,2.5], adult:2.5 },
      max:{value:300,unit:'mg'}, unitPerKg:'mg/kg',
      side_effects:["Ø§Ù†Ø®ÙØ§Ø¶ Ø¶ØºØ· Ø§Ù„Ø¯Ù…","ØªÙˆÙ‚Ù ØªÙ†ÙØ³ Ù…Ø¤Ù‚Øª","Ø£Ù„Ù… Ø¹Ù†Ø¯ Ø§Ù„Ø­Ù‚Ù†","Propofol infusion syndrome Ø¹Ù†Ø¯ ØªØ³Ø±ÙŠØ¨ Ø·ÙˆÙŠÙ„"],
      management:["Ø³ÙˆØ§Ø¦Ù„ Ùˆ/Ø£Ùˆ Vasopressors","ØªÙ‡ÙˆÙŠØ© ÙˆØ£ÙƒØ³Ø¬ÙŠÙ†","Lidocaine Ù‚Ø¨Ù„ Ø§Ù„Ø­Ù‚Ù†","Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¯ÙˆØ§Ø¡ ÙˆØ¯Ø¹Ù… Ù‚Ù„Ø¨/ÙƒÙ„Ù‰"]
    },
    "Midazolam":{
      dose:{ infant:[0.05,0.1], child:[0.05,0.2], adult:0.15 },
      max:{value:10,unit:'mg'}, unitPerKg:'mg/kg',
      side_effects:["ØªÙ‡Ø¯Ø¦Ø© Ù…ÙØ±Ø·Ø©","Ø§Ù†Ø®ÙØ§Ø¶ Ø¶ØºØ·","Ø±Ø¯ ÙØ¹Ù„ Ø¹ÙƒØ³ÙŠ"],
      management:["Ù…Ø±Ø§Ù‚Ø¨Ø©ØŒ Ø¯Ø¹Ù… ØªÙ†ÙØ³ÙŠ","ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¬Ø±Ø¹Ø©","Flumazenil ÙƒÙ…Ø¶Ø§Ø¯ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©"]
    },
    "Fentanyl":{
      dose:{ infant:[1,2], child:[2,3], adult:2 }, // Âµg/kg
      max:{value:300,unit:'Âµg'}, unitPerKg:'Âµg/kg',
      side_effects:["ØªØ«Ø¨ÙŠØ· ØªÙ†ÙØ³ÙŠ","ØªØ¨Ø§Ø·Ø¤ Ù‚Ù„Ø¨","ØºØ«ÙŠØ§Ù†/Ù‚ÙŠØ¡"],
      management:["Ø¯Ø¹Ù… ØªÙ†ÙØ³ÙŠØŒ Naloxone","Ù…Ø±Ø§Ù‚Ø¨Ø© Ù‚Ù„Ø¨ÙŠØ©","Ø£Ø¯ÙˆÙŠØ© Ù…Ø¶Ø§Ø¯Ø© Ù„Ù„ØºØ«ÙŠØ§Ù†"]
    },
    "Ketamine":{
      dose:{ infant:[2,3], child:[4,5], adult:1.5 }, // mg/kg (induction varies)
      max:{value:300,unit:'mg'}, unitPerKg:'mg/kg',
      side_effects:["Ø²ÙŠØ§Ø¯Ø© Ø¶ØºØ· Ø§Ù„Ø¯Ù…","ØªÙŠØ¨Ø³ Ø¹Ø¶Ù„ÙŠ","Ù‡Ù„ÙˆØ³Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¥ÙØ§Ù‚Ø©"],
      management:["Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¶ØºØ· Ø§Ù„Ø¯Ù…","Midazolam Ù„Ù„ØªÙ‡Ø¯Ø¦Ø©","Ø¨ÙŠØ¦Ø© Ù‡Ø§Ø¯Ø¦Ø©"]
    },
    "Thiopental":{
      dose:{ infant:[10,15], child:[10,12.5], adult:12.5 },
      max:{value:400,unit:'mg'}, unitPerKg:'mg/kg',
      side_effects:["ÙƒØ¨Øª ØªÙ†ÙØ³ÙŠ","Ù‡Ø¨ÙˆØ· Ø¶ØºØ·"],
      management:["ØªÙ‡ÙˆÙŠØ©/Ø£ÙƒØ³Ø¬ÙŠÙ†","Ø¯Ø¹Ù… Ø¶ØºØ· Ø§Ù„Ø¯Ù…"]
    },
    "Etomidate":{
      dose:{ infant:[0.15,0.3], child:[0.2,0.3], adult:0.3 },
      max:{value:40,unit:'mg'}, unitPerKg:'mg/kg',
      side_effects:["Myoclonus","ÙƒØ¨Øª Ù‚Ø´Ø± Ø§Ù„ÙƒØ¸Ø±"],
      management:["Benzodiazepine Ù„Ù„ØªÙ‚Ù„ÙŠÙ„","Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‚ØµÙŠØ±"]
    },
    "Dexmedetomidine":{
      dose:{ infant:[0.5,1.0], child:[1.0,2.0], adult:1.0 }, // Âµg/kg (simplified)
      max:{value:200,unit:'Âµg'}, unitPerKg:'Âµg/kg',
      side_effects:["Ø¨Ø·Ø¡ Ù‚Ù„Ø¨","Ù‡Ø¨ÙˆØ· Ø¶ØºØ·"],
      management:["Ù…Ø±Ø§Ù‚Ø¨Ø© Ù‚Ù„Ø¨ÙŠØ©","Ø¹Ù„Ø§Ø¬ Ø¯Ø§Ø¹Ù… Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©"]
    },
    "Isoflurane":{
      dose:{ infant:[1.3,1.6], child:[1.3,1.6], adult:1.45 },
      max:{value:100,unit:'%MAC'}, unitPerKg:'%MAC',
      side_effects:["Ù‡Ø¨ÙˆØ· Ø¶ØºØ·","ÙƒØ¨Øª ØªÙ†ÙØ³ÙŠ"],
      management:["ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØ±ÙƒÙŠØ²ØŒ Ø¯Ø¹Ù… ØªÙ†ÙØ³ÙŠ ÙˆÙ…Ø±Ø¶ÙŠ"]
    },
    "Succinylcholine":{
      dose:{ infant:[1,2], child:[1,2], adult:1.5 },
      max:{value:200,unit:'mg'}, unitPerKg:'mg/kg',
      side_effects:["Hyperkalemia","MH (Ù†Ø§Ø¯Ø±Ø§Ù‹)"],
      management:["ØªÙ‡ÙˆÙŠØ© Ø§ØµØ·Ù†Ø§Ø¹ÙŠØ©ØŒ Dantrolene Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©"]
    },
    "Lidocaine":{
      dose:{ infant:[1,2], child:[2,3], adult:3 },
      max:{value:300,unit:'mg'}, unitPerKg:'mg/kg',
      side_effects:["ØªØ´Ù†Ø¬Ø§Øª","Ù‡Ø¨ÙˆØ· Ø¶ØºØ·"],
      management:["Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø±ÙŠØ¨ØŒ Benzodiazepine Ù„Ù„ØªØ´Ù†Ø¬Ø§Øª"]
    },
    "Bupivacaine":{
      dose:{ infant:[1,2], child:[2,2], adult:2 },
      max:{value:200,unit:'mg'}, unitPerKg:'mg/kg',
      side_effects:["Ø³Ù…ÙŠØ© Ù‚Ù„Ø¨ÙŠØ©","ØªØ´Ù†Ø¬Ø§Øª"],
      management:["Intralipid 20%ØŒ Ø¯Ø¹Ù… Ù‚Ù„Ø¨/ØªÙ†ÙØ³"]
    }
  };

  // populate drugs select
  const drugSelect = document.getElementById('drugDose');
  for(const d of Object.keys(drugData)){
    const o = document.createElement('option'); o.value = d; o.textContent = d; drugSelect.appendChild(o);
  }

  // disease UI toggle
  const patientHealth = document.getElementById('patientHealth');
  const diseaseDiv = document.getElementById('diseaseDiv');
  patientHealth.addEventListener('change', ()=> {
    diseaseDiv.style.display = patientHealth.value === 'unhealthy' ? 'block' : 'none';
    if(patientHealth.value === 'healthy'){
      document.querySelectorAll('.diseaseChk').forEach(c=>c.checked=false);
    }
  });

  // ASA factors (conservative multipliers)
  const asaFactors = { I:1.00, II:0.95, III:0.85, IV:0.75, V:0.65 };

  // disease multipliers (multiplicative)
  const diseaseFactors = {
    diabetes:0.95, heart:0.80, lung:0.85, liver:0.70, kidney:0.75, allergy:0.90, obesity:1.05
  };

  // helpers
  function toYears(val, unit){
    const v = parseFloat(val);
    if(isNaN(v) || v < 0) return NaN;
    if(unit === 'years') return v;
    if(unit === 'months') return v/12;
    if(unit === 'days') return v/365;
    return v;
  }
  function ageCategory(years){
    if(years < 1) return 'infant';
    if(years < 12) return 'child';
    return 'adult';
  }
  function avgDose(dv){
    return Array.isArray(dv) ? (dv[0]+dv[1])/2 : dv;
  }

  // calculation core
  function calculateTotalDose(drugName, weightKg, ageYears, asaClass, diseases){
    const doc = drugData[drugName];
    if(!doc) return null;
    const cat = ageCategory(ageYears);
    const perKg = avgDose(doc.dose[cat]); // mg/kg or Âµg/kg or %MAC (if unitPerKg is %MAC)
    if(doc.unitPerKg === '%MAC'){
      // gas concentration, adjust by ASA/diseases but not by weight
      let factor = asaFactors[asaClass] || 1.0;
      diseases.forEach(d => { if(diseaseFactors[d]) factor *= diseaseFactors[d]; });
      return { value: (perKg * factor).toFixed(2), unit: '% MAC', note: 'ØªØ±ÙƒÙŠØ² ØºØ§Ø²ÙŠ ØªÙ‚Ø±ÙŠØ¨ÙŠ' };
    }
    // numeric total
    let total = perKg * weightKg;
    // ASA
    total *= (asaFactors[asaClas
