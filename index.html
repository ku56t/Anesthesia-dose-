<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>نظام التخدير الطبي - كامل</title>
<style>
body{font-family:Arial,sans-serif;direction:rtl;background:#f0f2f5;margin:0;padding:20px}
.wrap{max-width:1000px;margin:0 auto}
h1{color:#0a5275;text-align:center}
.row{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px;justify-content:center}
.btn{padding:10px 14px;border-radius:8px;border:none;background:#007bff;color:#fff;cursor:pointer}
.btn:active{transform:translateY(1px)}
.panel{background:#fff;padding:18px;border-radius:12px;box-shadow:0 4px 18px rgba(0,0,0,.06);margin-top:16px;display:none}
label{display:block;text-align:right;margin:6px 0}
input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #cfcfcf;margin-top:6px}
.sideEffect{background:#fff6f6;border-left:4px solid #ff6b6b;padding:10px;margin:8px 0;border-radius:6px;text-align:right}
.chatBox{height:150px;overflow:auto;padding:10px;background:#eef2f7;border-radius:8px;margin-bottom:8px}
.muted{color:#666;font-size:13px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
</style>
</head>
<body>
<div class="wrap">
<h1>🚑 نظام التخدير الطبي - كامل</h1>

<div class="row">
<button class="btn" id="showDose">حساب الجرعات</button>
<button class="btn" id="showFluids">حساب السوائل والدم</button>
<button class="btn" id="showAirway">الارنغوسكوب و ETT</button>
<button class="btn" id="showAdmin">لوحة التحكم</button>
</div>

<!-- ==================== حساب الجرعات ==================== -->
<div class="panel" id="panelDose">
<h2>💉 حساب جرعات التخدير</h2>
<div class="grid">
<div>
<label>وزن المريض (كغ)
<input id="weightDose" type="number" min="0" step="0.1">
</label>
<label>عمر المريض
<div style="display:flex;gap:8px">
<input id="ageDose" type="number" min="0" step="1">
<select id="ageUnitDose" style="width:150px">
<option value="years">سنوات</option>
<option value="months">أشهر</option>
<option value="days">أيام</option>
</select>
</div>
</label>
<label>حالة المريض
<select id="patientHealth">
  <option value="healthy">صحي</option>
  <option value="unhealthy">غير صحي</option>
</select>
</label>
<div id="diseaseDiv" style="display:none;margin-top:8px">
<label>اختر المرض
<select id="patientDisease">
  <option value="diabetes">سكري</option>
  <option value="heart">أمراض قلب</option>
  <option value="liver">أمراض كبد</option>
  <option value="kidney">أمراض كلى</option>
  <option value="allergy">تحسس / حساسية</option>
</select>
</label>
</div>
<label>اختر الدواء
<select id="drugDose"></select>
</label>
<button class="btn" id="calcDose">احسب الجرعة</button>
</div>
<div>
<div id="doseResult" class="muted"></div>
<div id="doseEffects" style="margin-top:12px"></div>
</div>
</div>
<h3>💬 شات AI طبي</h3>
<div class="chatBox" id="doseChat"></div>
<textarea id="doseChatInput" placeholder="اكتب سؤالك هنا..."></textarea>
<button class="btn" id="doseChatSend">أرسل</button>
</div>

<!-- ==================== السوائل والدم ==================== -->
<div class="panel" id="panelFluids">
<h2>💧 حساب السوائل والدم</h2>
<label>وزن المريض (كغ)
<input id="weightFluid" type="number" min="0" step="0.1">
</label>
<label>حالة المريض
<select id="healthFluid">
  <option value="healthy">صحي</option>
  <option value="unhealthy">غير صحي</option>
</select>
</label>
<button class="btn" id="calcFluids">احسب السوائل</button>
<div id="fluidResult" class="muted" style="margin-top:12px"></div>

<h3>💬 شات AI طبي</h3>
<div class="chatBox" id="fluidChat"></div>
<textarea id="fluidChatInput" placeholder="اكتب سؤالك هنا..."></textarea>
<button class="btn" id="fluidChatSend">أرسل</button>
</div>

<!-- ==================== اللارنغوسكوب ==================== -->
<div class="panel" id="panelAirway">
<h2>🫁 اللارنغوسكوب و ETT</h2>
<label>عمر المريض
<input id="ageAirway" type="number" min="0">
</label>
<label>وزن المريض (كغ)
<input id="weightAirway" type="number" min="0" step="0.1">
</label>
<button class="btn" id="calcAirway">اختر الحجم المناسب</button>
<div id="airwayResult" class="muted" style="margin-top:12px"></div>

<h3>💬 شات AI طبي</h3>
<div class="chatBox" id="airwayChat"></div>
<textarea id="airwayChatInput" placeholder="اكتب سؤالك هنا..."></textarea>
<button class="btn" id="airwayChatSend">أرسل</button>
</div>

<!-- ==================== لوحة التحكم ==================== -->
<div class="panel" id="panelAdmin">
<h2>⚙️ لوحة تحكم Admin</h2>
<label>كلمة المرور
<input type="password" id="adminPass">
</label>
<button class="btn" id="loginAdmin">دخول</button>
<div id="adminPanelContent" style="margin-top:12px"></div>
</div>

<script type="module">
// --- شيفرة OpenAI ---
import OpenAI from "https://cdn.jsdelivr.net/npm/openai@4.9.0/dist/openai.min.js";
const openai = new OpenAI({ apiKey: "YOUR_API_KEY_HERE" });

// ==================== قاعدة الأدوية ====================
let drugData = {
  "Propofol": { "baseDose": 2.5, "unit":"mg/kg", "doses":[{"dose":"2–6 mg/kg IV","side_effects":["انخفاض ضغط الدم","توقف تنفس مؤقت","ألم عند الحقن"],"management":["التهوية الاصطناعية + أكسجين","إبطاء الحقن","استخدام Lidocaine لتقليل الألم"]}]},
  "Midazolam": {"baseDose":0.15,"unit":"mg/kg","doses":[{"dose":"0.07–0.2 mg/kg IV/IM","side_effects":["تهدئة مفرطة","انخفاض ضغط","رد فعل عكسي (هياج)"],"management":["Flumazenil كمضاد 0.01 mg/kg IV","تقليل الجرعة أو إيقاف الدواء"]}]},
  "Fentanyl":{"baseDose":5,"unit":"µg/kg","doses":[{"dose":"2–10 µg/kg IV bolus أو CRI","side_effects":["تثبيط تنفسي","تباطؤ قلب","غثيان / تقيؤ"],"management":["Naloxone كمضاد 0.02–0.04 mg/kg IV","دعم تنفسي وأكسجين"]}]},
  "Ketamine":{"baseDose":5,"unit":"mg/kg","doses":[{"dose":"5 mg/kg IV أو 10 mg/kg IM","side_effects":["زيادة ضغط الدم","تيبّس عضلي","هلوسة عند الإفاقة"],"management":["Midazolam أو Diazepam لتقليل الهلوسة","مراقبة القلب والتنفس","بيئة هادئة"]}]},
  "Thiopental":{"baseDose":12.5,"unit":"mg/kg","doses":[{"dose":"10–15 mg/kg IV","side_effects":["تثبيط تنفسي حاد","انخفاض ضغط","تخدير مطوّل عند الجرعة العالية"],"management":["أكسجين + تهوية","دعم ضغط الدم"]}]},
  "Etomidate":{"baseDose":0.3,"unit":"mg/kg","doses":[{"dose":"0.2–0.4 mg/kg IV","side_effects":["Myoclonus","كبت الغدة الكظرية","غثيان وتقيؤ"],"management":["Benzodiazepines للحد من Myoclonus","استخدام قصير فقط","مراقبة الكورتيزول"]}]},
  "Dexmedetomidine":{"baseDose":7.5,"unit":"µg/kg","doses":[{"dose":"5–10 µg/kg IV","side_effects":["بطء قلب","ارتفاع ضغط ثم انخفاض","إقياء"],"management":["Atipamezole كمضاد 50 µg/kg IM","مراقبة قلبية دقيقة"]}]},
  "Isoflurane":{"baseDose":1.45,"unit":"% MAC","doses":[{"dose":"MAC 1.3–1.6%","side_effects":["انخفاض ضغط","كبت تنفسي","تحسس عضلة القلب للأدرينالين"],"management":["تعديل تركيز الغاز","دعم التنفس والضغط"]}]},
  "Succinylcholine":{"baseDose":1.5,"unit":"mg/kg","doses":[{"dose":"1–2 mg/kg IV","side_effects":["شلل عضلي مؤقت","Hyperkalemia","Malignant Hyperthermia"],"management":["تهوية اصطناعية إلزامية","Dantrolene عند MH","تجنب في حروق أو إصابات عضلية"]}]},
  "Lidocaine":{"baseDose":3,"unit":"mg/kg","doses":[{"dose":"2–4 mg/kg IV bolus أو CRI","side_effects":["تشنجات","انخفاض ضغط","بطء قلب"],"management":["إيقاف التسريب فوراً","Benzodiazepines لعلاج التشنجات","دعم الضغط والسوائل"]}]},
  "Bupivacaine":{"baseDose":2,"unit":"mg/kg","doses":[{"dose":"2 mg/kg كحد أقصى","side_effects":["سمية قلبية","تشنجات","تثبيط تنفسي"],"management":["Intralipid Therapy 20%","CPR ودعم تنفسي"]}]}
};

// ==================== عرض الأدوية ====================
const drugSelect = document.getElementById('drugDose');
for(let drug in drugData){
  let opt = document.createElement('option');
  opt.value = drug;
  opt.textContent = drug;
  drugSelect.appendChild(opt);
}

// ==================== التحكم في ظهور الأمراض ====================
const patientHealth = document.getElementById('patientHealth');
const diseaseDiv = document.getElementById('diseaseDiv');
patientHealth.addEventListener('change', ()=>{diseaseDiv.style.display = patientHealth.value==='unhealthy'?'block':'none';});
function getSelectedCondition(){return patientHealth.value==='healthy'?'healthy':document.getElementById('patientDisease').value;}

// ==================== تعديل الجرعة ====================
function adjustDoseByCondition(dose, unit, condition){
  let factor=1;
  switch(condition){
    case "healthy": factor=1; break;
    case "diabetes": factor=0.9; break;
    case "heart": factor=0.8; break;
    case "liver": factor=0.7; break;
    case "kidney": factor=0.75; break;
    case "allergy": factor=0.85; break;
  }
  let adjusted = dose*factor;
  return unit.includes("mg")?adjusted.toFixed(2)+" mg":adjusted.toFixed(0)+" µg";
}

// ==================== حساب الجرعة ====================
document.getElementById('calcDose').addEventListener('click', ()=>{
  let weight=parseFloat(document.getElementById('weightDose').value);
  let drug=drugSelect.value;
  if(!weight||!drug){alert('ادخل الوزن والدواء');return;}
  let condition=getSelectedCondition();
  let data=drugData[drug];
  let adjustedDose=adjustDoseByCondition(data.baseDose*weight,data.unit,condition);
  document.getElementById('doseResult').innerHTML=`<b>الجرعة:</b> ${adjustedDose}`;
  let effHTML='';
  data.doses[0].side_effects.forEach((se,i)=>{
    effHTML+=`<div class="sideEffect"><b>عرض جانبي:</b> ${se}<br><b>التعامل:</b> ${data.doses[0].management[i]||''}</div>`;
  });
  document.getElementById('doseEffects').innerHTML=effHTML;
});

// ==================== حساب السوائل والدم ====================
document.getElementById('calcFluids').addEventListener('click', ()=>{
  let w=parseFloat(document.getElementById('weightFluid').value);
  if(!w){alert('ادخل الوزن'); return;}
  let fluid= (w*30).toFixed(0)+" ml/24h"; // تبسيط: 30 ml/kg/24h
  document.getElementById('fluidResult').innerHTML=`💧 كمية السوائل: ${fluid}`;
});

// ==================== حساب اللارنغوسكوب ====================
document.getElementById('calcAirway').addEventListener('click', ()=>{
  let age=parseFloat(document.getElementById('ageAirway').value);
  let w=parseFloat(document.getElementById('weightAirway').value);
  if(!age||!w){alert('ادخل العمر والوزن');return;}
  let size;
  if(age<1) size="0"; else if(age<2) size="1"; else if(age<5) size="2"; else if(age<10) size="3"; else size="4-5 (بالغ)";
  document.getElementById('airwayResult').innerHTML=`حجم اللارنغوسكوب المناسب: ${size}`;
});

// ==================== لوحة التحكم ====================
document.getElementById('loginAdmin').addEventListener('click', ()=>{
  let pass=document.getElementById('adminPass').value;
  if(pass==="mustafa@2006#2"){
    document.getElementById('adminPanelContent').innerHTML="<p>مرحباً بك في لوحة التحكم! يمكنك تعديل واجهة الموقع وإدارة الأدوية والصلاحيات.</p>";
  } else alert("كلمة المرور خاطئة!");
});

// ==================== التحكم في عرض الأقسام ====================
const panels={showDose:'panelDose', showFluids:'panelFluids', showAirway:'panelAirway', showAdmin:'panelAdmin'};
for(let btnId in panels){
  document.getElementById(btnId).addEventListener('click', ()=>{
    for(let p in panels) document.getElementById(panels[p]).style.display='none';
    document.getElementById(panels[btnId]).style.display='block';
  });
}

// ==================== شات AI لكل قسم ====================
// مثال: قسم الجرعات
document.getElementById('doseChatSend').addEventListener('click', async ()=>{
  const msg=document.getElementById('doseChatInput').value; if(!msg) return;
  let chatBox=document.getElementById('doseChat');
  chatBox.innerHTML+=`<div><b>أنت:</b> ${msg}</div>`;
  document.getElementById('doseChatInput').value='';
  // --- رد افتراضي مؤقت --- (يمكن ربط OpenAI هنا)
  chatBox.innerHTML+=`<div><b>AI:</b> سيتم الرد هنا...</div>`;
  chatBox.scrollTop=chatBox.scrollHeight;
});

// نفس المنطق يمكن نسخه للأقسام الأخرى
</script>
</div>
</body>
</html>
