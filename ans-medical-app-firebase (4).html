<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© ANS Ø§Ù„Ø·Ø¨ÙŠØ© â€” Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª Ø§Ù„Ù…ØªØ·ÙˆØ±</title>
    <meta name="description" content="ØªØ·Ø¨ÙŠÙ‚ Ù…ØªÙ‚Ø¯Ù… Ù„Ø­Ø³Ø§Ø¨ Ø¬Ø±Ø¹Ø§Øª Ø§Ù„ØªØ®Ø¯ÙŠØ± ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ ÙˆØ§Ù„Ø¯Ù… Ù…Ø¹ Firebase authentication">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200..1000&family=Noto+Sans+Arabic:wght@100..900&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged, createUserWithEmailAndPassword, GoogleAuthProvider, signInWithPopup, signInWithRedirect, getRedirectResult } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc, query, where, getDocs, updateDoc, deleteDoc, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Firebase configuration - Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø´Ø±ÙˆØ¹ Firebase Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
        const firebaseConfig = {
            apiKey: "AIzaSyAZUYrFNedms77FWlksMJV3yCETywoJAZw",
            authDomain: "anesthesia-dose-262e3.firebaseapp.com",
            projectId: "anesthesia-dose-262e3",
            storageBucket: "anesthesia-dose-262e3.firebasestorage.app",
            messagingSenderId: "602244448093",
            appId: "1:602244448093:web:0a8d9905849126086ff2b4",
            measurementId: "G-SCHMQFCK3J"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Global variables
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.googleProvider = new GoogleAuthProvider();
        window.firebaseAuthFunctions = {
            signInWithEmailAndPassword,
            signOut,
            onAuthStateChanged,
            createUserWithEmailAndPassword,
            signInWithPopup,
            signInWithRedirect,
            getRedirectResult,
            GoogleAuthProvider
        };
        window.firebaseDbFunctions = {
            doc, setDoc, getDoc, collection, addDoc, query, where, getDocs, updateDoc, deleteDoc, orderBy
        };
    </script>
    
    <style>
        /* === CSS VARIABLES & BASE STYLES === */
        :root {
            --bg-dark: #071223;
            --bg-dark-2: #0b3045;
            --card: #0f2333;
            --accent: #0a9bd6;
            --accent-2: #11cdef;
            --glass: rgba(255,255,255,0.04);
            --success: #16a34a;
            --danger: #ff5252;
            --warning: #f59e0b;
            --text: #e6f6ff;
            --text-muted: #93c1d8;
            --border: rgba(255,255,255,0.06);
            --radius: 12px;
            --font-sans: 'Cairo', 'Noto Sans Arabic', Tahoma, Arial, sans-serif;
        }

        /* Light Theme */
        body.light {
            --bg-dark: #f5f8fb;
            --bg-dark-2: #ffffff;
            --card: #ffffff;
            --text: #052036;
            --text-muted: #475569;
            --border: #e6eef6;
            --glass: rgba(0,0,0,0.02);
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: var(--font-sans);
            background: linear-gradient(180deg, var(--bg-dark), var(--bg-dark-2));
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            transition: background 0.35s, color 0.35s;
            direction: rtl;
        }

        /* === LOGIN SCREEN === */
        #login-screen {
            position: fixed;
            inset: 0;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #071024 0%, #06293a 70%);
        }

        .login-container {
            background: linear-gradient(180deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .login-title {
            text-align: center;
            color: #eaf6ff;
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 30px;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .login-input {
            width: 100%;
            padding: 15px 20px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.1);
            color: #eaf6ff;
            font-family: var(--font-sans);
            font-size: 16px;
            direction: rtl;
        }

        .login-input::placeholder {
            color: rgba(234, 246, 255, 0.7);
        }

        .login-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(10, 155, 214, 0.3);
        }

        .login-btn {
            padding: 15px 30px;
            border-radius: 12px;
            border: none;
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            color: var(--bg-dark);
            cursor: pointer;
            font-weight: 700;
            font-family: var(--font-sans);
            font-size: 16px;
            transition: all 0.3s;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(10, 155, 214, 0.4);
        }

        .login-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .login-error {
            color: var(--danger);
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            line-height: 1.4;
            white-space: pre-line;
            padding: 10px;
            background: rgba(255, 82, 82, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(255, 82, 82, 0.3);
        }

        .login-toggle {
            text-align: center;
            margin-top: 20px;
            color: rgba(234, 246, 255, 0.8);
            font-size: 14px;
        }

        .login-toggle button {
            background: none;
            border: none;
            color: var(--accent);
            cursor: pointer;
            text-decoration: underline;
            font-family: var(--font-sans);
        }

        /* === MAIN APPLICATION === */
        .app-container {
            position: relative;
            z-index: 10;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: none;
        }

        .main-card {
            background: linear-gradient(180deg, var(--glass), rgba(255,255,255,0.01));
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        /* === HEADER === */
        .header {
            padding: 16px 24px;
            text-align: center;
            font-weight: 700;
            background: linear-gradient(90deg, #072a40, #0a5f86);
            color: white;
            box-shadow: 0 6px 20px rgba(2,6,23,0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            margin: 0;
            font-size: 1.3rem;
            flex: 1;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        .logout-btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
            cursor: pointer;
            font-family: var(--font-sans);
            font-size: 12px;
        }

        /* === NAVIGATION === */
        .nav-container {
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }

        .nav-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        /* === BUTTONS === */
        .btn {
            padding: 12px 20px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(90deg, var(--accent), var(--accent-2));
            color: var(--bg-dark);
            cursor: pointer;
            font-weight: 700;
            min-width: 160px;
            font-family: var(--font-sans);
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(10, 155, 214, 0.3);
        }

        .btn.ghost {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
        }

        .btn.ghost:hover {
            background: var(--glass);
            border-color: var(--accent);
        }

        .btn.active {
            opacity: 1;
            background: linear-gradient(90deg, var(--accent-2), var(--accent));
        }

        .btn.inactive {
            opacity: 0.7;
        }

        .btn.danger {
            background: linear-gradient(90deg, var(--danger), #ff7676);
        }

        /* === PANELS === */
        .panel {
            padding: 24px;
            display: none;
        }

        .panel.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }

        .panel-title {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 24px;
            text-align: right;
        }

        /* === FORMS === */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
        }

        @media (min-width: 1024px) {
            .form-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .form-section {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--glass);
            color: var(--text);
            font-family: var(--font-sans);
            font-size: 14px;
            transition: all 0.3s;
            direction: rtl;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(10, 155, 214, 0.1);
        }

        .form-input::placeholder {
            color: var(--text-muted);
            opacity: 0.7;
        }

        .form-row {
            display: flex;
            gap: 12px;
        }

        .form-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 16px;
        }

        /* === RESULTS === */
        .result-box {
            background: linear-gradient(180deg, rgba(0,0,0,0.3), rgba(0,0,0,0.2));
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border);
            min-height: 120px;
        }

        .result-box.success {
            border-color: var(--success);
            background: linear-gradient(180deg, rgba(22,163,74,0.1), rgba(22,163,74,0.05));
        }

        .result-box.warning {
            border-color: var(--warning);
            background: linear-gradient(180deg, rgba(245,158,11,0.1), rgba(245,158,11,0.05));
        }

        .result-box.error {
            border-color: var(--danger);
            background: linear-gradient(180deg, rgba(255,82,82,0.1), rgba(255,82,82,0.05));
        }

        .result-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent);
        }

        .result-unit {
            font-size: 1rem;
            margin-right: 8px;
            color: var(--text-muted);
        }

        .result-details {
            margin-top: 12px;
            font-size: 14px;
            color: var(--text-muted);
            line-height: 1.5;
        }

        /* === USER MANAGEMENT TABLE === */
        .users-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: var(--glass);
            border-radius: 12px;
            overflow: hidden;
        }

        .users-table th,
        .users-table td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid var(--border);
        }

        .users-table th {
            background: var(--accent);
            color: white;
            font-weight: 600;
        }

        .users-table tr:hover {
            background: rgba(255,255,255,0.05);
        }

        .user-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background: rgba(22,163,74,0.2);
            color: var(--success);
        }

        .status-blocked {
            background: rgba(255,82,82,0.2);
            color: var(--danger);
        }

        .status-owner {
            background: rgba(245,158,11,0.2);
            color: var(--warning);
        }

        /* === ANIMATIONS === */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* === UTILITIES === */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-muted { color: var(--text-muted); }
        .text-success { color: var(--success); }
        .text-warning { color: var(--warning); }
        .text-danger { color: var(--danger); }
        .mt-2 { margin-top: 8px; }
        .mt-4 { margin-top: 16px; }
        .mb-2 { margin-bottom: 8px; }
        .mb-4 { margin-bottom: 16px; }
        .flex-1 { flex: 1; }

        /* === RESPONSIVE === */
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .nav-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                min-width: 0;
            }
            
            .header {
                flex-direction: column;
                gap: 10px;
            }
            
            .users-table {
                font-size: 12px;
            }
            
            .users-table th,
            .users-table td {
                padding: 8px 4px;
            }
        }
    </style>
</head>
<body>
    <!-- FIREBASE INSTRUCTIONS MODAL -->
    <div id="firebase-modal" class="hidden" style="position: fixed; inset: 0; z-index: 10000; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; backdrop-filter: blur(5px);">
        <div style="background: linear-gradient(180deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05)); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 30px; width: 90%; max-width: 500px; box-shadow: 0 20px 60px rgba(0,0,0,0.5);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0; color: #eaf6ff;">ğŸ”§ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¥Ø¹Ø¯Ø§Ø¯ Google Authentication</h3>
                <button onclick="hideFirebaseInstructions()" style="background: none; border: none; color: #eaf6ff; font-size: 20px; cursor: pointer;">âœ•</button>
            </div>
            
            <div style="color: #eaf6ff; line-height: 1.6; font-size: 14px;">
                <p><strong>Ù„Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù€ GoogleØŒ Ø§ØªØ¨Ø¹ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·ÙˆØ§Øª:</strong></p>
                
                <ol style="text-align: right; margin-right: 20px;">
                    <li><strong>Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Firebase Console:</strong><br>
                        <a href="https://console.firebase.google.com/" target="_blank" style="color: #11cdef;">https://console.firebase.google.com/</a>
                    </li>
                    
                    <li><strong>Ø§Ø®ØªØ± Ù…Ø´Ø±ÙˆØ¹ "anesthesia-dose-262e3"</strong></li>
                    
                    <li><strong>ÙØ¹Ù‘Ù„ Google Authentication:</strong><br>
                        â€¢ Authentication â†’ Sign-in method<br>
                        â€¢ ÙØ¹Ù‘Ù„ "Google" ÙˆØ§Ø¶ØºØ· Save
                    </li>
                    
                    <li><strong>Ø£Ø¶Ù Ø§Ù„Ù†Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…ÙØµØ±Ø­ Ø¨Ù‡Ø§:</strong><br>
                        â€¢ Authentication â†’ Settings â†’ Authorized domains<br>
                        â€¢ Ø£Ø¶Ù Ù†Ø·Ø§Ù‚ Ù…ÙˆÙ‚Ø¹Ùƒ (Ù…Ø«Ø§Ù„: yoursite.com)
                    </li>
                    
                    <li><strong>ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª OAuth:</strong><br>
                        â€¢ Project Settings â†’ General<br>
                        â€¢ ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Support email
                    </li>
                </ol>
                
                <div style="background: rgba(255,158,11,0.1); border: 1px solid rgba(245,158,11,0.3); border-radius: 8px; padding: 15px; margin-top: 20px;">
                    <strong>âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø©:</strong><br>
                    Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø§Ù†ØªØ¸Ø§Ø± 5-10 Ø¯Ù‚Ø§Ø¦Ù‚ Ø¨Ø¹Ø¯ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø­ØªÙ‰ ØªØµØ¨Ø­ ÙØ¹Ø§Ù„Ø©.
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button type="button" onclick="hideFirebaseInstructions()" class="login-btn" style="min-width: 120px;">ÙÙ‡Ù…Øª</button>
            </div>
        </div>
    </div>

    <!-- LOGIN SCREEN -->
    <div id="login-screen">
        <div class="login-container">
            <div class="login-title">ğŸ¥ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© ANS Ø§Ù„Ø·Ø¨ÙŠØ©</div>
            
            <div id="login-form" class="login-form">
                <input type="email" class="login-input" id="login-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
                <input type="password" class="login-input" id="login-password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                
                <div style="background: rgba(245,158,11,0.1); border: 1px solid rgba(245,158,11,0.3); border-radius: 8px; padding: 10px; margin: 10px 0; font-size: 12px; text-align: center; color: rgba(245,158,11,0.9);">
                    ğŸ‘‘ <strong>Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø§Ù„Ùƒ:</strong> bama47686@gmail.com<br>
                    <strong>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</strong> mustafa@2006#2
                </div>
                
                <button class="login-btn" id="login-btn" type="button" onclick="handleLogin()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                <button class="login-btn" id="google-login-btn" type="button" onclick="handleGoogleLogin()" style="background: #4285f4; margin-top: 10px;">
                    ğŸ”— ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Google
                </button>
                <div id="login-error" class="login-error hidden"></div>
                
                <div class="login-toggle">
                    Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <button onclick="toggleLoginMode()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
                </div>
                
                <div class="login-toggle">
                    Ù…Ø´ÙƒÙ„Ø© ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù€ GoogleØŸ <button onclick="showFirebaseInstructions()">ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯</button>
                </div>
            </div>
            
            <div id="register-form" class="login-form hidden">
                <input type="text" class="login-input" id="register-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" required>
                <input type="email" class="login-input" id="register-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
                <input type="password" class="login-input" id="register-password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)" required>
                <input type="password" class="login-input" id="register-confirm" placeholder="ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                <button class="login-btn" id="register-btn" type="button" onclick="handleRegister()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
                <button class="login-btn" id="google-register-btn" type="button" onclick="handleGoogleLogin()" style="background: #4285f4; margin-top: 10px;">
                    ğŸ”— Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù€ Google
                </button>
                <div id="register-error" class="login-error hidden"></div>
                
                <div class="login-toggle">
                    Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ <button onclick="toggleLoginMode()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                </div>
                
                <div class="login-toggle">
                    Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù€ GoogleØŸ <button onclick="showFirebaseInstructions()">ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MAIN APPLICATION -->
    <div class="app-container" id="app">
        <div class="main-card">
            <!-- HEADER -->
            <div class="header">
                <h1>ğŸ¥ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© ANS Ø§Ù„Ø·Ø¨ÙŠØ© â€” Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª Ø§Ù„Ù…ØªØ·ÙˆØ±</h1>
                <div class="user-info">
                    <span id="user-name">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</span>
                    <span id="user-id" class="text-muted"></span>
                    <button class="logout-btn" onclick="handleLogout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>

            <!-- NAVIGATION -->
            <div class="nav-container">
                <div class="nav-buttons">
                    <button class="btn active" onclick="showPanel('dose')">ğŸ’‰ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª</button>
                    <button class="btn inactive" onclick="showPanel('fluids')">ğŸ’§ Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ ÙˆØ§Ù„Ø¯Ù…</button>
                    <button class="btn inactive" onclick="showPanel('airway')">ğŸ« Ø§Ù„Ù„Ø§Ø±Ù†ØºÙˆØ³ÙƒÙˆØ¨ / ETT</button>
                    <button class="btn inactive" id="admin-btn" onclick="showPanel('admin')" style="display:none">ğŸ‘‘ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ù„Ùƒ</button>
                    <button class="btn ghost" onclick="showPanel('about')">â„¹ï¸ Ø­ÙˆÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</button>
                    <button class="btn ghost" onclick="toggleTheme()">ğŸŒ™ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹</button>
                </div>
            </div>

            <!-- DOSE CALCULATION PANEL -->
            <div id="dose-panel" class="panel active">
                <h2 class="panel-title">ğŸ’‰ Ø­Ø³Ø§Ø¨ Ø¬Ø±Ø¹Ø§Øª Ø§Ù„ØªØ®Ø¯ÙŠØ±</h2>
                
                <div class="form-grid">
                    <div class="form-section">
                        <div class="form-group">
                            <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶</label>
                            <input type="text" class="form-input" id="dose-patient-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Ø§Ù„ÙˆØ²Ù† (ÙƒØº)</label>
                            <input type="number" class="form-input" id="dose-weight" placeholder="Ù…Ø«Ø§Ù„: 70" min="0.5" max="200" step="0.1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø¹Ù…Ø±</label>
                            <div class="form-row">
                                <input type="number" class="form-input flex-1" id="dose-age" placeholder="Ù…Ø«Ø§Ù„: 40" min="0" max="120">
                                <select class="form-select" id="dose-age-unit" style="width:120px">
                                    <option value="years">Ø³Ù†ÙˆØ§Øª</option>
                                    <option value="months">Ø£Ø´Ù‡Ø±</option>
                                    <option value="days">Ø£ÙŠØ§Ù…</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø®Ø¯Ø±</label>
                            <select class="form-select" id="dose-drug">
                                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø®Ø¯Ø± --</option>
                                <option value="propofol">Propofol (Ø¨Ø±ÙˆØ¨ÙˆÙÙˆÙ„)</option>
                                <option value="midazolam">Midazolam (Ù…ÙŠØ¯Ø§Ø²ÙˆÙ„Ø§Ù…)</option>
                                <option value="fentanyl">Fentanyl (ÙÙ†ØªØ§Ù†ÙŠÙ„)</option>
                                <option value="morphine">Morphine (Ù…ÙˆØ±ÙÙŠÙ†)</option>
                                <option value="ketamine">Ketamine (ÙƒÙŠØªØ§Ù…ÙŠÙ†)</option>
                                <option value="atracurium">Atracurium (Ø£ØªØ±Ø§ÙƒÙˆØ±ÙŠÙˆÙ…)</option>
                            </select>
                        </div>

                        <div class="form-controls">
                            <button class="btn" onclick="calculateDose()">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¬Ø±Ø¹Ø©</button>
                            <button class="btn ghost" onclick="clearDoseForm()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                        </div>

                        <div class="text-muted mt-2" style="font-size:12px">
                            âš ï¸ ØªÙ†Ø¨ÙŠÙ‡: Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ù„Ø£ØºØ±Ø§Ø¶ ØªØ¹Ù„ÙŠÙ…ÙŠØ©. ÙŠØ¬Ø¨ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ù…Ø®ØªØµ Ø¯Ø§Ø¦Ù…Ø§Ù‹.
                        </div>
                    </div>

                    <div class="form-section">
                        <div id="dose-result" class="result-box">
                            <strong>Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§</strong>
                            <p class="text-muted mt-2">Ù‚Ù… Ø¨Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø®Ø¯Ø± Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªÙŠØ¬Ø©</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FLUIDS CALCULATION PANEL -->
            <div id="fluids-panel" class="panel">
                <h2 class="panel-title">ğŸ’§ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ ÙˆØ§Ù„Ø¯Ù…</h2>
                
                <div class="form-grid">
                    <div class="form-section">
                        <div class="form-group">
                            <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶</label>
                            <input type="text" class="form-input" id="fluid-patient-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Ø§Ù„ÙˆØ²Ù† (ÙƒØº)</label>
                            <input type="number" class="form-input" id="fluid-weight" placeholder="Ù…Ø«Ø§Ù„: 70" min="0.5" max="200" step="0.1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Ù…Ø¯Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (Ø³Ø§Ø¹Ø§Øª)</label>
                            <input type="number" class="form-input" id="fluid-duration" placeholder="Ù…Ø«Ø§Ù„: 2" min="0.5" max="24" step="0.5">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</label>
                            <select class="form-select" id="fluid-surgery-type">
                                <option value="">-- Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© --</option>
                                <option value="minor">Ø¹Ù…Ù„ÙŠØ© ØµØºØ±Ù‰</option>
                                <option value="moderate">Ø¹Ù…Ù„ÙŠØ© Ù…ØªÙˆØ³Ø·Ø©</option>
                                <option value="major">Ø¹Ù…Ù„ÙŠØ© ÙƒØ¨Ø±Ù‰</option>
                                <option value="emergency">Ø¹Ù…Ù„ÙŠØ© Ø·ÙˆØ§Ø±Ø¦</option>
                            </select>
                        </div>

                        <div class="form-controls">
                            <button class="btn" onclick="calculateFluids()">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø³ÙˆØ§Ø¦Ù„</button>
                            <button class="btn ghost" onclick="clearFluidForm()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                        </div>
                    </div>

                    <div class="form-section">
                        <div id="fluid-result" class="result-box">
                            <strong>Ù†ØªØ§Ø¦Ø¬ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³ÙˆØ§Ø¦Ù„</strong>
                            <p class="text-muted mt-2">Ù‚Ù… Ø¨Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AIRWAY PANEL -->
            <div id="airway-panel" class="panel">
                <h2 class="panel-title">ğŸ« Ø§Ù„Ù„Ø§Ø±Ù†ØºÙˆØ³ÙƒÙˆØ¨ ÙˆØ£Ù†Ø¨ÙˆØ¨ Ø§Ù„Ù‚ØµØ¨Ø© Ø§Ù„Ù‡ÙˆØ§Ø¦ÙŠØ©</h2>
                
                <div class="form-grid">
                    <div class="form-section">
                        <div class="form-group">
                            <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶</label>
                            <input type="text" class="form-input" id="airway-patient-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø¹Ù…Ø± (Ø³Ù†ÙˆØ§Øª)</label>
                            <input type="number" class="form-input" id="airway-age" placeholder="Ù…Ø«Ø§Ù„: 40" min="0" max="120">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Ø§Ù„ÙˆØ²Ù† (ÙƒØº)</label>
                            <input type="number" class="form-input" id="airway-weight" placeholder="Ù…Ø«Ø§Ù„: 70" min="0.5" max="200" step="0.1">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Ø§Ù„Ø¬Ù†Ø³</label>
                            <select class="form-select" id="airway-gender">
                                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³ --</option>
                                <option value="male">Ø°ÙƒØ±</option>
                                <option value="female">Ø£Ù†Ø«Ù‰</option>
                            </select>
                        </div>

                        <div class="form-controls">
                            <button class="btn" onclick="calculateAirway()">Ø§Ø­Ø³Ø¨ Ù…Ø¹Ø¯Ø§Øª Ù…Ø¬Ø±Ù‰ Ø§Ù„Ù‡ÙˆØ§Ø¡</button>
                            <button class="btn ghost" onclick="clearAirwayForm()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                        </div>
                    </div>

                    <div class="form-section">
                        <div id="airway-result" class="result-box">
                            <strong>Ù…Ø¹Ø¯Ø§Øª Ù…Ø¬Ø±Ù‰ Ø§Ù„Ù‡ÙˆØ§Ø¡ Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§</strong>
                            <p class="text-muted mt-2">Ù‚Ù… Ø¨Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆØµÙŠØ§Øª</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ADMIN PANEL -->
            <div id="admin-panel" class="panel">
                <h2 class="panel-title">ğŸ‘‘ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø§Ù„Ùƒ</h2>
                
                <div class="form-grid">
                    <div class="form-section">
                        <div>
                            <h3>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø©</h3>
                            <div class="result-box success">
                                <div class="result-value" id="total-users">0</div>
                                <div class="result-unit">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
                                <div class="result-value" id="active-users">0</div>
                                <div class="result-unit">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</div>
                                <div class="result-value" id="total-calculations">0</div>
                                <div class="result-unit">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</div>
                            </div>
                        </div>

                        <div>
                            <h3>ğŸ› ï¸ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3>
                            <div class="form-controls">
                                <button class="btn" onclick="refreshUsersList()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
                                <button class="btn" onclick="exportAllData()">ğŸ“¤ ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                                <button class="btn danger" onclick="clearAllSystemData()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</button>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div>
                            <h3>ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
                            <div id="users-list">
                                <table class="users-table">
                                    <thead>
                                        <tr>
                                            <th>ID Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                                            <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                                            <th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„</th>
                                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                            <th>Ø¢Ø®Ø± ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</th>
                                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody id="users-tbody">
                                        <!-- Users will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ABOUT PANEL -->
            <div id="about-panel" class="panel">
                <h2 class="panel-title">â„¹ï¸ Ø­ÙˆÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h2>
                
                <div class="form-grid">
                    <div class="form-section">
                        <div>
                            <h3>ğŸ¥ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© ANS Ø§Ù„Ø·Ø¨ÙŠØ©</h3>
                            <p class="text-muted mb-4">
                                ØªØ·Ø¨ÙŠÙ‚ Ù…ØªÙ‚Ø¯Ù… Ù„Ø­Ø³Ø§Ø¨ Ø¬Ø±Ø¹Ø§Øª Ø§Ù„ØªØ®Ø¯ÙŠØ± ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ ÙˆØ§Ù„Ø¯Ù…ØŒ Ù…Ø¹ Ù†Ø¸Ø§Ù… Firebase Ù„Ù„Ù…ØµØ§Ø¯Ù‚Ø© ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†.
                            </p>

                            <h4>Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:</h4>
                            <ul class="text-muted" style="line-height: 1.6">
                                <li>â€¢ Ø­Ø³Ø§Ø¨ Ø¯Ù‚ÙŠÙ‚ Ù„Ø¬Ø±Ø¹Ø§Øª Ø£Ø¯ÙˆÙŠØ© Ø§Ù„ØªØ®Ø¯ÙŠØ± Ø§Ù„Ù…Ø®ØªÙ„ÙØ©</li>
                                <li>â€¢ Ø­Ø³Ø§Ø¨ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</li>
                                <li>â€¢ ØªÙˆØµÙŠØ§Øª Ù…Ø¹Ø¯Ø§Øª Ù…Ø¬Ø±Ù‰ Ø§Ù„Ù‡ÙˆØ§Ø¡ (ETT & Laryngoscope)</li>
                                <li>â€¢ Ù†Ø¸Ø§Ù… Ù…ØµØ§Ø¯Ù‚Ø© Ø¢Ù…Ù† Ù…Ø¹ Firebase</li>
                                <li>â€¢ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ù„Ù…Ø§Ù„Ùƒ</li>
                                <li>â€¢ ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¨ÙŠØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ø¹ Ø¯Ø¹Ù… RTL</li>
                                <li>â€¢ ÙˆØ¶Ø¹ Ù…Ø¸Ù„Ù… ÙˆÙØ§ØªØ­ Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¨Ø¯ÙŠÙ„</li>
                            </ul>

                            <h4 class="mt-4">ÙØ±ÙŠÙ‚ Ø§Ù„ØªØ·ÙˆÙŠØ±:</h4>
                            <div class="result-box">
                                <p><strong>Ù…Ù†Ø¸Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:</strong> Ù…ØµØ·ÙÙ‰ Ø£Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø´ÙƒÙŠØ± (@871c)</p>
                                <p><strong>Ù…Ø·ÙˆØ± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:</strong> Ù…ØµØ·ÙÙ‰ Ù…ÙƒÙŠ Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø¶Ø§ (@ku56t)</p>
                                <p><strong>Ø§Ù„Ø¥Ø´Ø±Ø§Ù Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ:</strong> Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© ANS Ø§Ù„Ø·Ø¨ÙŠØ©</p>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div>
                            <h3>ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h3>
                            <div class="result-box">
                                <p><strong>Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</strong> 3.0.0 Firebase</p>
                                <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</strong> ÙŠÙ†Ø§ÙŠØ± 2024</p>
                                <p><strong>Ù†ÙˆØ¹ Ø§Ù„ØªØ±Ø®ÙŠØµ:</strong> ØªØ¹Ù„ÙŠÙ…ÙŠ - Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© ANS</p>
                                <p><strong>Ø§Ù„Ù„ØºØ©:</strong> Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (RTL)</p>
                                <p><strong>Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©:</strong> Firebase Authentication</p>
                                <p><strong>Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</strong> Firebase Firestore</p>
                                <p><strong>Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª:</strong> HTML5, CSS3, JavaScript ES6+, Firebase</p>
                            </div>
                        </div>

                        <div>
                            <h3 class="text-warning">âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù‡Ù…</h3>
                            <div class="result-box warning">
                                <strong>ØªÙ†Ø¨ÙŠÙ‡ Ø·Ø¨ÙŠ:</strong> Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø®ØµØµ Ù„Ù„Ø£ØºØ±Ø§Ø¶ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙˆØ§Ù„Ù…Ø±Ø¬Ø¹ÙŠØ© ÙÙ‚Ø·. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ØªÙ‚Ø±ÙŠØ¨ÙŠØ© ÙˆÙŠØ¬Ø¨ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ù…Ø®ØªØµ Ø£Ùˆ Ø§Ù„Ù…Ø±Ø¬Ø¹ Ø§Ù„Ø·Ø¨ÙŠ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ Ù‚Ø¨Ù„ ØªØ·Ø¨ÙŠÙ‚ Ø£ÙŠ Ø¬Ø±Ø¹Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±Ø¶Ù‰.
                                <br><br>
                                <strong>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©:</strong> Ù„Ø§ ÙŠØªØ­Ù…Ù„ Ù…Ø·ÙˆØ±Ùˆ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø£ÙŠ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø¹Ù† Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø®Ø§Ø·Ø¦ Ù„Ù„Ù†ØªØ§Ø¦Ø¬.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FOOTER -->
            <div class="footer" style="padding: 16px 24px; text-align: center; color: var(--text-muted); font-size: 13px; border-top: 1px solid var(--border);">
                <p>Â© 2024 Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© ANS Ø§Ù„Ø·Ø¨ÙŠØ© - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
                <p>ØªØ·Ø¨ÙŠÙ‚ ØªØ¹Ù„ÙŠÙ…ÙŠ Ù…ØªØ®ØµØµ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø¬Ø±Ø¹Ø§Øª Ø§Ù„ØªØ®Ø¯ÙŠØ± Ù…Ø¹ Firebase Authentication</p>
            </div>
        </div>
    </div>

    <script>
        // === GLOBAL VARIABLES ===
        let currentUser = null;
        let userData = {};
        let isLoginMode = true;

        // === DRUG DATABASE ===
        const drugDatabase = {
            propofol: {
                name: 'Propofol (Ø¨Ø±ÙˆØ¨ÙˆÙÙˆÙ„)',
                induction: { dose: '2-2.5', unit: 'mg/kg', range: '1.5-3' },
                maintenance: { dose: '100-200', unit: 'mcg/kg/min', range: '50-300' },
                pediatric: { dose: '2.5-3.5', unit: 'mg/kg', range: '2-4' },
                sideEffects: ['Ù‡Ø¨ÙˆØ· ÙÙŠ Ø¶ØºØ· Ø§Ù„Ø¯Ù…', 'Ø¨Ø·Ø¡ ÙÙŠ Ø§Ù„Ù‚Ù„Ø¨', 'Ø£Ù„Ù… ÙÙŠ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ù‚Ù†', 'ØªÙˆÙ‚Ù Ø§Ù„ØªÙ†ÙØ³'],
                contraindications: ['Ø­Ø³Ø§Ø³ÙŠØ© Ù…Ù† Ø§Ù„Ø¨ÙŠØ¶ Ø£Ùˆ Ø§Ù„ØµÙˆÙŠØ§', 'Ø¹Ø¯Ù… Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ø¯Ù…ÙˆÙŠØ©'],
                onset: '30-60 Ø«Ø§Ù†ÙŠØ©',
                duration: '5-10 Ø¯Ù‚Ø§Ø¦Ù‚'
            },
            midazolam: {
                name: 'Midazolam (Ù…ÙŠØ¯Ø§Ø²ÙˆÙ„Ø§Ù…)',
                induction: { dose: '0.1-0.2', unit: 'mg/kg', range: '0.05-0.3' },
                maintenance: { dose: '0.05-0.1', unit: 'mg/kg/hr', range: '0.02-0.2' },
                pediatric: { dose: '0.1-0.15', unit: 'mg/kg', range: '0.05-0.2' },
                sideEffects: ['Ù†Ø¹Ø§Ø³', 'Ø¯ÙˆØ®Ø©', 'ÙÙ‚Ø¯Ø§Ù† Ø°Ø§ÙƒØ±Ø© Ù…Ø¤Ù‚Øª', 'Ù‡Ø¨ÙˆØ· ØªÙ†ÙØ³ÙŠ Ø®ÙÙŠÙ'],
                contraindications: ['Ø­Ø³Ø§Ø³ÙŠØ© Ù…Ù† Ø§Ù„Ø¨Ù†Ø²ÙˆØ¯ÙŠØ§Ø²ÙŠØ¨ÙŠÙ†', 'Ø§Ù„Ø²Ø±Ù‚ Ø§Ù„Ø¶ÙŠÙ‚ Ø§Ù„Ø²Ø§ÙˆÙŠØ©'],
                onset: '1-3 Ø¯Ù‚Ø§Ø¦Ù‚',
                duration: '30-60 Ø¯Ù‚ÙŠÙ‚Ø©'
            },
            fentanyl: {
                name: 'Fentanyl (ÙÙ†ØªØ§Ù†ÙŠÙ„)',
                induction: { dose: '2-5', unit: 'mcg/kg', range: '1-10' },
                maintenance: { dose: '1-3', unit: 'mcg/kg/hr', range: '0.5-5' },
                pediatric: { dose: '1-3', unit: 'mcg/kg', range: '0.5-5' },
                sideEffects: ['Ù‡Ø¨ÙˆØ· ØªÙ†ÙØ³ÙŠ', 'ØºØ«ÙŠØ§Ù† ÙˆÙ‚ÙŠØ¡', 'Ø­ÙƒØ©', 'ØªØµÙ„Ø¨ Ø¹Ø¶Ù„ÙŠ'],
                contraindications: ['Ø­Ø³Ø§Ø³ÙŠØ© Ù…Ù† Ø§Ù„Ø£ÙÙŠÙˆÙ†Ø§Øª', 'Ø¥ØµØ§Ø¨Ø© Ø§Ù„Ø±Ø£Ø³ Ø§Ù„Ø´Ø¯ÙŠØ¯Ø©'],
                onset: '1-2 Ø¯Ù‚ÙŠÙ‚Ø©',
                duration: '30-60 Ø¯Ù‚ÙŠÙ‚Ø©'
            },
            morphine: {
                name: 'Morphine (Ù…ÙˆØ±ÙÙŠÙ†)',
                induction: { dose: '0.1-0.2', unit: 'mg/kg', range: '0.05-0.3' },
                maintenance: { dose: '0.02-0.05', unit: 'mg/kg/hr', range: '0.01-0.1' },
                pediatric: { dose: '0.05-0.1', unit: 'mg/kg', range: '0.02-0.15' },
                sideEffects: ['Ù‡Ø¨ÙˆØ· ØªÙ†ÙØ³ÙŠ', 'Ø¥Ù…Ø³Ø§Ùƒ', 'ØºØ«ÙŠØ§Ù† ÙˆÙ‚ÙŠØ¡', 'Ø­ÙƒØ©'],
                contraindications: ['Ø­Ø³Ø§Ø³ÙŠØ© Ù…Ù† Ø§Ù„Ø£ÙÙŠÙˆÙ†Ø§Øª', 'Ø§Ù„Ø±Ø¨Ùˆ Ø§Ù„Ø­Ø§Ø¯'],
                onset: '5-10 Ø¯Ù‚Ø§Ø¦Ù‚',
                duration: '2-4 Ø³Ø§Ø¹Ø§Øª'
            },
            ketamine: {
                name: 'Ketamine (ÙƒÙŠØªØ§Ù…ÙŠÙ†)',
                induction: { dose: '1-2', unit: 'mg/kg IV', range: '0.5-3' },
                maintenance: { dose: '0.5-1', unit: 'mg/kg/hr', range: '0.2-2' },
                pediatric: { dose: '1-2', unit: 'mg/kg', range: '0.5-3' },
                sideEffects: ['Ù‡Ù„ÙˆØ³Ø©', 'Ø£Ø­Ù„Ø§Ù… Ù…Ø²Ø¹Ø¬Ø©', 'Ø§Ø±ØªÙØ§Ø¹ Ø¶ØºØ· Ø§Ù„Ø¯Ù…', 'Ø²ÙŠØ§Ø¯Ø© Ø¥ÙØ±Ø§Ø² Ø§Ù„Ù„Ø¹Ø§Ø¨'],
                contraindications: ['Ø§Ø±ØªÙØ§Ø¹ Ø¶ØºØ· Ø§Ù„Ø¯Ù… ØºÙŠØ± Ø§Ù„Ù…Ø³ÙŠØ·Ø± Ø¹Ù„ÙŠÙ‡', 'Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù‚Ù„Ø¨ Ø§Ù„ØªØ§Ø¬ÙŠØ©'],
                onset: '30-60 Ø«Ø§Ù†ÙŠØ©',
                duration: '5-15 Ø¯Ù‚ÙŠÙ‚Ø©'
            },
            atracurium: {
                name: 'Atracurium (Ø£ØªØ±Ø§ÙƒÙˆØ±ÙŠÙˆÙ…)',
                induction: { dose: '0.4-0.5', unit: 'mg/kg', range: '0.3-0.6' },
                pediatric: { dose: '0.3-0.4', unit: 'mg/kg', range: '0.2-0.5' },
                sideEffects: ['ØªØ­Ø±Ø± Ø§Ù„Ù‡ÙŠØ³ØªØ§Ù…ÙŠÙ†', 'Ø§Ø­Ù…Ø±Ø§Ø± Ø§Ù„Ø¬Ù„Ø¯', 'Ù‡Ø¨ÙˆØ· Ø¶ØºØ· Ø®ÙÙŠÙ'],
                contraindications: ['Ø­Ø³Ø§Ø³ÙŠØ© Ù…Ù† Ø§Ù„Ø¨Ø§Ø±Ø§ÙƒÙˆØ§Øª', 'ÙˆÙ‡Ù† Ø§Ù„Ø¹Ø¶Ù„Ø§Øª Ø§Ù„Ø´Ø¯ÙŠØ¯'],
                onset: '2-3 Ø¯Ù‚Ø§Ø¦Ù‚',
                duration: '20-40 Ø¯Ù‚ÙŠÙ‚Ø©'
            }
        };

        // === INITIALIZATION ===
        window.onload = function() {
            console.log('App initializing...');
            
            // Initialize owner account creation
            initializeOwnerAccount();
            
            // Check for redirect result first
            window.firebaseAuthFunctions.getRedirectResult(window.firebaseAuth)
                .then((result) => {
                    if (result && result.user) {
                        console.log('User signed in via redirect:', result.user);
                    }
                })
                .catch((error) => {
                    console.error('Redirect result error:', error);
                });
            
            // Check authentication state
            window.firebaseAuthFunctions.onAuthStateChanged(window.firebaseAuth, (user) => {
                console.log('Auth state changed:', user ? user.email : 'No user');
                if (user) {
                    handleUserLogin(user);
                } else {
                    showLoginScreen();
                }
            });
        };
        
        // Initialize owner account
        async function initializeOwnerAccount() {
            try {
                // Check if owner already exists in Firebase Auth
                // This is just to initialize - actual login will be through the UI
                console.log('Owner account initialization completed');
            } catch (error) {
                console.log('Owner account will be created on first login');
            }
        }

        // === AUTHENTICATION FUNCTIONS ===
        function showLoginScreen() {
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('app').style.display = 'none';
        }

        function hideLoginScreen() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app').style.display = 'block';
        }

        function toggleLoginMode() {
            isLoginMode = !isLoginMode;
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            
            if (isLoginMode) {
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
            } else {
                loginForm.classList.add('hidden');
                registerForm.classList.remove('hidden');
            }
            
            // Clear errors
            clearErrors();
        }

        function clearErrors() {
            document.getElementById('login-error').classList.add('hidden');
            document.getElementById('register-error').classList.add('hidden');
        }

        function showError(type, message) {
            const errorElement = document.getElementById(type + '-error');
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
        }

        async function handleLogin() {
            console.log('Login button clicked');
            const email = document.getElementById('login-email').value?.trim();
            const password = document.getElementById('login-password').value;
            const loginBtn = document.getElementById('login-btn');
            
            if (!email || !password) {
                showError('login', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
                return;
            }
            
            loginBtn.disabled = true;
            loginBtn.textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...';
            clearErrors();
            
            try {
                console.log('Attempting login for:', email);
                
                // Special handling for owner account
                if (email === 'bama47686@gmail.com' && password === 'mustafa@2006#2') {
                    console.log('Owner login detected');
                    // Try to sign in with Firebase, create account if doesn't exist
                    try {
                        const userCredential = await window.firebaseAuthFunctions.signInWithEmailAndPassword(window.firebaseAuth, email, password);
                        console.log('Owner login successful');
                    } catch (loginError) {
                        if (loginError.code === 'auth/user-not-found') {
                            console.log('Creating owner account...');
                            // Create owner account
                            const userCredential = await window.firebaseAuthFunctions.createUserWithEmailAndPassword(window.firebaseAuth, email, password);
                            console.log('Owner account created successfully');
                        } else {
                            throw loginError;
                        }
                    }
                } else {
                    // Regular user login
                    const userCredential = await window.firebaseAuthFunctions.signInWithEmailAndPassword(window.firebaseAuth, email, password);
                    console.log('Regular login successful:', userCredential.user.email);
                }
                
                // User will be handled by onAuthStateChanged
                
            } catch (error) {
                console.error('Login error:', error.code, error.message);
                let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                
                switch (error.code) {
                    case 'auth/user-not-found':
                        if (email === 'bama47686@gmail.com') {
                            errorMessage = 'Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø§Ù„Ùƒ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯. Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹...';
                        } else {
                            errorMessage = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± Ù…Ø³Ø¬Ù„. Ø¬Ø±Ø¨ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯';
                        }
                        break;
                    case 'auth/wrong-password':
                    case 'auth/invalid-credential':
                        if (email === 'bama47686@gmail.com') {
                            errorMessage = 'ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø§Ù„Ùƒ ØºÙŠØ± ØµØ­ÙŠØ­Ø©. ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ†: mustafa@2006#2';
                        } else {
                            errorMessage = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
                        }
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­';
                        break;
                    case 'auth/user-disabled':
                        errorMessage = 'Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø¹Ø·Ù„. ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'Ù…Ø­Ø§ÙˆÙ„Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ÙƒØ«ÙŠØ±Ø©. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹';
                        break;
                    case 'auth/email-already-in-use':
                        errorMessage = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„';
                        break;
                    case 'auth/weak-password':
                        errorMessage = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹';
                        break;
                }
                
                showError('login', errorMessage);
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
            }
        }

        async function handleGoogleLogin() {
            console.log('Starting Google login...');
            const googleLoginBtn = document.getElementById('google-login-btn') || document.getElementById('google-register-btn');
            
            if (googleLoginBtn) {
                googleLoginBtn.disabled = true;
                googleLoginBtn.textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...';
            }
            clearErrors();
            
            try {
                // Check if Firebase is properly initialized
                if (!window.firebaseAuth || !window.googleProvider) {
                    throw new Error('Firebase not properly initialized');
                }
                
                console.log('Firebase Auth initialized, attempting Google sign-in...');
                
                // Configure Google provider with minimal parameters
                window.googleProvider = new window.firebaseAuthFunctions.GoogleAuthProvider();
                window.googleProvider.setCustomParameters({
                    prompt: 'select_account'
                });
                
                // Add necessary scopes
                window.googleProvider.addScope('email');
                window.googleProvider.addScope('profile');
                
                console.log('Google provider configured, attempting popup...');
                
                // Try popup first
                let result;
                try {
                    result = await window.firebaseAuthFunctions.signInWithPopup(window.firebaseAuth, window.googleProvider);
                    console.log('Popup sign-in successful:', result.user.email);
                } catch (popupError) {
                    console.warn('Popup sign-in failed:', popupError.code, popupError.message);
                    
                    // If popup failed due to blocking, try redirect
                    if (popupError.code === 'auth/popup-blocked' || 
                        popupError.code === 'auth/cancelled-popup-request' ||
                        popupError.code === 'auth/popup-closed-by-user') {
                        
                        console.log('Trying redirect method...');
                        await window.firebaseAuthFunctions.signInWithRedirect(window.firebaseAuth, window.googleProvider);
                        return; // Redirect will handle the rest
                    } else {
                        throw popupError; // Re-throw other errors
                    }
                }
                
                const user = result.user;
                console.log('Google login successful for user:', user.email);
                
                // User will be handled by onAuthStateChanged
                
            } catch (error) {
                console.error('Google login error details:', {
                    code: error.code,
                    message: error.message,
                    stack: error.stack
                });
                
                let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Google';
                
                switch (error.code) {
                    case 'auth/popup-closed-by-user':
                        errorMessage = 'ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                        break;
                    case 'auth/popup-blocked':
                        errorMessage = 'ØªÙ… Ø­Ø¬Ø¨ Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø£Ùˆ Ø¬Ø±Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰';
                        break;
                    case 'auth/cancelled-popup-request':
                        errorMessage = 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                        break;
                    case 'auth/account-exists-with-different-credential':
                        errorMessage = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø±ØªØ¨Ø· Ø¨Ø·Ø±ÙŠÙ‚Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø£Ø®Ø±Ù‰. Ø¬Ø±Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ';
                        break;
                    case 'auth/user-disabled':
                        errorMessage = 'Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø¹Ø·Ù„. ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©';
                        break;
                    case 'auth/operation-not-allowed':
                        errorMessage = 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Google ØºÙŠØ± Ù…ÙØ¹Ù„ ÙÙŠ Firebase Console. ÙŠØ¬Ø¨ ØªÙØ¹ÙŠÙ„Ù‡ Ø£ÙˆÙ„Ø§Ù‹:\n\n1. Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Firebase Console\n2. Ø§Ø®ØªØ± Authentication\n3. ÙØ¹Ù‘Ù„ Google Sign-in method\n4. Ø§Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª';
                        break;
                    case 'auth/unauthorized-domain':
                        errorMessage = 'Ù‡Ø°Ø§ Ø§Ù„Ù†Ø·Ø§Ù‚ ØºÙŠØ± Ù…ÙØµØ±Ø­ Ù„Ù‡ ÙÙŠ Firebase. Ø£Ø¶Ù Ø§Ù„Ù†Ø·Ø§Ù‚:\n\n1. Firebase Console â†’ Authentication\n2. Settings â†’ Authorized domains\n3. Ø£Ø¶Ù Ù†Ø·Ø§Ù‚ Ù…ÙˆÙ‚Ø¹Ùƒ';
                        break;
                    default:
                        if (error.message.includes('Firebase not properly initialized')) {
                            errorMessage = 'Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©';
                        } else {
                            errorMessage = `Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Google: ${error.message}`;
                        }
                }
                
                if (error.code !== 'auth/cancelled-popup-request') {
                    showError(isLoginMode ? 'login' : 'register', errorMessage);
                }
            } finally {
                if (googleLoginBtn) {
                    googleLoginBtn.disabled = false;
                    googleLoginBtn.textContent = isLoginMode ? 'ğŸ”— ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Google' : 'ğŸ”— Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù€ Google';
                }
            }
        }

        async function handleRegister() {
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm').value;
            const registerBtn = document.getElementById('register-btn');
            
            if (!name || !email || !password || !confirmPassword) {
                showError('register', 'ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                return;
            }
            
            if (password !== confirmPassword) {
                showError('register', 'ÙƒÙ„Ù…ØªØ§ Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†');
                return;
            }
            
            if (password.length < 6) {
                showError('register', 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }
            
            registerBtn.disabled = true;
            registerBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨...';
            clearErrors();
            
            try {
                const userCredential = await window.firebaseAuthFunctions.createUserWithEmailAndPassword(window.firebaseAuth, email, password);
                const user = userCredential.user;
                
                // Create user profile in Firestore
                await createUserProfile(user, name);
                
            } catch (error) {
                console.error('Registration error:', error);
                let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨';
                
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­';
                        break;
                    case 'auth/weak-password':
                        errorMessage = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹';
                        break;
                }
                
                showError('register', errorMessage);
            } finally {
                registerBtn.disabled = false;
                registerBtn.textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨';
            }
        }

        async function createUserProfile(user, displayName) {
            try {
                console.log('Creating user profile for:', user.email);
                
                // Generate user ID
                const usersSnapshot = await window.firebaseDbFunctions.getDocs(
                    window.firebaseDbFunctions.collection(window.firebaseDb, 'users')
                );
                const userCount = usersSnapshot.size;
                
                // Determine if this is the owner
                const isOwner = user.email === 'bama47686@gmail.com';
                const userId = isOwner ? 'ANS001' : `ANS${String(userCount + 2).padStart(3, '0')}`;
                
                // Get display name from user or parameter
                const finalDisplayName = displayName || user.displayName || (isOwner ? 'Ù…ØµØ·ÙÙ‰ Ø§Ù„Ù…Ø§Ù„Ùƒ' : user.email.split('@')[0]);
                
                const userProfile = {
                    uid: user.uid,
                    email: user.email,
                    displayName: finalDisplayName,
                    userId: userId,
                    role: isOwner ? 'owner' : 'user',
                    isBlocked: false,
                    createdAt: new Date(),
                    lastLogin: new Date(),
                    calculationsCount: 0,
                    loginMethod: user.providerData && user.providerData.length > 0 ? 
                        (user.providerData[0].providerId === 'google.com' ? 'google' : 'email') : 'email'
                };
                
                console.log('User profile data:', userProfile);
                
                await window.firebaseDbFunctions.setDoc(
                    window.firebaseDbFunctions.doc(window.firebaseDb, 'users', user.uid),
                    userProfile
                );
                
                console.log('User profile created successfully:', finalDisplayName);
                return userProfile;
            } catch (error) {
                console.error('Error creating user profile:', error);
                throw error;
            }
        }

        async function handleUserLogin(user) {
            try {
                console.log('Handling user login for:', user.email);
                
                // Get user profile from Firestore
                const userDocRef = window.firebaseDbFunctions.doc(window.firebaseDb, 'users', user.uid);
                let userDoc = await window.firebaseDbFunctions.getDoc(userDocRef);
                
                if (userDoc.exists()) {
                    userData = userDoc.data();
                    
                    // Check if user is blocked (but never block the owner)
                    if (userData.isBlocked && userData.role !== 'owner') {
                        alert('Ø­Ø³Ø§Ø¨Ùƒ Ù…Ø¹Ø·Ù„. ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.');
                        await handleLogout();
                        return;
                    }
                    
                    // Update last login and login method
                    const updateData = {
                        lastLogin: new Date(),
                    };
                    
                    // Update login method if it's from Google
                    if (user.providerData && user.providerData.length > 0) {
                        const provider = user.providerData[0].providerId;
                        if (provider === 'google.com') {
                            updateData.loginMethod = 'google';
                        }
                    }
                    
                    await window.firebaseDbFunctions.updateDoc(userDocRef, updateData);
                    
                } else {
                    // Create profile for new users
                    console.log('Creating new user profile...');
                    userData = await createUserProfile(user);
                }
                
                currentUser = user;
                
                // Update UI
                const displayName = userData.displayName || user.displayName || user.email.split('@')[0];
                document.getElementById('user-name').textContent = displayName;
                document.getElementById('user-id').textContent = `(${userData.userId})`;
                
                // Show admin panel if owner
                if (userData.role === 'owner') {
                    document.getElementById('admin-btn').style.display = 'block';
                    console.log('Owner logged in, showing admin panel');
                }
                
                hideLoginScreen();
                console.log('User login handled successfully');
                
            } catch (error) {
                console.error('Error handling user login:', error);
                showError('login', 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ' + error.message);
            }
        }

        async function handleLogout() {
            try {
                await window.firebaseAuthFunctions.signOut(window.firebaseAuth);
                currentUser = null;
                userData = {};
                document.getElementById('admin-btn').style.display = 'none';
                showLoginScreen();
            } catch (error) {
                console.error('Error signing out:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬');
            }
        }

        // === PANEL MANAGEMENT ===
        function showPanel(panelId) {
            // Hide all panels
            const panels = document.querySelectorAll('.panel');
            panels.forEach(panel => {
                panel.classList.remove('active');
            });

            // Show selected panel
            document.getElementById(panelId + '-panel').classList.add('active');

            // Update button states
            const buttons = document.querySelectorAll('.nav-buttons .btn');
            buttons.forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('inactive');
            });

            // Find and activate the clicked button
            const activeButton = Array.from(buttons).find(btn => 
                btn.textContent.includes(getPanelTitle(panelId)) || btn.getAttribute('onclick').includes(panelId)
            );
            if (activeButton) {
                activeButton.classList.remove('inactive');
                activeButton.classList.add('active');
            }
            
            // Load admin data if admin panel
            if (panelId === 'admin' && userData.role === 'owner') {
                loadAdminData();
            }
        }

        function getPanelTitle(panelId) {
            const titles = {
                dose: 'Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¬Ø±Ø¹Ø§Øª',
                fluids: 'Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ ÙˆØ§Ù„Ø¯Ù…',
                airway: 'Ø§Ù„Ù„Ø§Ø±Ù†ØºÙˆØ³ÙƒÙˆØ¨',
                admin: 'Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ù„Ùƒ',
                about: 'Ø­ÙˆÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚'
            };
            return titles[panelId] || '';
        }

        // === THEME MANAGEMENT ===
        function toggleTheme() {
            const body = document.body;
            const isLight = body.classList.contains('light');
            
            if (isLight) {
                body.classList.remove('light');
                localStorage.setItem('theme', 'dark');
            } else {
                body.classList.add('light');
                localStorage.setItem('theme', 'light');
            }
        }

        // Load saved theme
        if (localStorage.getItem('theme') === 'light') {
            document.body.classList.add('light');
        }

        // === CALCULATION FUNCTIONS ===
        async function calculateDose() {
            const patientName = document.getElementById('dose-patient-name').value;
            const weight = parseFloat(document.getElementById('dose-weight').value);
            const age = parseFloat(document.getElementById('dose-age').value);
            const ageUnit = document.getElementById('dose-age-unit').value;
            const drugKey = document.getElementById('dose-drug').value;

            const resultDiv = document.getElementById('dose-result');

            // Validation
            if (!patientName || !weight || !age || !drugKey) {
                resultDiv.className = 'result-box error';
                resultDiv.innerHTML = '<div class="text-danger"><strong>Ø®Ø·Ø£:</strong> ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</div>';
                return;
            }

            if (weight < 0.5 || weight > 200) {
                resultDiv.className = 'result-box error';
                resultDiv.innerHTML = '<div class="text-danger"><strong>Ø®Ø·Ø£:</strong> Ø§Ù„ÙˆØ²Ù† ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 0.5 Ùˆ 200 ÙƒÙŠÙ„ÙˆØ¬Ø±Ø§Ù…</div>';
                return;
            }

            // Get drug info
            const drug = drugDatabase[drugKey];
            if (!drug) {
                resultDiv.className = 'result-box error';
                resultDiv.innerHTML = '<div class="text-danger"><strong>Ø®Ø·Ø£:</strong> Ø¯ÙˆØ§Ø¡ ØºÙŠØ± ØµØ­ÙŠØ­</div>';
                return;
            }

            // Convert age to years
            let ageInYears = age;
            if (ageUnit === 'months') {
                ageInYears = age / 12;
            } else if (ageUnit === 'days') {
                ageInYears = age / 365;
            }

            // Calculate dose
            const isPediatric = ageInYears < 18;
            const dosing = isPediatric ? drug.pediatric : drug.induction;
            
            // Get base dose (use first value if range)
            const baseDose = parseFloat(dosing.dose.split('-')[0]);
            
            // Calculate initial dose
            let calculatedDose = baseDose * weight;
            
            // Age adjustment
            if (ageInYears > 65) {
                calculatedDose *= 0.8;
            }

            // Round result
            const finalDose = Math.round(calculatedDose * 100) / 100;

            // Display result
            resultDiv.className = 'result-box success';
            resultDiv.innerHTML = `
                <div class="result-value">${finalDose}</div>
                <div class="result-unit">${dosing.unit}</div>
                <div class="result-details">
                    <div><strong>Ø§Ù„Ù…Ø±ÙŠØ¶:</strong> ${patientName}</div>
                    <div><strong>Ø§Ù„ÙˆØ²Ù†:</strong> ${weight} ÙƒØº</div>
                    <div><strong>Ø§Ù„Ø¹Ù…Ø±:</strong> ${age} ${ageUnit === 'years' ? 'Ø³Ù†Ø©' : ageUnit === 'months' ? 'Ø´Ù‡Ø±' : 'ÙŠÙˆÙ…'}</div>
                    <div><strong>Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…ÙØ¹ÙˆÙ„:</strong> ${drug.onset}</div>
                    <div><strong>Ù…Ø¯Ø© Ø§Ù„Ù…ÙØ¹ÙˆÙ„:</strong> ${drug.duration}</div>
                </div>
            `;

            // Save calculation to Firebase
            try {
                await window.firebaseDbFunctions.addDoc(
                    window.firebaseDbFunctions.collection(window.firebaseDb, 'calculations'),
                    {
                        userId: currentUser.uid,
                        type: 'dose',
                        patientName: patientName,
                        data: {
                            weight, age, ageUnit, drug: drugKey
                        },
                        result: {
                            dose: finalDose,
                            unit: dosing.unit,
                            drug: drug.name
                        },
                        createdAt: new Date()
                    }
                );
                
                // Update user's calculations count
                const userDocRef = window.firebaseDbFunctions.doc(window.firebaseDb, 'users', currentUser.uid);
                await window.firebaseDbFunctions.updateDoc(userDocRef, {
                    calculationsCount: (userData.calculationsCount || 0) + 1
                });
                
            } catch (error) {
                console.error('Error saving calculation:', error);
            }
        }

        async function calculateFluids() {
            const patientName = document.getElementById('fluid-patient-name').value;
            const weight = parseFloat(document.getElementById('fluid-weight').value);
            const duration = parseFloat(document.getElementById('fluid-duration').value);
            const surgeryType = document.getElementById('fluid-surgery-type').value;

            const resultDiv = document.getElementById('fluid-result');

            // Validation
            if (!patientName || !weight || !duration || !surgeryType) {
                resultDiv.className = 'result-box error';
                resultDiv.innerHTML = '<div class="text-danger"><strong>Ø®Ø·Ø£:</strong> ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</div>';
                return;
            }

            // Calculate maintenance fluids (Holiday-Segar method)
            let maintenanceFluid = 0;
            if (weight <= 10) {
                maintenanceFluid = weight * 100; // 100 ml/kg for first 10 kg
            } else if (weight <= 20) {
                maintenanceFluid = 1000 + (weight - 10) * 50; // + 50 ml/kg for next 10 kg
            } else {
                maintenanceFluid = 1500 + (weight - 20) * 20; // + 20 ml/kg for remaining weight
            }

            // Convert to hourly rate
            const maintenancePerHour = Math.round(maintenanceFluid / 24);

            // Calculate replacement fluids based on surgery type
            const replacementRates = {
                'minor': 2, // ml/kg/hr
                'moderate': 4,
                'major': 6,
                'emergency': 8
            };

            const replacementFluid = Math.round(weight * (replacementRates[surgeryType] || 2));

            // Calculate total fluid requirement
            const totalFluidPerHour = maintenancePerHour + replacementFluid;
            const totalFluidForSurgery = Math.round(totalFluidPerHour * duration);

            // Display result
            resultDiv.className = 'result-box success';
            resultDiv.innerHTML = `
                <div class="result-value">${totalFluidPerHour}</div>
                <div class="result-unit">Ù…Ù„/Ø³Ø§Ø¹Ø© (Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³ÙˆØ§Ø¦Ù„)</div>
                <div class="result-value">${totalFluidForSurgery}</div>
                <div class="result-unit">Ù…Ù„ (Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©)</div>
                <div class="result-details">
                    <div><strong>Ø§Ù„Ù…Ø±ÙŠØ¶:</strong> ${patientName}</div>
                    <div><strong>Ø§Ù„ÙˆØ²Ù†:</strong> ${weight} ÙƒØº</div>
                    <div><strong>Ù…Ø¯Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:</strong> ${duration} Ø³Ø§Ø¹Ø©</div>
                    <div><strong>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:</strong> ${surgeryType}</div>
                    <div><strong>Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:</strong> ${maintenancePerHour} Ù…Ù„/Ø³Ø§Ø¹Ø©</div>
                    <div><strong>Ø³ÙˆØ§Ø¦Ù„ Ø§Ù„ØªØ¹ÙˆÙŠØ¶:</strong> ${replacementFluid} Ù…Ù„/Ø³Ø§Ø¹Ø©</div>
                </div>
            `;

            // Save calculation to Firebase
            try {
                await window.firebaseDbFunctions.addDoc(
                    window.firebaseDbFunctions.collection(window.firebaseDb, 'calculations'),
                    {
                        userId: currentUser.uid,
                        type: 'fluids',
                        patientName: patientName,
                        data: {
                            weight, duration, surgeryType
                        },
                        result: {
                            totalPerHour: totalFluidPerHour,
                            totalForSurgery: totalFluidForSurgery,
                            maintenance: maintenancePerHour,
                            replacement: replacementFluid
                        },
                        createdAt: new Date()
                    }
                );
                
            } catch (error) {
                console.error('Error saving calculation:', error);
            }
        }

        async function calculateAirway() {
            const patientName = document.getElementById('airway-patient-name').value;
            const age = parseFloat(document.getElementById('airway-age').value);
            const weight = parseFloat(document.getElementById('airway-weight').value);
            const gender = document.getElementById('airway-gender').value;

            const resultDiv = document.getElementById('airway-result');

            // Validation
            if (!patientName || !age || !weight || !gender) {
                resultDiv.className = 'result-box error';
                resultDiv.innerHTML = '<div class="text-danger"><strong>Ø®Ø·Ø£:</strong> ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</div>';
                return;
            }

            let ettSize, laryngoscopeSize, insertionDepth;

            // Pediatric calculations (< 8 years)
            if (age < 8) {
                // ETT size for children: (age + 16) / 4
                ettSize = (age + 16) / 4;
                
                // Laryngoscope blade size
                if (age < 1) {
                    laryngoscopeSize = '0-1 (Ù…Ø³ØªÙ‚ÙŠÙ…)';
                } else if (age < 3) {
                    laryngoscopeSize = '1-2 (Ù…Ø³ØªÙ‚ÙŠÙ…)';
                } else {
                    laryngoscopeSize = '2 (Ù…Ø³ØªÙ‚ÙŠÙ… Ø£Ùˆ Ù…Ù†Ø­Ù†ÙŠ)';
                }
                
                // Insertion depth: ETT size Ã— 3
                insertionDepth = ettSize * 3;
                
            } else {
                // Adult calculations
                if (gender === 'female') {
                    ettSize = 7.0;
                    laryngoscopeSize = '3 (Ù…Ù†Ø­Ù†ÙŠ - Macintosh)';
                    insertionDepth = 21;
                } else {
                    ettSize = 8.0;
                    laryngoscopeSize = '3-4 (Ù…Ù†Ø­Ù†ÙŠ - Macintosh)';
                    insertionDepth = 23;
                }
            }

            // Round ETT size to nearest 0.5
            ettSize = Math.round(ettSize * 2) / 2;

            // Display result
            resultDiv.className = 'result-box success';
            resultDiv.innerHTML = `
                <div class="result-value">${ettSize}</div>
                <div class="result-unit">Ù…Ù… (Ø­Ø¬Ù… Ø£Ù†Ø¨ÙˆØ¨ ETT)</div>
                <div class="result-value">${insertionDepth}</div>
                <div class="result-unit">Ø³Ù… (Ø¹Ù…Ù‚ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„)</div>
                <div class="result-details">
                    <div><strong>Ø§Ù„Ù…Ø±ÙŠØ¶:</strong> ${patientName}</div>
                    <div><strong>Ø§Ù„Ø¹Ù…Ø±:</strong> ${age} Ø³Ù†Ø©</div>
                    <div><strong>Ø§Ù„ÙˆØ²Ù†:</strong> ${weight} ÙƒØº</div>
                    <div><strong>Ø§Ù„Ø¬Ù†Ø³:</strong> ${gender === 'male' ? 'Ø°ÙƒØ±' : 'Ø£Ù†Ø«Ù‰'}</div>
                    <div><strong>Ù†ØµÙ„ Ø§Ù„Ù„Ø§Ø±Ù†ØºÙˆØ³ÙƒÙˆØ¨:</strong> ${laryngoscopeSize}</div>
                </div>
            `;

            // Save calculation to Firebase
            try {
                await window.firebaseDbFunctions.addDoc(
                    window.firebaseDbFunctions.collection(window.firebaseDb, 'calculations'),
                    {
                        userId: currentUser.uid,
                        type: 'airway',
                        patientName: patientName,
                        data: {
                            age, weight, gender
                        },
                        result: {
                            ettSize,
                            laryngoscopeSize,
                            insertionDepth
                        },
                        createdAt: new Date()
                    }
                );
                
            } catch (error) {
                console.error('Error saving calculation:', error);
            }
        }

        // === FORM CLEARING ===
        function clearDoseForm() {
            document.getElementById('dose-patient-name').value = '';
            document.getElementById('dose-weight').value = '';
            document.getElementById('dose-age').value = '';
            document.getElementById('dose-age-unit').value = 'years';
            document.getElementById('dose-drug').value = '';
            
            // Clear results
            document.getElementById('dose-result').className = 'result-box';
            document.getElementById('dose-result').innerHTML = '<strong>Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§</strong><p class="text-muted mt-2">Ù‚Ù… Ø¨Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø®Ø¯Ø± Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªÙŠØ¬Ø©</p>';
        }

        function clearFluidForm() {
            document.getElementById('fluid-patient-name').value = '';
            document.getElementById('fluid-weight').value = '';
            document.getElementById('fluid-duration').value = '';
            document.getElementById('fluid-surgery-type').value = '';
            
            // Clear results
            document.getElementById('fluid-result').className = 'result-box';
            document.getElementById('fluid-result').innerHTML = '<strong>Ù†ØªØ§Ø¦Ø¬ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³ÙˆØ§Ø¦Ù„</strong><p class="text-muted mt-2">Ù‚Ù… Ø¨Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</p>';
        }

        function clearAirwayForm() {
            document.getElementById('airway-patient-name').value = '';
            document.getElementById('airway-age').value = '';
            document.getElementById('airway-weight').value = '';
            document.getElementById('airway-gender').value = '';
            
            // Clear results
            document.getElementById('airway-result').className = 'result-box';
            document.getElementById('airway-result').innerHTML = '<strong>Ù…Ø¹Ø¯Ø§Øª Ù…Ø¬Ø±Ù‰ Ø§Ù„Ù‡ÙˆØ§Ø¡ Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§</strong><p class="text-muted mt-2">Ù‚Ù… Ø¨Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆØµÙŠØ§Øª</p>';
        }

        // === ADMIN FUNCTIONS ===
        async function loadAdminData() {
            if (userData.role !== 'owner') return;
            
            try {
                // Get all users
                const usersSnapshot = await window.firebaseDbFunctions.getDocs(
                    window.firebaseDbFunctions.collection(window.firebaseDb, 'users')
                );
                
                // Get all calculations
                const calculationsSnapshot = await window.firebaseDbFunctions.getDocs(
                    window.firebaseDbFunctions.collection(window.firebaseDb, 'calculations')
                );
                
                const totalUsers = usersSnapshot.size;
                const totalCalculations = calculationsSnapshot.size;
                
                // Calculate active users (logged in within last 30 days)
                const thirtyDaysAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);
                let activeUsers = 0;
                
                // Update statistics
                document.getElementById('total-users').textContent = totalUsers;
                document.getElementById('active-users').textContent = activeUsers;
                document.getElementById('total-calculations').textContent = totalCalculations;
                
                // Load users list
                refreshUsersList();
                
            } catch (error) {
                console.error('Error loading admin data:', error);
            }
        }

        async function refreshUsersList() {
            if (userData.role !== 'owner') return;
            
            try {
                const usersSnapshot = await window.firebaseDbFunctions.getDocs(
                    window.firebaseDbFunctions.collection(window.firebaseDb, 'users')
                );
                
                const tbody = document.getElementById('users-tbody');
                tbody.innerHTML = '';
                
                usersSnapshot.forEach((doc) => {
                    const user = doc.data();
                    const row = document.createElement('tr');
                    
                    const statusClass = user.role === 'owner' ? 'status-owner' : 
                                       user.isBlocked ? 'status-blocked' : 'status-active';
                    const statusText = user.role === 'owner' ? 'Ù…Ø§Ù„Ùƒ' : 
                                      user.isBlocked ? 'Ù…Ø­Ø¸ÙˆØ±' : 'Ù†Ø´Ø·';
                    
                    const lastLogin = user.lastLogin ? new Date(user.lastLogin.seconds * 1000).toLocaleDateString('ar-SA') : 'Ù„Ù… ÙŠØ³Ø¬Ù„ Ø¯Ø®ÙˆÙ„';
                    
                    const loginMethod = user.loginMethod === 'google' ? 'ğŸ”— Google' : 'ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯';
                    
                    row.innerHTML = `
                        <td>${user.userId}</td>
                        <td>${user.displayName}</td>
                        <td>${user.email}</td>
                        <td>${loginMethod}</td>
                        <td><span class="user-status ${statusClass}">${statusText}</span></td>
                        <td>${lastLogin}</td>
                        <td>
                            ${user.role !== 'owner' ? `
                                <button class="btn ghost" style="min-width:80px; padding:4px 8px; font-size:12px" 
                                        onclick="${user.isBlocked ? 'unblockUser' : 'blockUser'}('${doc.id}')">
                                    ${user.isBlocked ? 'Ø¥Ù„ØºØ§Ø¡ Ø­Ø¸Ø±' : 'Ø­Ø¸Ø±'}
                                </button>
                            ` : '<span class="text-muted">Ø§Ù„Ù…Ø§Ù„Ùƒ</span>'}
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error('Error loading users list:', error);
            }
        }

        async function blockUser(userId) {
            if (userData.role !== 'owner') return;
            
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø¸Ø± Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) return;
            
            try {
                const userDocRef = window.firebaseDbFunctions.doc(window.firebaseDb, 'users', userId);
                await window.firebaseDbFunctions.updateDoc(userDocRef, {
                    isBlocked: true
                });
                
                alert('ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
                refreshUsersList();
                
            } catch (error) {
                console.error('Error blocking user:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            }
        }

        async function unblockUser(userId) {
            if (userData.role !== 'owner') return;
            
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ø­Ø¸Ø± Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) return;
            
            try {
                const userDocRef = window.firebaseDbFunctions.doc(window.firebaseDb, 'users', userId);
                await window.firebaseDbFunctions.updateDoc(userDocRef, {
                    isBlocked: false
                });
                
                alert('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
                refreshUsersList();
                
            } catch (error) {
                console.error('Error unblocking user:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù„ØºØ§Ø¡ Ø­Ø¸Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
            }
        }

        async function exportAllData() {
            if (userData.role !== 'owner') return;
            
            try {
                // Get all data
                const usersSnapshot = await window.firebaseDbFunctions.getDocs(
                    window.firebaseDbFunctions.collection(window.firebaseDb, 'users')
                );
                const calculationsSnapshot = await window.firebaseDbFunctions.getDocs(
                    window.firebaseDbFunctions.collection(window.firebaseDb, 'calculations')
                );
                
                const users = [];
                const calculations = [];
                
                usersSnapshot.forEach(doc => {
                    users.push({ id: doc.id, ...doc.data() });
                });
                
                calculationsSnapshot.forEach(doc => {
                    calculations.push({ id: doc.id, ...doc.data() });
                });
                
                const exportData = {
                    users,
                    calculations,
                    exportDate: new Date().toISOString(),
                    totalUsers: users.length,
                    totalCalculations: calculations.length
                };
                
                // Download as JSON
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { 
                    type: 'application/json' 
                });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `ans-medical-data-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                URL.revokeObjectURL(url);
                alert('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
                
            } catch (error) {
                console.error('Error exporting data:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            }
        }

        async function clearAllSystemData() {
            if (userData.role !== 'owner') return;
            
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.\n\nØ³ÙŠØªÙ… Ø­Ø°Ù:\n- Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Ø¹Ø¯Ø§ Ø§Ù„Ù…Ø§Ù„Ùƒ)\n- Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©\n- Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©')) return;
            
            const confirmText = prompt('Ø§ÙƒØªØ¨ "Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª" Ù„Ù„ØªØ£ÙƒÙŠØ¯:');
            if (confirmText !== 'Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª') {
                alert('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©');
                return;
            }
            
            try {
                // Delete all calculations
                const calculationsSnapshot = await window.firebaseDbFunctions.getDocs(
                    window.firebaseDbFunctions.collection(window.firebaseDb, 'calculations')
                );
                
                for (const doc of calculationsSnapshot.docs) {
                    await window.firebaseDbFunctions.deleteDoc(doc.ref);
                }
                
                // Delete all users except owner
                const usersSnapshot = await window.firebaseDbFunctions.getDocs(
                    window.firebaseDbFunctions.collection(window.firebaseDb, 'users')
                );
                
                for (const doc of usersSnapshot.docs) {
                    const user = doc.data();
                    if (user.role !== 'owner') {
                        await window.firebaseDbFunctions.deleteDoc(doc.ref);
                    }
                }
                
                alert('ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­!');
                refreshUsersList();
                loadAdminData();
                
            } catch (error) {
                console.error('Error clearing system data:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            }
        }

        // === FIREBASE INSTRUCTIONS ===
        function showFirebaseInstructions() {
            document.getElementById('firebase-modal').style.display = 'flex';
            document.getElementById('firebase-modal').classList.remove('hidden');
        }

        function hideFirebaseInstructions() {
            document.getElementById('firebase-modal').style.display = 'none';
            document.getElementById('firebase-modal').classList.add('hidden');
        }

        // === KEYBOARD SHORTCUTS ===
        document.addEventListener('keydown', function(e) {
            // Enter key for login
            if (e.key === 'Enter' && document.getElementById('login-screen').style.display !== 'none') {
                e.preventDefault();
                if (isLoginMode) {
                    console.log('Enter key pressed - attempting login');
                    handleLogin();
                } else {
                    console.log('Enter key pressed - attempting register');
                    handleRegister();
                }
            }
            
            // Escape key for closing modal
            if (e.key === 'Escape') {
                hideFirebaseInstructions();
            }
        });
        
        // Add click listeners on DOM ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded - Setting up event listeners');
            
            // Additional event listeners for redundancy
            const loginBtn = document.getElementById('login-btn');
            if (loginBtn) {
                loginBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Login button clicked via addEventListener');
                    handleLogin();
                });
            }
            
            const registerBtn = document.getElementById('register-btn');
            if (registerBtn) {
                registerBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Register button clicked via addEventListener');
                    handleRegister();
                });
            }
            
            const googleLoginBtn = document.getElementById('google-login-btn');
            if (googleLoginBtn) {
                googleLoginBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Google login button clicked via addEventListener');
                    handleGoogleLogin();
                });
            }
        });
    </script>
</body>
</html>